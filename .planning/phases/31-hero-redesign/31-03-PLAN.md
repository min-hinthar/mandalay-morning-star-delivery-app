---
phase: 31-hero-redesign
plan: 03
type: execute
wave: 3
depends_on: ["31-02"]
files_modified:
  - src/components/ui/homepage/Hero.tsx
  - src/components/ui/homepage/FloatingEmoji.tsx
  - src/components/ui/homepage/GradientOrb.tsx
autonomous: true

must_haves:
  truths:
    - "12-15 floating emojis visible with varied sizes"
    - "Emojis animate with mixed organic paths (drift, spiral, bob)"
    - "Emojis have depth effects (blur + opacity for far emojis)"
    - "Gradient orbs glow with brand colors"
    - "Emojis subtly shift away from cursor on desktop"
    - "Emojis respect reduced motion preference"
  artifacts:
    - path: "src/components/ui/homepage/FloatingEmoji.tsx"
      provides: "Floating emoji component with depth effects"
      min_lines: 80
    - path: "src/components/ui/homepage/GradientOrb.tsx"
      provides: "Gradient orb component with glow"
      min_lines: 40
    - path: "src/components/ui/homepage/Hero.tsx"
      provides: "Hero with emojis and orbs rendered"
      contains: "FloatingEmoji"
  key_links:
    - from: "src/components/ui/homepage/FloatingEmoji.tsx"
      to: "src/lib/hooks/useAnimationPreference.ts"
      via: "import"
      pattern: "useAnimationPreference"
    - from: "src/components/ui/homepage/Hero.tsx"
      to: "src/components/ui/homepage/FloatingEmoji.tsx"
      via: "import"
      pattern: "FloatingEmoji"
---

<objective>
Create floating emoji system and gradient orbs for hero visual depth.

Purpose: Per CONTEXT.md, floating emojis replace the mascot role with "mixed organic" animations. Dense (12-15 emojis) with varied sizes for depth perception. Mouse interaction on desktop (repel effect).

Output: FloatingEmoji and GradientOrb components integrated into Hero layer containers.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/31-hero-redesign/31-CONTEXT.md
@.planning/phases/31-hero-redesign/31-RESEARCH.md
@.planning/phases/31-hero-redesign/31-02-SUMMARY.md
@src/components/ui/homepage/Hero.tsx
@src/lib/hooks/useAnimationPreference.ts
@src/lib/hooks/useResponsive.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FloatingEmoji component</name>
  <files>src/components/ui/homepage/FloatingEmoji.tsx</files>
  <action>
Create new file with floating emoji component supporting depth effects.

```tsx
"use client";

import { motion, type MotionValue } from "framer-motion";
import { cn } from "@/lib/utils/cn";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

// Per CONTEXT.md: Burmese-themed emojis as placeholders for future food images
export const HERO_EMOJIS = ["üçú", "ü•ü", "üç≤", "üå∂Ô∏è"] as const;

type EmojiSize = "sm" | "md" | "lg";
type EmojiDepth = "far" | "mid" | "near";
type AnimationType = "drift" | "spiral" | "bob";

interface FloatingEmojiProps {
  emoji: string;
  size: EmojiSize;
  depth: EmojiDepth;
  animationType: AnimationType;
  initialX: number;  // Percentage (0-100)
  initialY: number;  // Percentage (0-100)
  parallaxY?: MotionValue<string>;
  mouseOffset?: { x: number; y: number };
  index: number;
}

// Size classes per RESEARCH.md depth table
const sizeClasses: Record<EmojiSize, string> = {
  sm: "text-2xl md:text-3xl",   // 24-32px - far
  md: "text-4xl md:text-5xl",   // 36-48px - mid
  lg: "text-5xl md:text-6xl",   // 52-64px - near
};

// Animation keyframes per type - "mixed organic" per CONTEXT.md
const getAnimationVariants = (type: AnimationType, index: number) => {
  const baseDuration = 8 + index * 0.5;  // Staggered durations

  switch (type) {
    case "drift":
      return {
        animate: {
          x: [0, 30, -20, 10, 0],
          y: [0, -40, -20, -50, 0],
          rotate: [0, 5, -3, 2, 0],
        },
        transition: {
          duration: baseDuration,
          repeat: Infinity,
          ease: "easeInOut",
          delay: index * 0.3,
        },
      };
    case "spiral":
      return {
        animate: {
          x: [0, 25, 0, -25, 0],
          y: [0, -20, -40, -20, 0],
          rotate: [0, 90, 180, 270, 360],
          scale: [1, 1.05, 1, 0.95, 1],
        },
        transition: {
          duration: baseDuration * 1.2,
          repeat: Infinity,
          ease: "easeInOut",
          delay: index * 0.4,
        },
      };
    case "bob":
      return {
        animate: {
          y: [0, -25, 0],
          scale: [1, 1.08, 1],
          rotate: [0, 3, 0, -3, 0],
        },
        transition: {
          duration: baseDuration * 0.8,
          repeat: Infinity,
          ease: "easeInOut",
          delay: index * 0.25,
        },
      };
  }
};

export function FloatingEmoji({
  emoji,
  size,
  depth,
  animationType,
  initialX,
  initialY,
  parallaxY,
  mouseOffset = { x: 0, y: 0 },
  index,
}: FloatingEmojiProps) {
  const { shouldAnimate } = useAnimationPreference();

  const variants = getAnimationVariants(animationType, index);

  // Depth effects per RESEARCH.md table
  const depthStyles: Record<EmojiDepth, { filter: string; opacity: number }> = {
    far: { filter: "blur(var(--hero-emoji-blur-far))", opacity: 0.6 },
    mid: { filter: "blur(var(--hero-emoji-blur-mid))", opacity: 0.8 },
    near: { filter: "none", opacity: 1 },
  };

  return (
    <motion.span
      className={cn(
        sizeClasses[size],
        "absolute select-none pointer-events-none will-change-transform",
        "drop-shadow-[var(--hero-emoji-shadow-" + depth + ")]"
      )}
      style={{
        left: `${initialX}%`,
        top: `${initialY}%`,
        filter: depthStyles[depth].filter,
        opacity: depthStyles[depth].opacity,
        y: parallaxY,
        x: mouseOffset.x,
        // GPU acceleration
        transform: "translate3d(0,0,0)",
      }}
      animate={shouldAnimate ? {
        ...variants.animate,
        x: (variants.animate.x as number[]).map(v => v + mouseOffset.x),
      } : undefined}
      transition={shouldAnimate ? variants.transition : undefined}
    >
      {emoji}
    </motion.span>
  );
}

// Pre-defined emoji configuration for deterministic SSR (avoids hydration mismatch)
// Per CONTEXT.md: Dense (12-15 emojis visible at once)
export const EMOJI_CONFIG: Omit<FloatingEmojiProps, "parallaxY" | "mouseOffset" | "index">[] = [
  // Far layer (small, blurred)
  { emoji: "üçú", size: "sm", depth: "far", animationType: "drift", initialX: 10, initialY: 15 },
  { emoji: "ü•ü", size: "sm", depth: "far", animationType: "bob", initialX: 85, initialY: 25 },
  { emoji: "üç≤", size: "sm", depth: "far", animationType: "spiral", initialX: 25, initialY: 70 },
  { emoji: "üå∂Ô∏è", size: "sm", depth: "far", animationType: "drift", initialX: 70, initialY: 80 },
  // Mid layer (medium)
  { emoji: "ü•ü", size: "md", depth: "mid", animationType: "spiral", initialX: 5, initialY: 45 },
  { emoji: "üçú", size: "md", depth: "mid", animationType: "drift", initialX: 90, initialY: 55 },
  { emoji: "üå∂Ô∏è", size: "md", depth: "mid", animationType: "bob", initialX: 35, initialY: 20 },
  { emoji: "üç≤", size: "md", depth: "mid", animationType: "spiral", initialX: 60, initialY: 75 },
  { emoji: "ü•ü", size: "md", depth: "mid", animationType: "drift", initialX: 80, initialY: 10 },
  // Near layer (large, crisp)
  { emoji: "üçú", size: "lg", depth: "near", animationType: "bob", initialX: 15, initialY: 60 },
  { emoji: "üç≤", size: "lg", depth: "near", animationType: "spiral", initialX: 75, initialY: 40 },
  { emoji: "üå∂Ô∏è", size: "lg", depth: "near", animationType: "drift", initialX: 45, initialY: 85 },
  { emoji: "ü•ü", size: "lg", depth: "near", animationType: "bob", initialX: 55, initialY: 15 },
];
```

Key decisions:
- DETERMINISTIC positions (no Math.random) to avoid hydration mismatch per RESEARCH.md pitfall
- Three animation types for "mixed organic" feel per CONTEXT.md
- CSS variable references for theme-adaptive shadows/blur
- will-change + translate3d for GPU acceleration per RESEARCH.md pitfall
  </action>
  <verify>pnpm typecheck shows no errors in FloatingEmoji.tsx</verify>
  <done>FloatingEmoji component created with depth effects and deterministic positions</done>
</task>

<task type="auto">
  <name>Task 2: Create GradientOrb component</name>
  <files>src/components/ui/homepage/GradientOrb.tsx</files>
  <action>
Create gradient orb component for parallax depth layers.

```tsx
"use client";

import { motion, type MotionValue } from "framer-motion";
import { cn } from "@/lib/utils/cn";

type OrbColor = "saffron" | "jade" | "ruby";

interface GradientOrbProps {
  color: OrbColor;
  size: number;  // px
  x: string;     // CSS position (e.g., "10%", "50px")
  y: string;     // CSS position
  parallaxY?: MotionValue<string>;
  className?: string;
}

export function GradientOrb({
  color,
  size,
  x,
  y,
  parallaxY,
  className,
}: GradientOrbProps) {
  return (
    <motion.div
      className={cn(
        "absolute rounded-full pointer-events-none",
        className
      )}
      style={{
        width: size,
        height: size,
        left: x,
        top: y,
        y: parallaxY,
        // Radial gradient using theme-aware tokens
        background: `radial-gradient(circle, var(--hero-orb-${color}) 0%, transparent 70%)`,
        filter: `blur(var(--hero-orb-blur))`,
        // GPU acceleration
        willChange: "transform",
        transform: "translate3d(0,0,0)",
      }}
      aria-hidden="true"
    />
  );
}

// Pre-defined orb configuration for deterministic SSR
// Per CONTEXT.md: Mix of brand colors (saffron, jade, ruby)
export const ORB_CONFIG_FAR: Omit<GradientOrbProps, "parallaxY">[] = [
  { color: "saffron", size: 300, x: "5%", y: "10%" },
  { color: "jade", size: 200, x: "80%", y: "60%" },
  { color: "ruby", size: 250, x: "60%", y: "5%" },
];

export const ORB_CONFIG_MID: Omit<GradientOrbProps, "parallaxY">[] = [
  { color: "ruby", size: 350, x: "15%", y: "50%" },
  { color: "saffron", size: 280, x: "70%", y: "20%" },
  { color: "jade", size: 180, x: "40%", y: "75%" },
];
```

Note: Orbs use CSS blur token which is larger in dark mode per tokens.css (60px light, 80px dark).
  </action>
  <verify>pnpm typecheck shows no errors in GradientOrb.tsx</verify>
  <done>GradientOrb component created with theme-aware glow tokens</done>
</task>

<task type="auto">
  <name>Task 3: Integrate emojis and orbs into Hero</name>
  <files>src/components/ui/homepage/Hero.tsx</files>
  <action>
Import and render floating emojis and gradient orbs in Hero layer containers.

1. Add imports at top:
```tsx
import { FloatingEmoji, EMOJI_CONFIG } from "./FloatingEmoji";
import { GradientOrb, ORB_CONFIG_FAR, ORB_CONFIG_MID } from "./GradientOrb";
import { useCanHover } from "@/lib/hooks/useResponsive";
```

2. Add mouse tracking state and handler for emoji repel effect:
```tsx
const canHover = useCanHover();
const [mouseOffset, setMouseOffset] = useState({ x: 0, y: 0 });

// Mouse repel effect - emojis shift away from cursor per CONTEXT.md
const handleMouseMove = useCallback((e: React.MouseEvent) => {
  if (!canHover || !containerRef.current) return;

  const rect = containerRef.current.getBoundingClientRect();
  const mouseX = (e.clientX - rect.left) / rect.width - 0.5;  // -0.5 to 0.5
  const mouseY = (e.clientY - rect.top) / rect.height - 0.5;

  // Subtle repel effect (max 20px offset)
  setMouseOffset({
    x: -mouseX * 20,
    y: -mouseY * 20,
  });
}, [canHover]);

const handleMouseLeave = useCallback(() => {
  setMouseOffset({ x: 0, y: 0 });
}, []);
```

3. Add onMouseMove and onMouseLeave to the Hero section element:
```tsx
<section
  ref={containerRef}
  id="hero"
  onMouseMove={canHover ? handleMouseMove : undefined}
  onMouseLeave={canHover ? handleMouseLeave : undefined}
  // ... rest of props
>
```

4. Replace the placeholder layer divs with actual components:

```tsx
{/* Layer 2: Background orbs (far) */}
<motion.div
  className="absolute inset-0 pointer-events-none"
  style={{ y: smoothOrbsFarY, zIndex: 1 }}
  aria-hidden="true"
>
  {ORB_CONFIG_FAR.map((orb, i) => (
    <GradientOrb key={`orb-far-${i}`} {...orb} />
  ))}
</motion.div>

{/* Layer 3: Mid-distance orbs */}
<motion.div
  className="absolute inset-0 pointer-events-none"
  style={{ y: smoothOrbsMidY, zIndex: 2 }}
  aria-hidden="true"
>
  {ORB_CONFIG_MID.map((orb, i) => (
    <GradientOrb key={`orb-mid-${i}`} {...orb} />
  ))}
</motion.div>

{/* Layer 4: Floating emojis */}
<motion.div
  className="absolute inset-0 pointer-events-none overflow-hidden"
  style={{
    y: smoothEmojisY,
    zIndex: 3,
    // Edge fading per CONTEXT.md
    maskImage: "linear-gradient(to bottom, transparent 0%, black 8%, black 92%, transparent 100%)",
    WebkitMaskImage: "linear-gradient(to bottom, transparent 0%, black 8%, black 92%, transparent 100%)",
  }}
  aria-hidden="true"
>
  {EMOJI_CONFIG.map((emoji, i) => (
    <FloatingEmoji
      key={`emoji-${i}`}
      {...emoji}
      index={i}
      mouseOffset={mouseOffset}
    />
  ))}
</motion.div>
```

5. Add required imports at top:
```tsx
import { useState, useCallback } from "react";
```
  </action>
  <verify>pnpm build succeeds and homepage shows floating emojis</verify>
  <done>Emojis and orbs integrated into Hero with mouse interaction and edge fading</done>
</task>

</tasks>

<verification>
1. Run: `pnpm typecheck` - no type errors
2. Run: `pnpm build` - build succeeds
3. Visual: Open homepage - see 13 floating emojis with varied sizes
4. Visual: Emojis have depth effects (far emojis slightly blurred)
5. Visual: Gradient orbs glow behind emojis
6. Visual: Scroll page - layers parallax at different speeds
7. Visual: Move mouse on desktop - emojis subtly shift away
8. Visual: Toggle theme - orb glows brighter in dark mode
9. A11y: Check that emojis have aria-hidden (decorative)
</verification>

<success_criteria>
- 13 floating emojis visible (matching EMOJI_CONFIG array)
- Emojis animate with three different motion types (drift, spiral, bob)
- Far emojis appear blurred and transparent
- Gradient orbs visible in background with soft glow
- Mouse movement causes subtle emoji repel on desktop
- Touch devices: autonomous floating only (no mouse handler)
- Reduced motion: emojis static (via shouldAnimate check)
- Build passes, no hydration errors
</success_criteria>

<output>
After completion, create `.planning/phases/31-hero-redesign/31-03-SUMMARY.md`
</output>
