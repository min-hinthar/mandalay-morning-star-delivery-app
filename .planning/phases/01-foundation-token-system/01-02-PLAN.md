---
phase: 01-foundation-token-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/gsap/index.ts
  - src/lib/gsap/presets.ts
autonomous: true

must_haves:
  truths:
    - "GSAP and @gsap/react are installed as dependencies"
    - "Components can import gsap, useGSAP, ScrollTrigger, SplitText, Flip, Observer from @/lib/gsap"
    - "GSAP presets map to existing motion-tokens.ts feel (snappy, bouncy, etc.)"
  artifacts:
    - path: "src/lib/gsap/index.ts"
      provides: "Centralized GSAP plugin registration and exports"
      exports: ["gsap", "useGSAP", "ScrollTrigger", "SplitText", "Flip", "Observer"]
    - path: "src/lib/gsap/presets.ts"
      provides: "GSAP timeline presets and easing tokens"
      exports: ["gsapEase", "gsapDuration", "gsapPresets"]
  key_links:
    - from: "src/lib/gsap/presets.ts"
      to: "src/lib/motion-tokens.ts"
      via: "Consistent animation feel"
      pattern: "snappy|bouncy|gentle"
    - from: "src/lib/gsap/index.ts"
      to: "gsap.registerPlugin"
      via: "Plugin registration"
      pattern: "registerPlugin"
---

<objective>
Install GSAP ecosystem and create centralized plugin registration with animation presets.

Purpose: Enable timeline choreography and scroll-driven animations via GSAP alongside existing Framer Motion for component interactions. Presets ensure consistent animation feel across both systems.
Output: GSAP dependencies installed, lib/gsap/ module with plugin registration and presets.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-token-system/01-RESEARCH.md
@src/lib/motion-tokens.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install GSAP dependencies</name>
  <files>package.json</files>
  <action>
Run:
```bash
pnpm add gsap @gsap/react
```

This installs:
- `gsap` - Core animation library with all plugins (now 100% free including ScrollTrigger, SplitText, Flip, Observer)
- `@gsap/react` - Official React integration with useGSAP hook for automatic cleanup

Do NOT install gsap-trial or any legacy packages. All plugins are bundled with gsap since the Webflow acquisition.
  </action>
  <verify>
`pnpm list gsap @gsap/react` shows both packages installed.
package.json has gsap and @gsap/react in dependencies.
  </verify>
  <done>
gsap and @gsap/react appear in package.json dependencies section.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GSAP plugin registration module</name>
  <files>src/lib/gsap/index.ts</files>
  <action>
Create directory `src/lib/gsap/` then create index.ts with centralized plugin registration.

```typescript
/**
 * GSAP Plugin Registration
 * Single point of registration for all GSAP plugins
 *
 * IMPORTANT: Import from @/lib/gsap, not directly from gsap
 * This ensures plugins are registered before use
 *
 * @example
 * import { gsap, useGSAP, ScrollTrigger } from "@/lib/gsap";
 */
"use client";

import gsap from "gsap";
import { useGSAP } from "@gsap/react";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { SplitText } from "gsap/SplitText";
import { Flip } from "gsap/Flip";
import { Observer } from "gsap/Observer";

// Register all plugins ONCE at module load
// This prevents "Plugin not registered" errors in production
gsap.registerPlugin(useGSAP, ScrollTrigger, SplitText, Flip, Observer);

// Global configuration for performance
gsap.config({
  autoSleep: 60, // Pause rendering when inactive for 60 frames
  force3D: true, // Use GPU acceleration where possible
  nullTargetWarn: false, // Suppress warnings for SSR (targets may not exist on server)
});

// Default animation settings matching motion-tokens feel
gsap.defaults({
  duration: 0.6, // Matches motion-tokens normal duration
  ease: "power2.out", // Smooth deceleration
});

// Re-export everything for single import point
export { gsap, useGSAP, ScrollTrigger, SplitText, Flip, Observer };

// Type exports for consumers
export type { GSAPCallback, GSAPTweenVars } from "gsap";
```

Key points:
- "use client" directive required (GSAP manipulates DOM)
- All plugins registered at module load time
- nullTargetWarn disabled for SSR compatibility
- Default duration and ease match motion-tokens
  </action>
  <verify>
`pnpm typecheck` passes.
Create a test component that imports from @/lib/gsap - should not error.
  </verify>
  <done>
File exists at src/lib/gsap/index.ts. Exports gsap, useGSAP, ScrollTrigger, SplitText, Flip, Observer.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create GSAP animation presets</name>
  <files>src/lib/gsap/presets.ts</files>
  <action>
Create presets.ts with GSAP-specific animation presets that map to the feel of motion-tokens.ts.

```typescript
/**
 * GSAP Animation Presets
 * Consistent with motion-tokens.ts feel but optimized for GSAP timelines
 *
 * @example
 * gsap.to(el, { ...gsapPresets.fadeIn });
 * gsap.to(el, { duration: gsapDuration.fast, ease: gsapEase.snappy });
 */
"use client";

// ============================================
// DURATION TOKENS (match motion-tokens.ts)
// ============================================

export const gsapDuration = {
  /** Micro-interactions: toggles, taps */
  micro: 0.08,
  /** Fast interactions: buttons, links */
  fast: 0.12,
  /** Normal transitions: most animations */
  normal: 0.18,
  /** Slow transitions: emphasis, reveals */
  slow: 0.28,
  /** Dramatic moments: celebrations, hero */
  dramatic: 0.4,
  /** Extra slow: special effects */
  epic: 0.6,
} as const;

// ============================================
// EASING TOKENS (GSAP equivalents of motion-tokens)
// ============================================

export const gsapEase = {
  /** Default - smooth deceleration (matches motion-tokens default) */
  default: "power2.out",
  /** Out - dramatic deceleration */
  out: "power3.out",
  /** In - building momentum */
  in: "power2.in",
  /** In-out - smooth both ends */
  inOut: "power2.inOut",
  /** Snappy - quick response (matches spring.snappy feel) */
  snappy: "power2.out",
  /** Bouncy - overshoot ending (matches spring.ultraBouncy feel) */
  bouncy: "back.out(1.7)",
  /** Rubbery - elastic feel (matches spring.rubbery) */
  rubbery: "elastic.out(1, 0.5)",
  /** Gentle - no overshoot (matches spring.gentle) */
  gentle: "power1.out",
  /** Wobbly - pronounced wobble (matches spring.wobbly) */
  wobbly: "elastic.out(1, 0.3)",
  /** Dramatic - big movements */
  dramatic: "back.out(2)",
} as const;

// ============================================
// ANIMATION PRESETS (common patterns)
// ============================================

export const gsapPresets = {
  /** Fade in */
  fadeIn: {
    opacity: 0,
    duration: gsapDuration.normal,
    ease: gsapEase.default,
  },

  /** Slide up with fade */
  slideUp: {
    y: 24,
    opacity: 0,
    duration: gsapDuration.normal,
    ease: gsapEase.default,
  },

  /** Slide down with fade */
  slideDown: {
    y: -24,
    opacity: 0,
    duration: gsapDuration.normal,
    ease: gsapEase.default,
  },

  /** Scale in */
  scaleIn: {
    scale: 0.9,
    opacity: 0,
    duration: gsapDuration.normal,
    ease: gsapEase.default,
  },

  /** Pop in with bounce */
  popIn: {
    scale: 0.7,
    opacity: 0,
    duration: gsapDuration.slow,
    ease: gsapEase.bouncy,
  },

  /** Text reveal (for use with SplitText) */
  textReveal: {
    y: 40,
    opacity: 0,
    duration: gsapDuration.slow,
    ease: gsapEase.default,
    stagger: 0.02,
  },

  /** Stagger defaults */
  stagger: {
    fast: 0.03,
    normal: 0.06,
    slow: 0.1,
  },
} as const;

// ============================================
// SCROLL TRIGGER PRESETS
// ============================================

export const scrollTriggerPresets = {
  /** Standard fade up on scroll */
  fadeUp: {
    trigger: undefined as unknown, // Set per-use
    start: "top 80%",
    toggleActions: "play none none reverse",
  },

  /** Scrub animation (follows scroll) */
  scrub: {
    trigger: undefined as unknown,
    start: "top bottom",
    end: "bottom top",
    scrub: 1,
  },

  /** Pin element during scroll */
  pin: {
    trigger: undefined as unknown,
    start: "top top",
    end: "+=500",
    pin: true,
    scrub: 1,
  },
} as const;

// ============================================
// TIMELINE FACTORY HELPERS
// ============================================

/**
 * Create stagger delay for index
 */
export function staggerDelay(
  index: number,
  baseDelay = 0.06,
  maxDelay = 0.5
): number {
  return Math.min(index * baseDelay, maxDelay);
}

/**
 * Common timeline labels
 */
export const timelineLabels = {
  start: "start",
  middle: "middle",
  end: "end",
  overlap: "-=0.3", // Overlap previous animation by 0.3s
  after: "+=0.1", // Start 0.1s after previous
} as const;
```

Key points:
- Duration values match motion-tokens.ts exactly
- Easing names map to spring presets by feel (snappy, bouncy, etc.)
- Presets use "from" values (animate FROM these values TO current state)
- ScrollTrigger presets have trigger: undefined placeholder
  </action>
  <verify>
`pnpm typecheck` passes.
Import test: `import { gsapEase, gsapDuration, gsapPresets } from "@/lib/gsap/presets"` resolves.
  </verify>
  <done>
File exists at src/lib/gsap/presets.ts. Exports gsapEase, gsapDuration, gsapPresets, scrollTriggerPresets.
  </done>
</task>

</tasks>

<verification>
1. `pnpm list gsap @gsap/react` shows packages installed
2. `pnpm typecheck` passes without errors
3. `pnpm build` passes (GSAP imports resolve, client directive works)
4. No console errors about unregistered plugins in dev server
</verification>

<success_criteria>
- GSAP and @gsap/react installed in package.json dependencies
- lib/gsap/index.ts exports all plugins with registration
- lib/gsap/presets.ts provides consistent animation tokens
- Build and typecheck pass without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-token-system/01-02-SUMMARY.md`
</output>
