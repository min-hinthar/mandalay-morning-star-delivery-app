---
phase: 01-foundation-token-system
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - eslint.config.mjs
  - .planning/phases/01-foundation-token-system/Z-INDEX-MIGRATION.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "pnpm lint passes (no errors blocking build)"
    - "Z-index rules remain active at warn level for legacy code awareness"
    - "Migration tracking document lists all files needing future migration"
  artifacts:
    - path: "eslint.config.mjs"
      provides: "Z-index rules at warn severity with legacy file exceptions"
      contains: "warn"
    - path: ".planning/phases/01-foundation-token-system/Z-INDEX-MIGRATION.md"
      provides: "Migration tracking for legacy z-index violations"
      contains: "FloatingFood.tsx"
  key_links:
    - from: "eslint.config.mjs"
      to: "z-index token system"
      via: "Rules still reference docs and suggest tokens"
      pattern: "docs/STACKING-CONTEXT.md"
---

<objective>
Enable build to pass while preserving z-index enforcement for new code.

Purpose: Legacy codebase has 50+ z-index violations blocking build. Phased migration approach: downgrade to warn, document migration needs, upgrade back to error when components are rebuilt in later phases.

Output: Passing build with z-index rules at warn level and migration tracking document.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-token-system/01-VERIFICATION.md

@eslint.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Downgrade z-index ESLint rules to warn</name>
  <files>eslint.config.mjs</files>
  <action>
Change the z-index related no-restricted-syntax rules from "error" to "warn".

In the Design Token Enforcement Rules section (lines 41-74):
1. Change the first "error" on line 45 to "warn"
2. Keep all three z-index selectors (z-[number], z-* numeric, inline zIndex)
3. Keep the error messages unchanged (they still reference docs/STACKING-CONTEXT.md)
4. Leave color rules at "error" level (those are separate)

Structure should be:
```javascript
{
  files: ["src/components/**/*.tsx", "src/app/**/*.tsx"],
  rules: {
    "no-restricted-syntax": [
      "warn",  // Changed from "error"
      // ... z-index selectors stay the same
    ],
  },
},
```

Rationale: warn allows build to pass while still flagging violations in lint output. New code additions will see warnings. Components rebuilt in Phase 2-4 will be migrated naturally.
  </action>
  <verify>
1. `pnpm lint` completes without error exit code
2. `pnpm lint 2>&1 | grep -c "warning"` shows warnings still appear
3. Z-index violations visible in output but don't block
  </verify>
  <done>
Build passes. Z-index rules active at warn level.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create migration tracking document</name>
  <files>.planning/phases/01-foundation-token-system/Z-INDEX-MIGRATION.md</files>
  <action>
Create a migration tracking document listing all files with z-index violations.

Content structure:
```markdown
# Z-Index Migration Tracker

**Status:** Pending (rules at warn level)
**Target:** Upgrade to error after Phase 4 (Overlay System)

## Migration Strategy

Files will be migrated when they are touched during their respective phases:
- Phase 2 (Navigation): nav components
- Phase 3 (Menu Animations): menu components
- Phase 4 (Overlay System): modals, dropdowns

## Files Requiring Migration

### Inline zIndex (style objects) - Use zIndex.* tokens

| File | Count | Phase |
|------|-------|-------|
| src/components/homepage/FloatingFood.tsx | 6 | 3 |
| src/components/cart/CartAnimations.tsx | 1 | 4 |

### Tailwind z-* Classes - Use z-{token} classes

| File | Count | Phase |
|------|-------|-------|
| src/components/auth/WelcomeAnimation.tsx | 1 | 2 |
| src/components/checkout/TimeSlotPicker.tsx | 2 | 4 |
| src/components/driver/PhotoCapture.tsx | 1 | N/A (driver) |
| src/components/homepage/CoverageSection.tsx | 2 | 3 |
| src/components/homepage/Hero.tsx | 5 | 3 |
| src/components/homepage/HomepageHero.tsx | 2 | 3 |
| src/components/homepage/HomepageMenuSection.tsx | 1 | 3 |
| src/components/homepage/HowItWorksTimeline.tsx | 2 | 3 |
| src/components/homepage/TestimonialsSection.tsx | 1 | 3 |
| src/components/homepage/Timeline.tsx | 1 | 3 |
| src/components/layout/footer.tsx | 2 | 2 |
| src/components/menu/CategoryCarousel.tsx | 4 | 3 |
| src/components/menu/ItemDetail.tsx | 1 | 3 |
| src/components/menu/MenuItemCard.tsx | 4 | 3 |
| src/components/menu/MenuLayout.tsx | 1 | 3 |
| src/components/menu/category-tabs.tsx | 3 | 3 |
| src/components/menu/item-detail-modal.tsx | 2 | 4 |
| src/components/menu/menu-item-card.tsx | 3 | 3 |
| src/components/menu/menu-skeleton.tsx | 1 | 3 |
| src/components/tracking/DeliveryMap.tsx | 4 | N/A (driver) |

## Completion Checklist

After Phase 4 completion:
- [ ] Run `pnpm lint` to check remaining violations
- [ ] Migrate any remaining files
- [ ] Update eslint.config.mjs to "error" level
- [ ] Delete this tracking document

---
*Created: [date]*
*Last updated: [date]*
```

Run `pnpm lint 2>&1` to capture actual file list and counts.
  </action>
  <verify>
File exists at .planning/phases/01-foundation-token-system/Z-INDEX-MIGRATION.md
Contains table with files and violation counts
  </verify>
  <done>
Migration tracker created with all legacy violations documented and phase assignments.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify full build pipeline passes</name>
  <files>N/A (verification only)</files>
  <action>
Run the full verification command to ensure build passes:

```bash
pnpm lint && pnpm lint:css && pnpm typecheck && pnpm build
```

All commands should complete with exit code 0.

If any fail:
- lint: Should pass now with warnings (not errors)
- lint:css: Check .stylelintrc.json for issues
- typecheck: Check for TypeScript errors
- build: Check Next.js build output
  </action>
  <verify>
`pnpm lint && pnpm lint:css && pnpm typecheck && pnpm build` exits with code 0
  </verify>
  <done>
Full build pipeline passes. Phase 1 foundation is complete and unblocked.
  </done>
</task>

</tasks>

<verification>
1. `pnpm lint` exits 0 (warnings allowed, errors blocked)
2. `pnpm build` succeeds
3. Z-INDEX-MIGRATION.md exists with file list
4. Future: After Phase 4, upgrade rules back to error
</verification>

<success_criteria>
- pnpm lint passes (exit code 0)
- pnpm build passes (exit code 0)
- Migration tracking document lists all 20+ files needing migration
- ESLint config has z-index rules at "warn" level
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-token-system/01-05-SUMMARY.md`
</output>
