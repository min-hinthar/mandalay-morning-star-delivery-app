---
phase: 03-navigation-layout
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ui-v8/navigation/BottomNav.tsx
  - src/components/ui-v8/navigation/MobileMenu.tsx
  - src/components/ui-v8/navigation/index.ts
autonomous: true

must_haves:
  truths:
    - "Mobile bottom navigation shows on small screens"
    - "Bottom nav has active state indicators with animation"
    - "Mobile menu closes automatically when user taps a navigation link"
    - "Mobile menu slides in from left with smooth animation and backdrop"
  artifacts:
    - path: "src/components/ui-v8/navigation/BottomNav.tsx"
      provides: "Mobile bottom navigation"
      exports: ["BottomNav", "BottomNavProps"]
    - path: "src/components/ui-v8/navigation/MobileMenu.tsx"
      provides: "Slide-out mobile menu using Drawer"
      exports: ["MobileMenu", "MobileMenuProps"]
  key_links:
    - from: "BottomNav.tsx"
      to: "usePathname"
      via: "active state detection"
      pattern: "usePathname"
    - from: "BottomNav.tsx"
      to: "motion layoutId"
      via: "animated indicator"
      pattern: "layoutId.*bottomNavIndicator"
    - from: "MobileMenu.tsx"
      to: "useRouteChangeClose"
      via: "hook import"
      pattern: "useRouteChangeClose"
    - from: "MobileMenu.tsx"
      to: "Drawer"
      via: "component import"
      pattern: "import.*Drawer.*from"
---

<objective>
Create mobile bottom navigation and slide-out mobile menu with automatic route-change close.

Purpose: Deliver mobile navigation patterns - a persistent bottom nav with active indicators and a hamburger-triggered side menu that closes automatically when the user navigates.

Output: BottomNav.tsx, MobileMenu.tsx
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-layout/03-RESEARCH.md
@src/components/ui-v8/Drawer.tsx
@src/lib/hooks/useRouteChangeClose.ts
@src/lib/motion-tokens.ts
@src/design-system/tokens/z-index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BottomNav component</name>
  <files>src/components/ui-v8/navigation/BottomNav.tsx</files>
  <action>
Create BottomNav component with these props:
- `items?: BottomNavItem[]` - nav items (default: Home, Menu, Orders, Account)
- `className?: string`

BottomNavItem type:
```typescript
interface BottomNavItem {
  href: string;
  label: string;
  icon: React.ReactNode;
}
```

Default items (use lucide-react icons):
- { href: "/", label: "Home", icon: Home }
- { href: "/menu", label: "Menu", icon: UtensilsCrossed }
- { href: "/orders", label: "Orders", icon: Package }
- { href: "/account", label: "Account", icon: User }

Implementation:

1. **Active state detection** using usePathname():
```typescript
const isActive = pathname === item.href ||
  (item.href !== "/" && pathname.startsWith(item.href));
```

2. **Animated active indicator** using layoutId:
```typescript
{isActive && (
  <motion.span
    layoutId="bottomNavIndicator"
    className="absolute bottom-1 h-0.5 w-6 rounded-full bg-primary"
    transition={spring.snappy}
  />
)}
```

3. **Icon scale animation** on active:
```typescript
<motion.span
  animate={shouldAnimate ? { scale: isActive ? 1.1 : 1 } : {}}
  className={isActive ? "text-primary" : "text-muted-foreground"}
>
  <Icon className="w-5 h-5" />
</motion.span>
```

4. **Container styling**:
- `fixed bottom-0 left-0 right-0 z-fixed`
- `bg-background/95 backdrop-blur-lg`
- `border-t border-border/50`
- `md:hidden` - only show on mobile
- `style={{ paddingBottom: "env(safe-area-inset-bottom)" }}` - iOS safe area

5. **Layout**: flex justify-around, h-16 items-center

6. **Use useAnimationPreference** for reduced motion support

Mark as "use client".
  </action>
  <verify>
- File exists at src/components/ui-v8/navigation/BottomNav.tsx
- Uses usePathname for active detection
- Uses layoutId="bottomNavIndicator" for animated indicator
- Has z-fixed class
- Has md:hidden class (mobile only)
- Has iOS safe area padding
  </verify>
  <done>
- BottomNav renders fixed at bottom on mobile only
- Active state shows animated indicator
- Icons scale on active state
- iOS safe area respected
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MobileMenu component</name>
  <files>src/components/ui-v8/navigation/MobileMenu.tsx</files>
  <action>
Create MobileMenu component using Drawer from Phase 2:

Props:
- `isOpen: boolean`
- `onClose: () => void`
- `navItems: { href: string; label: string; icon?: React.ReactNode }[]`
- `className?: string`

Implementation:

1. **Auto-close on route change** using useRouteChangeClose:
```typescript
useRouteChangeClose(isOpen, onClose);
```

2. **Use Drawer component** from Phase 2:
```typescript
import { Drawer } from "@/components/ui-v8/Drawer";

<Drawer
  isOpen={isOpen}
  onClose={onClose}
  side="left"
  size="sm"
  title="Menu"
>
  {/* nav content */}
</Drawer>
```

3. **Navigation items**: Render as Link components with onClick={onClose} for immediate close:
```typescript
<Link
  href={item.href}
  onClick={onClose}
  className={cn(
    "flex items-center gap-3 px-4 py-3 rounded-lg",
    "hover:bg-accent transition-colors",
    isActive && "bg-accent text-primary"
  )}
>
  {item.icon}
  <span>{item.label}</span>
</Link>
```

4. **Active state** using usePathname()

5. **Additional sections** (optional slots):
- User greeting at top (if user prop provided)
- Divider
- Secondary links (Settings, Help, Sign Out)

Mark as "use client".
  </action>
  <verify>
- File exists at src/components/ui-v8/navigation/MobileMenu.tsx
- Imports and uses Drawer from @/components/ui-v8/Drawer
- Uses useRouteChangeClose hook
- Links have onClick={onClose} for immediate close
- Uses usePathname for active state
  </verify>
  <done>
- MobileMenu renders as left-side Drawer
- Closes automatically on route change (via useRouteChangeClose)
- Closes immediately on link click (via onClick)
- Shows active state for current route
  </done>
</task>

<task type="auto">
  <name>Task 3: Update navigation barrel export</name>
  <files>src/components/ui-v8/navigation/index.ts</files>
  <action>
Add BottomNav and MobileMenu exports to the existing barrel file:

```typescript
export { BottomNav, type BottomNavProps, type BottomNavItem } from "./BottomNav";
export { MobileMenu, type MobileMenuProps } from "./MobileMenu";
```

Place after existing exports.
  </action>
  <verify>
- BottomNav, BottomNavProps, BottomNavItem exported
- MobileMenu, MobileMenuProps exported
- pnpm typecheck passes
  </verify>
  <done>
- All navigation components importable from @/components/ui-v8/navigation
  </done>
</task>

</tasks>

<verification>
```bash
# Type check
pnpm typecheck

# Verify BottomNav uses pathname
grep "usePathname" src/components/ui-v8/navigation/BottomNav.tsx

# Verify BottomNav has layoutId indicator
grep "layoutId" src/components/ui-v8/navigation/BottomNav.tsx

# Verify MobileMenu uses route change close
grep "useRouteChangeClose" src/components/ui-v8/navigation/MobileMenu.tsx

# Verify MobileMenu uses Drawer
grep "Drawer" src/components/ui-v8/navigation/MobileMenu.tsx

# Verify z-fixed used (not hardcoded)
! grep -E "z-\d+|z-\[" src/components/ui-v8/navigation/BottomNav.tsx || echo "Found hardcoded z-index - FIX"
```
</verification>

<success_criteria>
- BottomNav is fixed at bottom, mobile only (md:hidden)
- BottomNav has animated active indicator with layoutId
- BottomNav respects iOS safe area inset
- MobileMenu uses Drawer component from Phase 2
- MobileMenu closes automatically on route change via useRouteChangeClose
- MobileMenu closes immediately on nav link click
- All components use z-fixed token (no hardcoded z-index)
- pnpm typecheck passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-layout/03-03-SUMMARY.md`
</output>
