---
phase: 03-navigation-layout
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ui-v8/navigation/Header.tsx
  - src/components/ui-v8/navigation/index.ts
autonomous: true

must_haves:
  truths:
    - "Header is sticky at top of viewport"
    - "All header buttons (cart, profile, menu) are clickable"
    - "Header shrinks and blurs subtly when user scrolls down"
    - "Header hides on scroll down, shows on scroll up"
  artifacts:
    - path: "src/components/ui-v8/navigation/Header.tsx"
      provides: "Sticky header with scroll effects"
      exports: ["Header", "HeaderProps"]
  key_links:
    - from: "Header.tsx"
      to: "useScrollDirection"
      via: "hook import"
      pattern: "useScrollDirection.*threshold"
    - from: "Header.tsx"
      to: "z-fixed"
      via: "className"
      pattern: "z-fixed"
    - from: "Header.tsx"
      to: "framer-motion"
      via: "motion.header animate"
      pattern: "motion\\.header"
---

<objective>
Create the sticky header component with scroll-aware shrink and blur effects.

Purpose: Deliver a polished header that stays accessible while scrolling, shrinks to reduce visual weight when scrolled, and uses subtle blur for depth. Ensures cart, profile, and menu buttons are always clickable.

Output: Header.tsx with scroll effects integrated
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-layout/03-RESEARCH.md
@src/lib/hooks/useScrollDirection.ts
@src/lib/motion-tokens.ts
@src/design-system/tokens/z-index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Header component with scroll effects</name>
  <files>src/components/ui-v8/navigation/Header.tsx</files>
  <action>
Create Header component with these props:
- `logo?: React.ReactNode` - logo element (default: text "Morning Star")
- `navItems?: { href: string; label: string; icon?: React.ReactNode }[]` - desktop nav links
- `rightContent?: React.ReactNode` - slot for cart button, profile dropdown
- `onMenuClick?: () => void` - hamburger menu click handler
- `className?: string`

Implementation details:

1. **Scroll detection** using useScrollDirection:
```typescript
const { isCollapsed, scrollY, isAtTop } = useScrollDirection({ threshold: 50 });
```

2. **Animation states** using useAnimationPreference:
- When isAtTop: height 72px, bg opacity 0.6, blur 8px
- When scrolled: height 56px, bg opacity 0.95, blur 16px
- When isCollapsed (scrolling down): translate -72px (hide)
- When scrolling up: show header

3. **Structure**:
```
<motion.header
  animate={{ y: isCollapsed ? -72 : 0, height: isAtTop ? 72 : 56 }}
  style={{ backgroundColor: rgba, backdropFilter: blur }}
  className="fixed top-0 left-0 right-0 z-fixed border-b border-border/50"
>
  <div className="flex items-center justify-between h-full px-4 max-w-7xl mx-auto">
    {/* Mobile: hamburger, logo, cart */}
    {/* Desktop: logo, nav links, right content */}
  </div>
</motion.header>
```

4. **Mobile layout** (below md):
- Left: Hamburger button (Menu icon from lucide-react)
- Center: Logo
- Right: Cart button slot (from rightContent)

5. **Desktop layout** (md and above):
- Left: Logo
- Center: Nav links with hover effects
- Right: rightContent (cart, profile)

6. **Z-index**: Use `z-fixed` from zClass (NOT hardcoded)

7. **iOS safe area**: Add `pt-safe` or `top: env(safe-area-inset-top)`

8. **Spring config**: Use spring.snappy from motion-tokens for animations

Mark as "use client" - uses hooks and motion.
  </action>
  <verify>
- File exists at src/components/ui-v8/navigation/Header.tsx
- Uses useScrollDirection hook with threshold: 50
- Uses z-fixed class (not hardcoded z-index)
- Uses motion.header for animations
- Has responsive layout (hamburger mobile, nav desktop)
  </verify>
  <done>
- Header renders fixed at top with z-fixed
- Shrinks from 72px to 56px on scroll
- Hides on scroll down, shows on scroll up
- Backdrop blur increases when scrolled
- Mobile hamburger and desktop nav layouts work
  </done>
</task>

<task type="auto">
  <name>Task 2: Update navigation barrel export</name>
  <files>src/components/ui-v8/navigation/index.ts</files>
  <action>
Add Header export to the existing barrel file:

```typescript
export { Header, type HeaderProps } from "./Header";
```

Place after existing AppShell and PageContainer exports.
  </action>
  <verify>
- Header and HeaderProps exported from navigation/index.ts
- pnpm typecheck passes
  </verify>
  <done>
- Header importable from @/components/ui-v8/navigation
  </done>
</task>

</tasks>

<verification>
```bash
# Type check
pnpm typecheck

# Verify Header uses scroll direction hook
grep -l "useScrollDirection" src/components/ui-v8/navigation/Header.tsx

# Verify z-fixed used (not hardcoded)
grep "z-fixed" src/components/ui-v8/navigation/Header.tsx
! grep -E "z-\d+|z-\[" src/components/ui-v8/navigation/Header.tsx || echo "Found hardcoded z-index - FIX"

# Verify motion.header for animations
grep "motion.header" src/components/ui-v8/navigation/Header.tsx
```
</verification>

<success_criteria>
- Header is fixed at top with z-fixed token
- useScrollDirection controls collapse state with threshold 50
- Header animates height (72px -> 56px) on scroll
- Header hides on scroll down (y: -72), shows on scroll up (y: 0)
- Backdrop blur increases when scrolled (8px -> 16px)
- Mobile shows hamburger + logo + cart; desktop shows logo + nav + cart
- pnpm typecheck passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-layout/03-02-SUMMARY.md`
</output>
