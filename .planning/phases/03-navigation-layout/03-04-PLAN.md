---
phase: 03-navigation-layout
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui-v8/scroll/ScrollChoreographer.tsx
  - src/components/ui-v8/scroll/RevealOnScroll.tsx
  - src/components/ui-v8/scroll/ParallaxLayer.tsx
  - src/components/ui-v8/scroll/index.ts
  - src/components/ui-v8/transitions/PageTransitionV8.tsx
  - src/components/ui-v8/transitions/index.ts
autonomous: true

must_haves:
  truths:
    - "GSAP scroll choreography patterns are available for scroll-triggered animations"
    - "Page transitions animate smoothly between routes without layout shift"
    - "Scroll reveal components work with useGSAP for proper cleanup"
    - "Parallax effects available for creative page layouts"
  artifacts:
    - path: "src/components/ui-v8/scroll/ScrollChoreographer.tsx"
      provides: "GSAP ScrollTrigger orchestration"
      exports: ["ScrollChoreographer", "ScrollChoreographerProps"]
    - path: "src/components/ui-v8/scroll/RevealOnScroll.tsx"
      provides: "Scroll-triggered reveal component"
      exports: ["RevealOnScroll", "RevealOnScrollProps"]
    - path: "src/components/ui-v8/scroll/ParallaxLayer.tsx"
      provides: "Parallax scroll effects"
      exports: ["ParallaxLayer", "ParallaxLayerProps"]
    - path: "src/components/ui-v8/scroll/index.ts"
      provides: "Barrel export for scroll components"
    - path: "src/components/ui-v8/transitions/PageTransitionV8.tsx"
      provides: "Enhanced V8 page transitions"
      exports: ["PageTransitionV8", "PageTransitionV8Props"]
    - path: "src/components/ui-v8/transitions/index.ts"
      provides: "Barrel export for transition components"
  key_links:
    - from: "ScrollChoreographer.tsx"
      to: "@/lib/gsap"
      via: "useGSAP hook"
      pattern: "useGSAP.*scope"
    - from: "RevealOnScroll.tsx"
      to: "ScrollTrigger"
      via: "GSAP import"
      pattern: "ScrollTrigger"
    - from: "PageTransitionV8.tsx"
      to: "AnimatePresence"
      via: "framer-motion"
      pattern: "AnimatePresence.*mode.*wait"
---

<objective>
Create GSAP scroll choreography components and enhanced page transitions.

Purpose: Deliver the creative effects system - scroll-triggered reveals, parallax layers, and page transitions that make the app feel "delightfully alive with motion" per the project vision.

Output: scroll/ components (ScrollChoreographer, RevealOnScroll, ParallaxLayer), transitions/ components (PageTransitionV8)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-layout/03-RESEARCH.md
@src/lib/gsap/index.ts
@src/lib/gsap/presets.ts
@src/components/layouts/PageTransition.tsx
@src/lib/motion-tokens.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scroll choreography components</name>
  <files>
    src/components/ui-v8/scroll/ScrollChoreographer.tsx
    src/components/ui-v8/scroll/RevealOnScroll.tsx
    src/components/ui-v8/scroll/ParallaxLayer.tsx
    src/components/ui-v8/scroll/index.ts
  </files>
  <action>
Create scroll directory with three components:

**1. ScrollChoreographer.tsx**
Container that orchestrates GSAP ScrollTrigger animations for children.

Props:
- `children: React.ReactNode`
- `className?: string`
- `stagger?: number` - stagger delay between items (default: 0.06)
- `selector?: string` - CSS selector for animated items (default: ".scroll-item")

Implementation:
```typescript
import { gsap, useGSAP, ScrollTrigger } from "@/lib/gsap";
import { gsapPresets, gsapDuration, gsapEase } from "@/lib/gsap/presets";

const containerRef = useRef<HTMLDivElement>(null);

useGSAP(() => {
  const items = gsap.utils.toArray<HTMLElement>(selector);

  items.forEach((item, i) => {
    gsap.from(item, {
      y: 40,
      opacity: 0,
      duration: gsapDuration.normal,
      ease: gsapEase.default,
      delay: i * stagger,
      scrollTrigger: {
        trigger: item,
        start: "top 85%",
        toggleActions: "play none none reverse",
      },
    });
  });
}, { scope: containerRef });
```

**2. RevealOnScroll.tsx**
Individual reveal component wrapping any content.

Props:
- `children: React.ReactNode`
- `className?: string`
- `direction?: 'up' | 'down' | 'left' | 'right'` - reveal direction (default: 'up')
- `delay?: number` - animation delay (default: 0)
- `distance?: number` - travel distance in px (default: 40)
- `duration?: number` - animation duration (default: gsapDuration.normal)
- `once?: boolean` - animate only once (default: true)

Implementation using useGSAP with scope for proper cleanup.

**3. ParallaxLayer.tsx**
Parallax speed layer for background elements.

Props:
- `children: React.ReactNode`
- `className?: string`
- `speed?: number` - parallax speed 0-1 (default: 0.5)
- `direction?: 'vertical' | 'horizontal'` - parallax direction (default: 'vertical')

Implementation using GSAP scrub ScrollTrigger:
```typescript
useGSAP(() => {
  gsap.to(elementRef.current, {
    yPercent: direction === 'vertical' ? -speed * 30 : 0,
    xPercent: direction === 'horizontal' ? -speed * 30 : 0,
    ease: "none",
    scrollTrigger: {
      trigger: containerRef.current,
      start: "top bottom",
      end: "bottom top",
      scrub: 1,
    },
  });
}, { scope: containerRef });
```

**4. index.ts** barrel export:
```typescript
export { ScrollChoreographer, type ScrollChoreographerProps } from "./ScrollChoreographer";
export { RevealOnScroll, type RevealOnScrollProps } from "./RevealOnScroll";
export { ParallaxLayer, type ParallaxLayerProps } from "./ParallaxLayer";
```

All components marked "use client" - require browser APIs.
  </action>
  <verify>
- All four files exist in src/components/ui-v8/scroll/
- All use useGSAP with scope for cleanup
- All import from @/lib/gsap (not directly from gsap)
- Barrel export includes all components
  </verify>
  <done>
- ScrollChoreographer orchestrates staggered scroll animations
- RevealOnScroll provides individual reveal with direction options
- ParallaxLayer enables parallax effects
- All properly clean up on unmount via useGSAP scope
  </done>
</task>

<task type="auto">
  <name>Task 2: Create enhanced PageTransitionV8 component</name>
  <files>
    src/components/ui-v8/transitions/PageTransitionV8.tsx
    src/components/ui-v8/transitions/index.ts
  </files>
  <action>
Create transitions directory with PageTransitionV8:

**PageTransitionV8.tsx**
Enhanced page transitions building on existing PageTransition patterns.

Props:
- `children: React.ReactNode`
- `variant?: 'fade' | 'slide' | 'morph' | 'reveal' | 'scale'` - transition type (default: 'slide')
- `className?: string`
- `preserveScroll?: boolean` - maintain scroll position (default: false)

Key differences from existing PageTransition:
1. Uses V8 motion tokens (spring.default, spring.snappy)
2. Adds 'morph' variant with blur + scale for premium feel
3. Ensures no layout shift (min-h-screen on container)
4. Respects useAnimationPreference

Implementation pattern:
```typescript
import { usePathname } from "next/navigation";
import { motion, AnimatePresence } from "framer-motion";
import { spring, duration, easing } from "@/lib/motion-tokens";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

// Use pathname as key for AnimatePresence
const pathname = usePathname();

<AnimatePresence mode="wait" initial={false}>
  <motion.div
    key={pathname}
    variants={getVariants(variant)}
    initial="initial"
    animate="animate"
    exit="exit"
    className={cn("min-h-screen", className)}
  >
    {children}
  </motion.div>
</AnimatePresence>
```

Variants should use spring for entrance, fast duration for exit (per Phase 2 pattern: "overlayMotion uses spring for open, duration for close").

**index.ts** barrel export:
```typescript
export { PageTransitionV8, type PageTransitionV8Props } from "./PageTransitionV8";
// Re-export existing PageTransition for compatibility
export { PageTransition, type PageTransitionProps } from "@/components/layouts/PageTransition";
```

Mark as "use client".
  </action>
  <verify>
- Both files exist in src/components/ui-v8/transitions/
- PageTransitionV8 uses AnimatePresence with mode="wait"
- Uses usePathname as key
- Uses motion tokens from @/lib/motion-tokens
- Respects useAnimationPreference
  </verify>
  <done>
- PageTransitionV8 provides smooth route transitions
- No layout shift (min-h-screen)
- Multiple variants available
- Compatible with existing PageTransition API
  </done>
</task>

</tasks>

<verification>
```bash
# Type check
pnpm typecheck

# Verify GSAP imports from @/lib/gsap (not direct)
grep "from.*@/lib/gsap" src/components/ui-v8/scroll/*.tsx
! grep "from \"gsap\"" src/components/ui-v8/scroll/*.tsx || echo "Found direct gsap import - FIX"

# Verify useGSAP with scope
grep "useGSAP.*scope" src/components/ui-v8/scroll/*.tsx

# Verify AnimatePresence in PageTransitionV8
grep "AnimatePresence" src/components/ui-v8/transitions/PageTransitionV8.tsx

# Verify usePathname used as key
grep "usePathname" src/components/ui-v8/transitions/PageTransitionV8.tsx

# Full build test
pnpm build
```
</verification>

<success_criteria>
- ScrollChoreographer orchestrates staggered scroll animations
- RevealOnScroll reveals content from any direction on scroll
- ParallaxLayer enables parallax scroll effects with configurable speed
- All scroll components use useGSAP with scope for proper cleanup
- GSAP imported from @/lib/gsap (never direct gsap import)
- PageTransitionV8 animates route changes without layout shift
- PageTransitionV8 uses pathname as AnimatePresence key
- All components respect useAnimationPreference for reduced motion
- pnpm typecheck and pnpm build pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-layout/03-04-SUMMARY.md`
</output>
