---
phase: 29-token-enforcement-effects
plan: 03
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - src/app/globals.css
  - src/components/ui/search/CommandPalette/CommandPalette.tsx
  - src/components/ui/navigation/Header.tsx
  - src/components/ui/Modal.tsx
autonomous: true

must_haves:
  truths:
    - "All hardcoded blur values in globals.css use CSS variables"
    - "Inline backdropFilter styles use var(--blur-*) tokens"
    - "Dynamic blur calculations document their token basis"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Glassmorphism classes using blur tokens"
      contains: "var(--blur-"
    - path: "src/components/ui/search/CommandPalette/CommandPalette.tsx"
      provides: "Command palette with tokenized backdrop blur"
  key_links:
    - from: "globals.css"
      to: "tokens.css"
      via: "CSS variable reference"
      pattern: "var\\(--blur-"
---

<objective>
Migrate all hardcoded blur values to use design system tokens.

Purpose: Standardize blur values across the application for consistent glassmorphism effects. The 4 hardcoded blur values in globals.css and inline styles should use the new --blur-* tokens.

Output:
- globals.css glassmorphism classes use var(--blur-*) tokens
- Inline backdropFilter styles reference blur tokens
- Dynamic blur calculations document their token equivalents
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/29-token-enforcement-effects/29-01-SUMMARY.md
@.planning/phases/29-token-enforcement-effects/29-RESEARCH.md
@src/app/globals.css
@src/styles/tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate globals.css blur values to CSS variable tokens</name>
  <files>src/app/globals.css</files>
  <action>
Search for all `blur(Npx)` patterns in globals.css and replace with CSS variable references.

**Migrations based on RESEARCH.md findings:**

`blur(12px)` -> `blur(var(--blur-lg))`
`blur(30px)` -> `blur(var(--blur-2xl))`
`blur(36px)` -> `blur(var(--blur-3xl))`
`blur(8px)` -> `blur(var(--blur-md))`

For each occurrence, update both backdrop-filter and -webkit-backdrop-filter:

```css
/* BEFORE */
backdrop-filter: blur(12px);
-webkit-backdrop-filter: blur(12px);

/* AFTER */
backdrop-filter: blur(var(--blur-lg));
-webkit-backdrop-filter: blur(var(--blur-lg));
```

Maintain all other filter properties (saturate, brightness) unchanged.

Expected changes:
- Lines ~197-198: blur(12px) -> blur(var(--blur-lg))
- Lines ~206-207: blur(12px) -> blur(var(--blur-lg))
- Lines ~278-279: blur(30px) -> blur(var(--blur-2xl))
- Lines ~296-297: blur(36px) -> blur(var(--blur-3xl))
- Line ~317: blur(8px) -> blur(var(--blur-md))
  </action>
  <verify>grep "blur(\d+px)" src/app/globals.css returns no matches (only var(--blur-*) patterns)</verify>
  <done>All hardcoded blur values in globals.css replaced with CSS variable references</done>
</task>

<task type="auto">
  <name>Task 2: Migrate inline backdropFilter in components</name>
  <files>
    src/components/ui/search/CommandPalette/CommandPalette.tsx
    src/components/ui/Modal.tsx
  </files>
  <action>
**CommandPalette.tsx:**
Find: `backdropFilter: "blur(20px)"` or similar inline style
Replace with: `backdropFilter: "blur(var(--blur-xl))"` (20px = --blur-xl)

If using Tailwind class instead: Use `backdrop-blur-xl`

**Modal.tsx:**
Check for any inline backdropFilter with hardcoded values
Replace with CSS variable or Tailwind utility:
- blur(4px) -> var(--blur-sm) or backdrop-blur-sm
- blur(8px) -> var(--blur-md) or backdrop-blur-md
- blur(12px) -> var(--blur-lg) or backdrop-blur-lg
- blur(20px) -> var(--blur-xl) or backdrop-blur-xl

If Framer Motion animates the blur (interpolation from 0 to N), keep numeric for animation but add comment:
```typescript
// Animated blur - uses numeric for FM interpolation
animate: { backdropFilter: "blur(20px)" } // --blur-xl equivalent
```
  </action>
  <verify>grep -r "blur(\d+px)" in these component files returns no unexcepted matches</verify>
  <done>CommandPalette and Modal use CSS variable blur tokens or document animation exceptions</done>
</task>

<task type="auto">
  <name>Task 3: Document dynamic blur in Header.tsx</name>
  <files>src/components/ui/navigation/Header.tsx</files>
  <action>
Header.tsx has dynamic blur based on scroll position: `blur(${blurAmount}px)`

This is intentionally dynamic (blur increases as user scrolls) and cannot use a single token.

Add a code comment documenting the token basis:

```typescript
// Dynamic blur based on scroll position
// Range: 0px (no blur at top) to ~20px (--blur-xl equivalent at scroll threshold)
// Kept dynamic for smooth scroll-linked animation
backdropFilter: `blur(${blurAmount}px)`
```

Also add an eslint-disable comment if ESLint flags it:
```typescript
// eslint-disable-next-line @typescript-eslint/no-restricted-syntax -- Dynamic scroll-linked blur, cannot use single token
```

If Header uses a maximum blur value, consider clamping to token value:
```typescript
const maxBlur = 20; // --blur-xl
const blurAmount = Math.min(scrollPosition / threshold * maxBlur, maxBlur);
```
  </action>
  <verify>Read Header.tsx to confirm comment exists explaining dynamic blur</verify>
  <done>Header.tsx dynamic blur documented with token basis and exemption reason</done>
</task>

</tasks>

<verification>
1. `grep "blur([0-9]*px)" src/app/globals.css` returns no matches
2. `grep -c "var(--blur-" src/app/globals.css` returns 5+ (all blur uses tokens)
3. CommandPalette.tsx uses blur token or has documented exception
4. Header.tsx has comment explaining dynamic blur
5. `pnpm lint` passes or only has documented exceptions
</verification>

<success_criteria>
- Zero hardcoded blur(Npx) values in globals.css
- globals.css uses var(--blur-*) for all glassmorphism effects
- CommandPalette backdrop blur uses token
- Modal backdrop blur uses token or Tailwind utility
- Header dynamic blur has documentation comment
- Glassmorphism visual appearance unchanged
- `pnpm build` passes
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-03-SUMMARY.md`
</output>
