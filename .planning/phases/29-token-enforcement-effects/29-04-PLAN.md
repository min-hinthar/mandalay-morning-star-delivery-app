---
phase: 29-token-enforcement-effects
plan: 04
type: execute
wave: 3
depends_on: ["29-02", "29-03"]
files_modified:
  - src/components/ui/checkout/CheckoutStepperV8.tsx
  - src/components/ui/checkout/CheckoutWizard.tsx
  - src/components/ui/checkout/AddressInput.tsx
  - src/components/ui/homepage/CTABanner.tsx
  - src/app/(customer)/checkout/page.tsx
  - src/components/ui/admin/analytics/PerformanceChart.tsx
  - src/components/ui/admin/RevenueChart.tsx
  - src/components/ui/layout/CheckoutLayout.tsx
  - src/components/ui/layout/DriverLayout.tsx
  - src/components/ui/layout/AdminLayout.tsx
  - src/components/ui/menu/UnifiedMenuItemCard/GlassOverlay.tsx
  - src/components/ui/menu/MenuAccordion.tsx
  - src/components/ui/NavDots.tsx
  - src/components/ui/orders/tracking/DeliveryMap.tsx
  - src/lib/hooks/useLuminance.ts
autonomous: true

must_haves:
  truths:
    - "All remaining inline boxShadow values use CSS variables or document exception"
    - "All remaining inline backdropFilter values use CSS variables or document exception"
    - "No shadow-[...] arbitrary values remain in component files"
  artifacts:
    - path: "src/components/ui/checkout/CheckoutStepperV8.tsx"
      provides: "Checkout stepper with tokenized shadows"
    - path: "src/components/ui/homepage/CTABanner.tsx"
      provides: "CTA banner with tokenized animation shadows"
  key_links:
    - from: "CheckoutStepperV8.tsx"
      to: "tokens.css"
      via: "CSS variable or comment"
      pattern: "var\\(--shadow-|--shadow-.*equivalent"
---

<objective>
Complete shadow and blur migration for all remaining files identified in research.

Purpose: Achieve zero arbitrary shadow/blur violations across the codebase. Files with Framer Motion animated shadows get documented exceptions; static shadows get tokenized.

Output:
- All remaining component files use shadow tokens or document exceptions
- Admin and checkout components migrated
- Layout components migrated
- Menu and navigation components migrated
- useLuminance utility documents dynamic shadow generation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/29-token-enforcement-effects/29-02-SUMMARY.md
@.planning/phases/29-token-enforcement-effects/29-03-SUMMARY.md
@.planning/phases/29-token-enforcement-effects/29-RESEARCH.md
@src/styles/tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate checkout component shadows</name>
  <files>
    src/components/ui/checkout/CheckoutStepperV8.tsx
    src/components/ui/checkout/CheckoutWizard.tsx
    src/components/ui/checkout/AddressInput.tsx
    src/app/(customer)/checkout/page.tsx
  </files>
  <action>
For each file, search for `boxShadow` and `shadow-[` patterns.

**CheckoutStepperV8.tsx:**
Animation states with boxShadow:
- If animated (initial -> animate states), keep numeric + add comment: `// --shadow-md equivalent`
- If static whileHover/whileTap, use CSS variable: `boxShadow: "var(--shadow-md)"`

**CheckoutWizard.tsx:**
- Static shadows -> `var(--shadow-card)` or `var(--shadow-lg)`
- Glow effects -> `var(--shadow-glow-primary)` or `var(--shadow-glow-success)`

**AddressInput.tsx:**
- Focus shadows -> `var(--shadow-focus)`
- Input shadows -> `var(--shadow-sm)` or use Tailwind `shadow-sm`

**checkout/page.tsx:**
- Card shadows -> Tailwind `shadow-card` or `shadow-lg`
- Animation shadows -> document token equivalent

For any Framer Motion animated shadow that interpolates, format as:
```typescript
whileHover: {
  boxShadow: "0 8px 24px rgba(0,0,0,0.1)", // --shadow-lg equivalent, kept numeric for FM interpolation
}
```
  </action>
  <verify>grep -r "shadow-\[" in checkout/ and checkout page returns no matches</verify>
  <done>Checkout components use tokenized shadows or have documented exceptions for animations</done>
</task>

<task type="auto">
  <name>Task 2: Migrate admin, layout, and homepage shadows</name>
  <files>
    src/components/ui/homepage/CTABanner.tsx
    src/components/ui/admin/analytics/PerformanceChart.tsx
    src/components/ui/admin/RevenueChart.tsx
    src/components/ui/layout/CheckoutLayout.tsx
    src/components/ui/layout/DriverLayout.tsx
    src/components/ui/layout/AdminLayout.tsx
  </files>
  <action>
**CTABanner.tsx:**
Animation states for CTA hover effects:
- Hero glow -> `var(--shadow-glow-primary)`
- Button hover -> `var(--shadow-button-hover)`
- If animating between shadow states, document: `// --shadow-lg equivalent`

**PerformanceChart.tsx & RevenueChart.tsx:**
Chart container shadows:
- Card shadow -> use Tailwind `shadow-card` class
- If inline style, use `var(--shadow-card)`

**CheckoutLayout.tsx:**
- Nav/header shadows -> `var(--shadow-nav)`
- Elevated sections -> `var(--shadow-elevated)`

**DriverLayout.tsx:**
- Status bar shadows -> `var(--shadow-sm)` or `var(--shadow-nav)`
- Note: Driver UI may need high contrast - document if shadows intentionally minimal

**AdminLayout.tsx:**
- Sidebar shadows -> `var(--shadow-nav)` or `var(--shadow-md)`
- Content area -> `var(--shadow-card)`
  </action>
  <verify>grep -r "shadow-\[" in homepage/, admin/, layout/ returns no matches</verify>
  <done>Homepage, admin, and layout components use tokenized shadows</done>
</task>

<task type="auto">
  <name>Task 3: Migrate menu, navigation, and utility shadows</name>
  <files>
    src/components/ui/menu/UnifiedMenuItemCard/GlassOverlay.tsx
    src/components/ui/menu/MenuAccordion.tsx
    src/components/ui/NavDots.tsx
    src/components/ui/orders/tracking/DeliveryMap.tsx
    src/lib/hooks/useLuminance.ts
  </files>
  <action>
**GlassOverlay.tsx:**
Glassmorphism overlay:
- Background blur -> Should use Tailwind `backdrop-blur-md` or `backdrop-blur-lg`
- Any shadow -> `var(--shadow-card)` or `shadow-card` class

**MenuAccordion.tsx:**
Accordion expand/collapse:
- Section shadows -> `var(--shadow-sm)` or `shadow-sm`
- If animated, document equivalent

**NavDots.tsx:**
Navigation indicator dots:
- Active dot shadow/glow -> `var(--shadow-glow-primary)` or `shadow-glow-primary`
- Likely small - `var(--shadow-xs)` or `shadow-xs`

**DeliveryMap.tsx:**
Map UI overlays:
- Info card shadows -> `var(--shadow-card)` or `var(--shadow-md)`
- Marker shadows -> document if intentionally small

**useLuminance.ts:**
This utility generates dynamic drop-shadow based on image luminance.
Cannot use single token as values are computed.

Add documentation comment:
```typescript
/**
 * Generates dynamic drop-shadow based on image luminance.
 * Values range approximately from --shadow-sm (light images) to --shadow-lg (dark images).
 * Kept dynamic as shadow intensity adapts to image content.
 */
```

Add eslint-disable if flagged:
```typescript
// eslint-disable-next-line -- Dynamic luminance-based shadow, cannot use single token
```
  </action>
  <verify>grep -r "shadow-\[" in menu/, NavDots.tsx, orders/ returns no unexcepted matches; useLuminance.ts has documentation</verify>
  <done>All remaining component shadows tokenized or documented; useLuminance dynamic generation documented</done>
</task>

</tasks>

<verification>
1. `grep -r "shadow-\[" src/components/` returns zero or only documented exceptions
2. `grep -r "boxShadow.*[^var]rgba" src/components/` returns only Framer Motion animated shadows with comments
3. `node scripts/audit-tokens.js --json | jq '.violations | map(select(.pattern == "shadow-[...]")) | length'` returns 0
4. `node scripts/audit-tokens.js --json | jq '.violations | map(select(.pattern == "inline boxShadow")) | length'` returns low count (only FM animations)
5. useLuminance.ts has documentation explaining dynamic shadows
6. `pnpm build` passes
</verification>

<success_criteria>
- Zero shadow-[...] arbitrary values in component files
- All static boxShadow styles use var(--shadow-*) or Tailwind shadow-* utilities
- All Framer Motion animated shadows have comments documenting token equivalent
- useLuminance.ts documents dynamic shadow generation
- audit-tokens.js shadow violation count significantly reduced (close to zero for non-animated)
- `pnpm lint && pnpm typecheck && pnpm build` pass
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-04-SUMMARY.md`
</output>
