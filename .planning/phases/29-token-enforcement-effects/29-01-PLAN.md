---
phase: 29-token-enforcement-effects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/tokens.css
  - tailwind.config.ts
  - eslint.config.mjs
  - scripts/audit-tokens.js
autonomous: true

must_haves:
  truths:
    - "Shadow token scale is complete (xs through 2xl plus none)"
    - "Semantic shadow aliases exist for all common use cases"
    - "Blur tokens exist with CSS variables"
    - "ESLint catches inline boxShadow with hardcoded values"
    - "ESLint catches inline backdropFilter with hardcoded blur"
  artifacts:
    - path: "src/styles/tokens.css"
      provides: "Shadow xs/none tokens, blur tokens, inner shadow variants"
      contains: "--shadow-xs"
    - path: "tailwind.config.ts"
      provides: "Tailwind mappings for new tokens"
      contains: "shadow-xs"
    - path: "eslint.config.mjs"
      provides: "ESLint rules for shadow/blur enforcement"
      contains: "boxShadow"
  key_links:
    - from: "tailwind.config.ts"
      to: "tokens.css"
      via: "CSS variable references"
      pattern: "var\\(--shadow-"
---

<objective>
Add missing shadow and blur tokens to the design system and create ESLint enforcement rules.

Purpose: Complete the token infrastructure before migration. The existing shadow system covers sm-2xl but lacks xs, none, and comprehensive blur tokens per CONTEXT.md decisions.

Output:
- tokens.css with complete shadow scale (xs, none, inner variants, color variants)
- tokens.css with blur tokens (--blur-sm/md/lg/xl/2xl)
- tailwind.config.ts with new token mappings
- ESLint rules catching inline boxShadow and backdropFilter
- audit-tokens.js updated for comprehensive detection
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/29-token-enforcement-effects/29-CONTEXT.md
@.planning/phases/29-token-enforcement-effects/29-RESEARCH.md
@src/styles/tokens.css
@tailwind.config.ts
@eslint.config.mjs
@scripts/audit-tokens.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing shadow and blur tokens to tokens.css</name>
  <files>src/styles/tokens.css</files>
  <action>
Add the following tokens to the SHADOWS section in :root (light mode):

```css
/* Additional shadow scale */
--shadow-xs: 0 1px 2px rgba(164, 16, 52, 0.03);
--shadow-none: none;

/* Inner shadows for pressed states */
--shadow-inner-sm: inset 0 1px 2px rgba(26, 25, 24, 0.03);
--shadow-inner-md: inset 0 2px 4px rgba(26, 25, 24, 0.05);

/* Colored shadows (for buttons with brand colors) */
--shadow-primary: 0 4px 16px rgba(164, 16, 52, 0.25);
--shadow-success: 0 4px 16px rgba(82, 165, 46, 0.25);
--shadow-warning: 0 4px 16px rgba(232, 125, 30, 0.25);
--shadow-error: 0 4px 16px rgba(196, 92, 74, 0.25);

/* Nav top shadow (for elements above content) */
--shadow-nav-top: 0 -4px 20px -4px rgba(0, 0, 0, 0.1);

/* Focused input glow (used by search, inputs on focus) */
--shadow-focus: 0 0 0 3px rgba(164, 16, 52, 0.15);
--shadow-focus-success: 0 0 0 3px rgba(82, 165, 46, 0.2);
--shadow-focus-error: 0 0 0 3px rgba(196, 92, 74, 0.2);

/* Text shadows (for hero text legibility) */
--text-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
--text-shadow-md: 0 2px 4px rgba(0, 0, 0, 0.2);
```

Add BLUR TOKENS section after shadows:

```css
/* ===========================================
   BLUR TOKENS
   Consistent backdrop blur values
   =========================================== */

--blur-none: 0px;
--blur-sm: 4px;
--blur-md: 8px;
--blur-lg: 12px;
--blur-xl: 20px;
--blur-2xl: 30px;
--blur-3xl: 36px;
```

Add corresponding dark mode values in [data-theme="dark"], .dark section:

```css
/* Additional shadows (dark mode) */
--shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.2);
--shadow-none: none;
--shadow-inner-sm: inset 0 1px 2px rgba(0, 0, 0, 0.15);
--shadow-inner-md: inset 0 2px 4px rgba(0, 0, 0, 0.2);
--shadow-primary: 0 4px 16px rgba(255, 77, 109, 0.3);
--shadow-success: 0 4px 16px rgba(107, 216, 75, 0.3);
--shadow-warning: 0 4px 16px rgba(255, 159, 74, 0.3);
--shadow-error: 0 4px 16px rgba(255, 107, 107, 0.3);
--shadow-nav-top: 0 -4px 20px -4px rgba(0, 0, 0, 0.4);
--shadow-focus: 0 0 0 3px rgba(255, 77, 109, 0.2);
--shadow-focus-success: 0 0 0 3px rgba(107, 216, 75, 0.25);
--shadow-focus-error: 0 0 0 3px rgba(255, 107, 107, 0.25);
--text-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
--text-shadow-md: 0 2px 4px rgba(0, 0, 0, 0.4);

/* Blur tokens remain same in dark mode */
--blur-none: 0px;
--blur-sm: 4px;
--blur-md: 8px;
--blur-lg: 12px;
--blur-xl: 20px;
--blur-2xl: 30px;
--blur-3xl: 36px;
```

Place new shadow tokens after the existing glow effects section. Place blur tokens as a new section after shadows.
  </action>
  <verify>grep for "--shadow-xs" and "--blur-lg" in tokens.css to confirm both exist</verify>
  <done>tokens.css contains complete shadow scale (xs through 2xl, none, inner, color variants) and blur tokens (sm through 3xl)</done>
</task>

<task type="auto">
  <name>Task 2: Map new tokens in tailwind.config.ts and add ESLint rules</name>
  <files>tailwind.config.ts, eslint.config.mjs</files>
  <action>
**In tailwind.config.ts boxShadow section, add:**

```typescript
// After existing shadows, before legacy aliases:
xs: "var(--shadow-xs)",
none: "none",
"inner-sm": "var(--shadow-inner-sm)",
"inner-md": "var(--shadow-inner-md)",
primary: "var(--shadow-primary)",
success: "var(--shadow-success)",
warning: "var(--shadow-warning)",
error: "var(--shadow-error)",
"nav-top": "var(--shadow-nav-top)",
focus: "var(--shadow-focus)",
"focus-success": "var(--shadow-focus-success)",
"focus-error": "var(--shadow-focus-error)",
```

**Add backdropBlur section (new) in theme.extend:**

```typescript
backdropBlur: {
  none: "var(--blur-none)",
  sm: "var(--blur-sm)",
  md: "var(--blur-md)",
  lg: "var(--blur-lg)",
  xl: "var(--blur-xl)",
  "2xl": "var(--blur-2xl)",
  "3xl": "var(--blur-3xl)",
},
```

**In eslint.config.mjs, add to no-restricted-syntax array after existing rules:**

```javascript
// Shadow enforcement: catch inline boxShadow with hardcoded values
{
  selector: "Property[key.name='boxShadow'][value.type='Literal'][value.value=/^0\\s|^inset\\s|^none$/]",
  message: "Use CSS variable (var(--shadow-*)) or Tailwind shadow-* utility instead of hardcoded boxShadow. Exception: Framer Motion animated shadows need numeric values for interpolation.",
},
// Blur enforcement: catch inline backdropFilter with hardcoded blur
{
  selector: "Property[key.name='backdropFilter'][value.type='Literal'][value.value=/blur\\(\\d+px\\)/]",
  message: "Use CSS variable (var(--blur-*)) or Tailwind backdrop-blur-* utility instead of hardcoded blur value.",
},
// Also catch filter with hardcoded blur
{
  selector: "Property[key.name='filter'][value.type='Literal'][value.value=/blur\\(\\d+px\\)/]",
  message: "Use CSS variable (var(--blur-*)) instead of hardcoded blur value.",
},
```
  </action>
  <verify>Run `pnpm typecheck` to confirm tailwind.config.ts types are valid. Run `pnpm lint` to confirm ESLint config loads without errors (existing violations expected).</verify>
  <done>Tailwind utilities shadow-xs, shadow-primary, backdrop-blur-lg etc. available. ESLint rules catch inline boxShadow and backdropFilter.</done>
</task>

<task type="auto">
  <name>Task 3: Update audit-tokens.js with enhanced effect detection</name>
  <files>scripts/audit-tokens.js</files>
  <action>
Update the effects section in PATTERNS to be more comprehensive:

```javascript
effects: {
  hardcoded: [
    // Tailwind arbitrary shadows
    { regex: /\bshadow-\[[^\]]+\]/g, name: 'shadow-[...]', severity: 'warning' },
    // Tailwind arbitrary blur
    { regex: /\bblur-\[\d+px\]/g, name: 'blur-[Npx]', severity: 'warning' },
    { regex: /\bbackdrop-blur-\[\d+px\]/g, name: 'backdrop-blur-[Npx]', severity: 'warning' },
    // Tailwind arbitrary durations (info level - large scope)
    { regex: /\bduration-\[\d+ms\]/g, name: 'duration-[Nms]', severity: 'info' },
  ],
  inline: [
    // Inline boxShadow with hardcoded values (not CSS variables)
    { regex: /boxShadow:\s*['"](?!var\()0\s+\d/g, name: 'inline boxShadow', severity: 'warning' },
    { regex: /boxShadow:\s*['"]inset\s/g, name: 'inline boxShadow inset', severity: 'warning' },
    // Inline backdropFilter with hardcoded blur
    { regex: /backdropFilter:\s*['"]blur\(\d+px\)/g, name: 'inline backdropFilter', severity: 'warning' },
    { regex: /filter:\s*['"]blur\(\d+px\)/g, name: 'inline filter blur', severity: 'warning' },
  ],
},
```

Add fix suggestions for new patterns in FIX_SUGGESTIONS:

```javascript
'shadow-[...]': 'Use semantic shadow tokens (shadow-xs, shadow-sm, shadow-card, shadow-primary, etc.)',
'blur-[Npx]': 'Use Tailwind blur scale (blur-sm=4px, blur-md=8px, blur-lg=12px, etc.)',
'backdrop-blur-[Npx]': 'Use Tailwind backdrop-blur scale (backdrop-blur-sm, backdrop-blur-md, etc.)',
'duration-[Nms]': 'Consider using motion tokens (duration-fast=150ms, duration-normal=220ms, etc.)',
'inline boxShadow': 'Use CSS variable: boxShadow: var(--shadow-*)',
'inline boxShadow inset': 'Use CSS variable: boxShadow: var(--shadow-inner-*)',
'inline backdropFilter': 'Use CSS variable: backdropFilter: blur(var(--blur-*))',
'inline filter blur': 'Use CSS variable: filter: blur(var(--blur-*))',
```
  </action>
  <verify>Run `node scripts/audit-tokens.js` and confirm it detects shadow-[...] patterns in CartSummary.tsx and CartBar.tsx</verify>
  <done>audit-tokens.js detects all shadow, blur, and duration violations with appropriate severity and fix suggestions</done>
</task>

</tasks>

<verification>
1. `grep -c "shadow-xs\|blur-lg" src/styles/tokens.css` returns 2+ (tokens exist)
2. `pnpm typecheck` passes (tailwind config valid)
3. `pnpm lint` runs without config errors
4. `node scripts/audit-tokens.js --json | grep -c "shadow-\["` returns number (detects violations)
</verification>

<success_criteria>
- tokens.css has shadow-xs, shadow-none, shadow-inner-*, shadow-primary/success/warning/error, shadow-focus
- tokens.css has blur tokens (--blur-sm through --blur-3xl)
- Both light and dark mode values defined for all tokens
- tailwind.config.ts maps all new tokens to utilities
- ESLint rules catch inline boxShadow and backdropFilter
- audit-tokens.js detects Tailwind arbitrary shadow/blur patterns
- `pnpm typecheck && pnpm lint` completes (lint may have existing violations)
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-01-SUMMARY.md`
</output>
