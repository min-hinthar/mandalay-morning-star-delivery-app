---
phase: 29-token-enforcement-effects
plan: 02
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - src/components/ui/cart/CartSummary.tsx
  - src/components/ui/cart/CartBar.tsx
  - src/components/ui/theme-toggle.tsx
  - src/components/ui/layout/MobileDrawer/DrawerNavLink.tsx
  - src/components/ui/layout/AppHeader/SearchTrigger.tsx
  - src/components/ui/layout/AppHeader/AccountIndicator.tsx
  - src/lib/micro-interactions.ts
  - src/lib/motion-tokens.ts
autonomous: true

must_haves:
  truths:
    - "No Tailwind arbitrary shadow values (shadow-[...]) in component files"
    - "All inline boxShadow styles use CSS variables"
    - "Motion token files document shadow token equivalents for animated states"
  artifacts:
    - path: "src/components/ui/cart/CartSummary.tsx"
      provides: "Cart summary with tokenized shadows"
    - path: "src/components/ui/cart/CartBar.tsx"
      provides: "Cart bar with tokenized nav-top shadow"
    - path: "src/lib/micro-interactions.ts"
      provides: "Interaction variants using shadow tokens"
  key_links:
    - from: "CartSummary.tsx"
      to: "tokens.css"
      via: "shadow utility class"
      pattern: "shadow-glow-warning|shadow-card"
    - from: "micro-interactions.ts"
      to: "tokens.css"
      via: "CSS variable reference"
      pattern: "var\\(--shadow-"
---

<objective>
Migrate all hardcoded shadow values to use design system tokens.

Purpose: Eliminate arbitrary shadow values and inline boxShadow strings, replacing with CSS variables or Tailwind utilities. This ensures theme-aware shadows that auto-switch in dark mode.

Output:
- Component files using shadow-* utilities or var(--shadow-*) instead of hardcoded values
- Motion token files with documented shadow token equivalents for Framer Motion animated states
- Zero shadow-[...] violations in audit report
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/29-token-enforcement-effects/29-01-SUMMARY.md
@.planning/phases/29-token-enforcement-effects/29-RESEARCH.md
@src/styles/tokens.css
@src/components/ui/cart/CartSummary.tsx
@src/components/ui/cart/CartBar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Tailwind arbitrary shadow values in components</name>
  <files>
    src/components/ui/cart/CartSummary.tsx
    src/components/ui/cart/CartBar.tsx
    src/components/ui/theme-toggle.tsx
    src/components/ui/layout/MobileDrawer/DrawerNavLink.tsx
  </files>
  <action>
**CartSummary.tsx:**
Find: `shadow-[0_2px_8px_rgba(245,158,11,0.4)]` (or similar amber glow)
Replace with: `shadow-glow-warning`

**CartBar.tsx:**
Find: `shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]` (nav top shadow)
Replace with: `shadow-nav-top`

**theme-toggle.tsx:**
Find: `shadow-[0_0_12px_rgba(229,62,62,0.3)]` (or similar red glow)
Replace with: `shadow-glow-primary`

**DrawerNavLink.tsx:**
Find: `shadow-[0_0_12px_rgba(164,16,52,0.25)]`
Replace with: `shadow-glow-primary`

Search each file for `shadow-[` pattern and replace with appropriate semantic token:
- Glow effects (0_0_Npx) -> shadow-glow-primary/success/warning
- Top shadows (negative y offset) -> shadow-nav-top
- Card shadows -> shadow-card or shadow-md
- Small shadows -> shadow-sm or shadow-xs
  </action>
  <verify>grep -r "shadow-\[" in these files returns no matches</verify>
  <done>CartSummary, CartBar, theme-toggle, DrawerNavLink use semantic shadow utilities instead of arbitrary values</done>
</task>

<task type="auto">
  <name>Task 2: Migrate SearchTrigger and AccountIndicator shadows</name>
  <files>
    src/components/ui/layout/AppHeader/SearchTrigger.tsx
    src/components/ui/layout/AppHeader/AccountIndicator.tsx
  </files>
  <action>
**SearchTrigger.tsx:**
Find any `shadow-[0_2px_8px_...]` patterns for focused state
Replace with: `shadow-focus` or `shadow-sm`

**AccountIndicator.tsx:**
Find any `shadow-[0_4px_20px_...]` patterns
Replace with: `shadow-md` or `shadow-lg` depending on intensity

If the shadow includes brand color (rgba(164,16,52,...)):
- Use shadow-glow-primary for glow effects
- Use shadow-button-hover for button hover states

If the shadow is neutral (rgba(0,0,0,...)):
- Use shadow-sm/md/lg based on size
  </action>
  <verify>grep -r "shadow-\[" in AppHeader/ returns no matches</verify>
  <done>SearchTrigger and AccountIndicator use semantic shadow utilities</done>
</task>

<task type="auto">
  <name>Task 3: Update motion token files with CSS variable shadows</name>
  <files>
    src/lib/micro-interactions.ts
    src/lib/motion-tokens.ts
  </files>
  <action>
**In micro-interactions.ts:**
Locate any hardcoded boxShadow values in variants (primaryButton, card, etc.)
For static shadows (not animated between states), replace with CSS variables:
```typescript
// BEFORE
boxShadow: "0 4px 16px rgba(164, 16, 52, 0.20)"

// AFTER
boxShadow: "var(--shadow-button-hover)"
```

For animated shadows that interpolate between values, keep numeric but add comment:
```typescript
// BEFORE
whileTap: { boxShadow: "0 1px 2px rgba(0,0,0,0.1)" }

// AFTER
whileTap: { boxShadow: "0 1px 2px rgba(0,0,0,0.1)" } // --shadow-xs equivalent, kept numeric for FM interpolation
```

**In motion-tokens.ts:**
Update inputFocus object to use CSS variables where possible:
```typescript
export const inputFocus = {
  initial: { boxShadow: "var(--shadow-none)" },
  focus: { boxShadow: "var(--shadow-focus)" },
  error: { boxShadow: "var(--shadow-focus-error)" },
  success: { boxShadow: "var(--shadow-focus-success)" },
} as const;
```

For hover.buttonPress whileTap shadow, add comment documenting equivalent:
```typescript
whileTap: {
  scale: 0.97,
  y: 1,
  boxShadow: "0 1px 2px rgba(0,0,0,0.1)", // --shadow-xs equivalent
},
```
  </action>
  <verify>grep -c "shadow-xs equivalent\|var(--shadow-" in these files shows both patterns exist</verify>
  <done>micro-interactions.ts and motion-tokens.ts use CSS variables for static shadows and document token equivalents for animated shadows</done>
</task>

</tasks>

<verification>
1. `grep -r "shadow-\[" src/components/ui/cart/` returns no matches
2. `grep -r "shadow-\[" src/components/ui/layout/` returns no matches
3. `grep -r "shadow-\[" src/components/ui/theme-toggle.tsx` returns no matches
4. `grep -c "var(--shadow-" src/lib/motion-tokens.ts` returns 1+ (CSS variables used)
5. `node scripts/audit-tokens.js --json | jq '.violations | map(select(.pattern == "shadow-[...]")) | length'` returns 0 or very low count
</verification>

<success_criteria>
- Zero shadow-[...] arbitrary values in cart/, layout/, theme-toggle components
- micro-interactions.ts uses CSS variables for non-animated shadows
- motion-tokens.ts inputFocus uses var(--shadow-focus) tokens
- Animated shadows have comments documenting their token equivalent
- `pnpm lint && pnpm typecheck` pass
- Visual appearance unchanged (shadows render correctly)
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-02-SUMMARY.md`
</output>
