---
phase: 29-token-enforcement-effects
plan: 06
type: execute
wave: 4
depends_on: ["29-05"]
files_modified:
  - src/app/globals.css
  - src/lib/motion-tokens.ts
  - .planning/ROADMAP.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "CSS transitions use design system duration tokens"
    - "Framer Motion durations are documented with token equivalents"
    - "ROADMAP.md reflects motion timing is addressed with documented exceptions"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Tokenized CSS transition durations"
      contains: "var(--duration-"
    - path: "src/lib/motion-tokens.ts"
      provides: "Documentation mapping FM durations to CSS tokens"
      contains: "CSS equivalent: var(--duration-"
    - path: ".planning/ROADMAP.md"
      provides: "Updated success criteria status"
      contains: "motion tokens"
  key_links:
    - from: "motion-tokens.ts"
      to: "tokens.css"
      via: "Documentation comments"
      pattern: "duration-fast|duration-normal"
---

<objective>
Complete Phase 29 motion timing requirements by tokenizing CSS transitions and documenting Framer Motion exceptions.

Purpose: Address success criterion 3 "All transition/animation durations reference motion tokens" by:
1. Tokenizing the few CSS transitions that can use tokens
2. Documenting Framer Motion durations with their CSS token equivalents
3. Updating ROADMAP.md to reflect completion

Output: CSS transitions use tokens, motion-tokens.ts has documentation, ROADMAP.md updated.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-token-enforcement-effects/29-VERIFICATION.md
@.planning/phases/29-token-enforcement-effects/29-05-SUMMARY.md (after 29-05 completes)
@src/styles/tokens.css (motion tokens: --duration-instant through --duration-slower)
@src/app/globals.css (line 318 has hardcoded transition)
@src/lib/motion-tokens.ts (Framer Motion duration constants)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tokenize CSS transitions in globals.css</name>
  <files>src/app/globals.css</files>
  <action>
Replace the hardcoded transition duration on line 318 with CSS variable.

Change:
```css
transition: opacity 0.3s ease;
```

To:
```css
transition: opacity var(--duration-slow) var(--ease-out);
```

Rationale: 0.3s = 300ms ≈ --duration-slow (350ms) is the closest match.
The slight difference (300ms vs 350ms) is acceptable for this opacity transition.

Also search for any other hardcoded transition durations and tokenize them:
- Pattern: `transition:.*\d+\.?\d*s` or `transition:.*\d+ms`
  </action>
  <verify>
Grep for "transition:.*\d+\.?\d*s" in globals.css should return 0 matches.
CSS still valid - check by running build.
  </verify>
  <done>All CSS transitions in globals.css use design system tokens.</done>
</task>

<task type="auto">
  <name>Task 2: Document Framer Motion duration token equivalents</name>
  <files>src/lib/motion-tokens.ts</files>
  <action>
Add documentation comments to the duration constants mapping them to CSS token equivalents.

Update the duration object (around line 22-35) with inline comments:
```typescript
export const duration = {
  /** Micro-interactions: toggles, taps. CSS equivalent: var(--duration-instant) */
  micro: 0.08,
  /** Fast interactions: buttons, links. CSS equivalent: var(--duration-fast) at 150ms, this is ~120ms */
  fast: 0.12,
  /** Normal transitions: most animations. CSS equivalent: var(--duration-normal) at 220ms, this is ~180ms */
  normal: 0.18,
  /** Slow transitions: emphasis, reveals. CSS equivalent: var(--duration-slow) at 350ms, this is ~280ms */
  slow: 0.28,
  /** Dramatic moments: celebrations, hero. CSS equivalent: var(--duration-slower) at 500ms, this is ~400ms */
  dramatic: 0.4,
  /** Extra slow: special effects. CSS equivalent: beyond standard tokens (~600ms) */
  epic: 0.6,
} as const;
```

Add a JSDoc header block explaining the relationship:
```typescript
/**
 * V7 Motion Token System
 * Maximum playfulness, 120fps target, ultra-smooth animations
 *
 * DESIGN SYSTEM INTEGRATION:
 * Framer Motion requires NUMERIC durations for spring physics interpolation.
 * CSS variables (var(--duration-*)) cannot be used directly in FM transitions.
 *
 * Token Mapping (FM numeric -> CSS variable equivalent):
 * - micro (0.08s = 80ms)    → ~instant (0ms) / fast (150ms)
 * - fast (0.12s = 120ms)    → duration-fast (150ms)
 * - normal (0.18s = 180ms)  → ~duration-normal (220ms)
 * - slow (0.28s = 280ms)    → ~duration-slow (350ms)
 * - dramatic (0.4s = 400ms) → ~duration-slower (500ms)
 * - epic (0.6s = 600ms)     → beyond tokens (custom)
 *
 * Note: FM durations are intentionally faster than CSS tokens for
 * the playful, snappy feel of the v7 design language. Spring physics
 * with proper stiffness/damping provides natural deceleration.
 *
 * For CSS-only animations, use the tokens.css variables directly.
 */
```
  </action>
  <verify>
Run `grep -c "CSS equivalent:" src/lib/motion-tokens.ts` - should return 6+ matches.
Run `pnpm typecheck` to confirm file still compiles.
  </verify>
  <done>Framer Motion durations documented with CSS token equivalents, explaining numeric requirement for spring physics.</done>
</task>

<task type="auto">
  <name>Task 3: Update ROADMAP.md with motion timing status</name>
  <files>.planning/ROADMAP.md</files>
  <action>
Update Phase 29 section to reflect motion timing is complete with documented approach.

In the Phase 29 section, update:
1. Change "Plans: 4 plans" to "Plans: 6 plans"
2. Update success criteria 3 to show it's addressed:
   - Current: "All transition/animation durations reference motion tokens"
   - Keep as-is, but add clarifying note about Framer Motion

Add/update the plans list:
```markdown
Plans:
- [x] 29-01-PLAN.md — Shadow/blur token infrastructure + ESLint rules
- [x] 29-02-PLAN.md — Migrate component shadow values (cart, theme, drawer)
- [x] 29-03-PLAN.md — Migrate blur values (globals.css, CommandPalette, Header)
- [x] 29-04-PLAN.md — Complete shadow/blur migration (checkout, admin, menu, utilities)
- [x] 29-05-PLAN.md — Gap closure: AppHeader blur fix + motion timing ESLint rules
- [x] 29-06-PLAN.md — Gap closure: CSS transition tokenization + FM documentation
```

Update the Progress table:
```markdown
| 29. Token Enforcement - Effects | v1.3 | 6/6 | Complete | {today's date} |
```

Add a note under Phase 29 success criteria:
```markdown
**Note on Motion Timing:** Framer Motion animations use numeric durations for spring physics (required).
CSS transitions use var(--duration-*) tokens. Both approaches are valid - FM for interactive animations,
CSS tokens for non-spring transitions.
```
  </action>
  <verify>
ROADMAP.md shows Phase 29 with 6 plans and updated progress.
  </verify>
  <done>ROADMAP.md reflects Phase 29 complete with motion timing addressed via documentation + CSS tokenization.</done>
</task>

</tasks>

<verification>
1. `grep -r "transition:.*\d+\.?\d*s" src/app/globals.css` returns nothing (tokenized)
2. `grep "CSS equivalent" src/lib/motion-tokens.ts` returns multiple matches (documented)
3. ROADMAP.md shows Phase 29 complete with 6/6 plans
4. `pnpm build` passes
5. `pnpm typecheck` passes
</verification>

<success_criteria>
- globals.css transitions use var(--duration-*) tokens
- motion-tokens.ts documents Framer Motion duration to CSS token mapping
- ROADMAP.md shows Phase 29 complete
- No functional regressions
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-06-SUMMARY.md`
</output>
