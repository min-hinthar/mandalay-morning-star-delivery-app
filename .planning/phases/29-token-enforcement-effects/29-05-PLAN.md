---
phase: 29-token-enforcement-effects
plan: 05
type: execute
wave: 1
depends_on: ["29-04"]
files_modified:
  - src/components/ui/layout/AppHeader/AppHeader.tsx
  - eslint.config.mjs
  - scripts/audit-tokens.js
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "AppHeader blur values use design system tokens"
    - "ESLint detects hardcoded duration/transition values"
    - "Audit script reports motion timing violations with suggested fixes"
  artifacts:
    - path: "src/components/ui/layout/AppHeader/AppHeader.tsx"
      provides: "Tokenized blur values in glass styles"
      contains: "blur(var(--blur-2xl))"
    - path: "eslint.config.mjs"
      provides: "Motion timing ESLint rules"
      contains: "transitionDuration"
    - path: "scripts/audit-tokens.js"
      provides: "Motion timing detection patterns"
      contains: "transition-duration"
  key_links:
    - from: "eslint.config.mjs"
      to: "tokens.css"
      via: "Motion timing rules reference token names"
      pattern: "duration-fast|duration-normal|duration-slow"
---

<objective>
Close verification gaps: Fix AppHeader blur inconsistency and add motion timing enforcement infrastructure.

Purpose: Address Gap 2 (AppHeader blur) and lay groundwork for Gap 1 (motion timing) by adding detection tooling.
Output: AppHeader using blur tokens, ESLint rules for motion timing, enhanced audit detection.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-token-enforcement-effects/29-VERIFICATION.md
@src/styles/tokens.css (blur tokens: --blur-2xl = 30px)
@src/components/ui/layout/AppHeader/AppHeader.tsx (lines 33-56 have hardcoded blur)
@eslint.config.mjs (add motion timing rules)
@scripts/audit-tokens.js (enhance with motion timing detection)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix AppHeader blur token usage</name>
  <files>src/components/ui/layout/AppHeader/AppHeader.tsx</files>
  <action>
Replace hardcoded blur(30px) with blur(var(--blur-2xl)) in both glassStylesLight and glassStylesDark objects.

Lines 35-36 (glassStylesLight):
```typescript
backdropFilter: "blur(var(--blur-2xl))",
WebkitBackdropFilter: "blur(var(--blur-2xl))",
```

Lines 49-50 (glassStylesDark):
```typescript
backdropFilter: "blur(var(--blur-2xl))",
WebkitBackdropFilter: "blur(var(--blur-2xl))",
```

This matches the pattern established in CommandPalette.tsx and globals.css.
  </action>
  <verify>
Grep for "blur(30px)" in AppHeader.tsx should return 0 matches.
Grep for "blur(var(--blur-2xl))" should return 4 matches (2 per glass style object).
  </verify>
  <done>AppHeader uses --blur-2xl token, consistent with CommandPalette and globals.css patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Add motion timing ESLint rules</name>
  <files>eslint.config.mjs</files>
  <action>
Add ESLint rules to detect hardcoded motion timing values. Add after the existing blur enforcement rules (around line 230).

Add these rules to the "no-restricted-syntax" array:
```javascript
// Motion timing enforcement: catch inline transitionDuration with hardcoded values
{
  selector: "Property[key.name='transitionDuration'][value.type='Literal'][value.value=/^\\d+m?s$/]",
  message: "Use CSS variable (var(--duration-*)) or Tailwind duration-* utility instead of hardcoded transitionDuration. Options: duration-instant(0ms), duration-fast(150ms), duration-normal(220ms), duration-slow(350ms), duration-slower(500ms).",
},
// Catch inline transition with hardcoded duration
{
  selector: "Property[key.name='transition'][value.type='Literal'][value.value=/\\d+m?s/]",
  message: "Use CSS variable (var(--duration-*)) for transition durations. Framer Motion spring transitions may use numeric values for physics calculations.",
},
// Catch Tailwind arbitrary duration in class strings
{
  selector: "Literal[value=/duration-\\[\\d+m?s\\]/]",
  message: "Use Tailwind duration token (duration-fast, duration-normal, duration-slow, duration-slower) instead of duration-[Nms].",
},
// Catch Tailwind arbitrary delay in class strings
{
  selector: "Literal[value=/delay-\\[\\d+m?s\\]/]",
  message: "Use Tailwind delay scale or CSS variable instead of delay-[Nms].",
},
```

Note: Framer Motion numeric durations are allowed because spring physics REQUIRE numeric values.
  </action>
  <verify>
Run `pnpm lint` - should pass without new violations (existing code may have warnings).
Check eslint.config.mjs has 4 new motion timing rules.
  </verify>
  <done>ESLint rules detect hardcoded transitionDuration, transition with ms values, and Tailwind arbitrary durations.</done>
</task>

<task type="auto">
  <name>Task 3: Enhance audit-tokens.js with motion timing detection</name>
  <files>scripts/audit-tokens.js</files>
  <action>
Update the PATTERNS.effects section to include comprehensive motion timing detection.

In the `effects.hardcoded` array (around line 112-119), add these patterns:
```javascript
// Tailwind arbitrary durations - upgraded from info to warning for enforcement
{ regex: /\bduration-\[\d+m?s\]/g, name: 'duration-[Nms]', severity: 'warning' },
// Tailwind arbitrary delays
{ regex: /\bdelay-\[\d+m?s\]/g, name: 'delay-[Nms]', severity: 'warning' },
// Tailwind arbitrary transition timing functions
{ regex: /\bease-\[[^\]]+\]/g, name: 'ease-[...]', severity: 'info' },
```

Add a new `effects.inline` entry (around line 121-128):
```javascript
// Inline transition with hardcoded duration (not CSS variable)
{ regex: /transition:\s*['"][^'"]*\d+m?s/g, name: 'inline transition duration', severity: 'warning' },
// Inline transitionDuration with hardcoded value
{ regex: /transitionDuration:\s*['"]?\d+m?s/g, name: 'inline transitionDuration', severity: 'warning' },
// Inline animationDuration with hardcoded value
{ regex: /animationDuration:\s*['"]?\d+m?s/g, name: 'inline animationDuration', severity: 'warning' },
```

Add to FIX_SUGGESTIONS (around line 211-215):
```javascript
'duration-[Nms]': 'Use motion tokens: duration-instant(0ms), duration-fast(150ms), duration-normal(220ms), duration-slow(350ms), duration-slower(500ms)',
'delay-[Nms]': 'Use CSS variable: delay: var(--duration-*) or Tailwind delay scale',
'ease-[...]': 'Use easing tokens: ease-default, ease-spring, ease-out, ease-in, ease-in-out',
'inline transition duration': 'Use CSS variable: transition: all var(--duration-normal) var(--ease-default)',
'inline transitionDuration': 'Use CSS variable: transitionDuration: var(--duration-normal)',
'inline animationDuration': 'Use CSS variable: animationDuration: var(--duration-slow)',
```

Change existing 'duration-[Nms]' from severity 'info' to 'warning' to enforce during Phase 29.
  </action>
  <verify>
Run `node scripts/audit-tokens.js --verbose` and check motion timing patterns are detected.
Check audit-report.md includes motion timing violations in the effects category.
  </verify>
  <done>Audit script detects motion timing violations with severity 'warning' and provides fix suggestions.</done>
</task>

</tasks>

<verification>
1. `grep -r "blur(30px)" src/components/ui/layout/AppHeader/` returns nothing
2. `pnpm lint` passes (new rules are advisory, not blocking existing code)
3. `node scripts/audit-tokens.js` shows motion timing in effects category
4. AppHeader renders correctly in both light and dark themes
</verification>

<success_criteria>
- AppHeader.tsx uses blur(var(--blur-2xl)) instead of blur(30px)
- ESLint config has 4 new motion timing rules
- Audit script detects duration-[Nms], delay-[Nms], and inline transition durations
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/29-token-enforcement-effects/29-05-SUMMARY.md`
</output>
