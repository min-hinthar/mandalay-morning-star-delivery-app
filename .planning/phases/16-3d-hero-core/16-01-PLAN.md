---
phase: 16-3d-hero-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
  - src/components/3d/hooks/useGPUTier.ts
  - src/components/3d/loaders/Hero3DLoader.tsx
  - src/components/3d/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "GPU tier detection runs on client without SSR errors"
    - "Loading component shows branded spinner inside 3D canvas"
    - "@react-spring/three and detect-gpu packages are installed"
  artifacts:
    - path: "src/components/3d/hooks/useGPUTier.ts"
      provides: "GPU capability detection for 3D/2D decision"
      exports: ["useGPUTier"]
    - path: "src/components/3d/loaders/Hero3DLoader.tsx"
      provides: "Branded loading spinner for 3D content"
      exports: ["Hero3DLoader"]
  key_links:
    - from: "src/components/3d/hooks/useGPUTier.ts"
      to: "detect-gpu"
      via: "import getGPUTier"
      pattern: "import.*getGPUTier.*detect-gpu"
    - from: "src/components/3d/loaders/Hero3DLoader.tsx"
      to: "@react-three/drei"
      via: "useProgress hook"
      pattern: "useProgress.*drei"
---

<objective>
Install 3D animation dependencies and create infrastructure hooks/components for Phase 16.

Purpose: GPU detection enables smart 3D/2D fallback. Branded loader provides polished loading UX. Both are prerequisites for the main 3D scene.

Output: useGPUTier hook, Hero3DLoader component, installed @react-spring/three and detect-gpu packages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-3d-hero-core/16-RESEARCH.md
@.planning/phases/16-3d-hero-core/16-CONTEXT.md
@src/components/3d/Scene.tsx
@src/components/3d/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @react-spring/three and detect-gpu</name>
  <files>package.json, pnpm-lock.yaml</files>
  <action>
Run: `pnpm add @react-spring/three detect-gpu`

These packages enable:
- @react-spring/three: Spring physics animations for 3D scale-up entrance
- detect-gpu: GPU tier classification (0-3) for 3D/2D fallback decision

Verify versions installed are compatible:
- @react-spring/three should be ^10.x (matches react-spring ecosystem)
- detect-gpu should be ^5.x (latest stable)
  </action>
  <verify>
`pnpm list @react-spring/three detect-gpu` shows both packages installed.
`pnpm build` succeeds (no type errors from new packages).
  </verify>
  <done>Both packages installed and build passes</done>
</task>

<task type="auto">
  <name>Task 2: Create useGPUTier hook for device capability detection</name>
  <files>src/components/3d/hooks/useGPUTier.ts</files>
  <action>
Create GPU tier detection hook at `src/components/3d/hooks/useGPUTier.ts`:

```typescript
"use client";

import { useState, useEffect } from "react";
import { getGPUTier, type TierResult } from "detect-gpu";

export function useGPUTier() {
  const [tier, setTier] = useState<TierResult | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    let mounted = true;

    getGPUTier().then((result) => {
      if (mounted) {
        setTier(result);
        setIsLoading(false);
      }
    });

    return () => { mounted = false; };
  }, []);

  return {
    tier,
    isLoading,
    // Tier 2+ = 30+ fps capable, good for 3D
    // Tier 0-1 = low-end, show 2D fallback
    shouldRender3D: tier ? tier.tier >= 2 : true, // Optimistic default while loading
    isMobile: tier?.isMobile ?? false,
    gpuName: tier?.gpu ?? "Unknown",
    fps: tier?.fps ?? 0,
  };
}
```

Key design decisions:
- Mounted check prevents state update after unmount
- Default to 3D while loading (optimistic - most devices support WebGL)
- Tier 2+ threshold based on detect-gpu benchmark (30+ fps)
- Export isMobile for potential mobile-specific adjustments
  </action>
  <verify>
Create test file or verify via Next.js dev:
1. Import hook in a test component
2. Console.log tier result
3. Confirm no hydration errors (SSR-safe)
  </verify>
  <done>useGPUTier hook exports shouldRender3D boolean based on device capability</done>
</task>

<task type="auto">
  <name>Task 3: Create Hero3DLoader branded loading component</name>
  <files>src/components/3d/loaders/Hero3DLoader.tsx, src/components/3d/index.ts</files>
  <action>
Create branded loader at `src/components/3d/loaders/Hero3DLoader.tsx`:

```typescript
"use client";

import { useProgress, Html } from "@react-three/drei";

/**
 * Branded loading indicator for 3D hero section.
 * Uses drei's Html to render DOM inside Canvas.
 * Shows indeterminate spinner (not percentage - unreliable for single large GLB).
 */
export function Hero3DLoader() {
  const { active } = useProgress();

  if (!active) return null;

  return (
    <Html center>
      <div className="flex flex-col items-center gap-3">
        {/* Morning Star branded spinner - gold bowl animation */}
        <div className="relative w-16 h-16">
          {/* Outer ring - spinning */}
          <div className="absolute inset-0 rounded-full border-4 border-secondary/30 border-t-secondary animate-spin" />
          {/* Inner star icon */}
          <div className="absolute inset-0 flex items-center justify-center">
            <svg
              className="w-8 h-8 text-secondary animate-pulse"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M12 2l2.4 7.4h7.6l-6 4.6 2.3 7-6.3-4.6-6.3 4.6 2.3-7-6-4.6h7.6z" />
            </svg>
          </div>
        </div>
        <p className="text-white/70 text-sm font-medium">
          Loading deliciousness...
        </p>
      </div>
    </Html>
  );
}
```

Update barrel export at `src/components/3d/index.ts`:

```typescript
export { Scene } from "./Scene";
export { useGPUTier } from "./hooks/useGPUTier";
export { Hero3DLoader } from "./loaders/Hero3DLoader";
```

Note: The loader uses Tailwind classes. `secondary` is the brand gold color from the theme.
  </action>
  <verify>
TypeScript compiles: `pnpm typecheck`
Loader exported from barrel: `grep "Hero3DLoader" src/components/3d/index.ts`
  </verify>
  <done>Hero3DLoader shows branded spinner with Morning Star star icon</done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm build` passes
2. `pnpm typecheck` passes
3. New files exist:
   - src/components/3d/hooks/useGPUTier.ts
   - src/components/3d/loaders/Hero3DLoader.tsx
4. Barrel exports updated with new components
</verification>

<success_criteria>
- [ ] @react-spring/three and detect-gpu installed
- [ ] useGPUTier hook detects GPU tier and returns shouldRender3D
- [ ] Hero3DLoader shows branded spinner inside Canvas
- [ ] All exports available from src/components/3d/index.ts
- [ ] Build and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/16-3d-hero-core/16-01-SUMMARY.md`
</output>
