---
phase: 27-token-enforcement-colors
plan: 03
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - src/components/admin/AdminDashboard.tsx
  - src/components/admin/drivers/DriverListTable.tsx
  - src/components/admin/drivers/AddDriverModal.tsx
  - src/components/admin/analytics/MetricCard.tsx
  - src/components/driver/ActiveRouteView.tsx
  - src/components/driver/DriverDashboard.tsx
  - src/components/driver/DeliveryActions.tsx
  - src/components/driver/ExceptionModal.tsx
  - src/components/driver/OfflineBanner.tsx
  - src/components/driver/PhotoCapture.tsx
  - src/components/driver/StopDetail.tsx
  - src/components/driver/StopCard.tsx
  - src/components/layouts/DriverLayout.tsx
  - src/components/layouts/AdminLayout.tsx
  - src/components/layouts/CheckoutLayout.tsx
  - src/app/(admin)/admin/routes/page.tsx
  - src/app/(admin)/admin/menu/page.tsx
  - src/app/(admin)/admin/drivers/page.tsx
  - src/app/(admin)/admin/categories/page.tsx
  - src/app/(admin)/admin/analytics/drivers/DriverAnalyticsDashboard.tsx
  - src/app/(admin)/admin/analytics/delivery/DeliveryMetricsDashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Zero text-white/text-black violations in admin components (except high-contrast mode)"
    - "Zero bg-white/bg-black violations in admin components (except high-contrast mode)"
    - "Zero text-white/text-black violations in driver components (except high-contrast mode)"
    - "Zero bg-white/bg-black violations in driver components (except high-contrast mode)"
    - "DriverLayout high-contrast mode preserved with ESLint disable comments"
    - "Both light and dark themes render correctly for admin and driver pages"
  artifacts:
    - path: "src/components/layouts/DriverLayout.tsx"
      provides: "Theme-aware driver layout with high-contrast exemption"
      contains: "eslint-disable-next-line"
  key_links:
    - from: "src/components/driver/*.tsx"
      to: "src/components/layouts/DriverLayout.tsx"
      via: "Layout wrapper"
      pattern: "DriverLayout"
---

<objective>
Migrate admin and driver pages to semantic color tokens while preserving accessibility features.

Purpose: Complete token migration for admin/driver pages with high-contrast mode support
Output: All admin/driver components use semantic tokens, high-contrast accessibility preserved
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-token-enforcement-colors/27-CONTEXT.md
@.planning/phases/27-token-enforcement-colors/27-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate admin components</name>
  <files>
    src/components/admin/AdminDashboard.tsx
    src/components/admin/drivers/DriverListTable.tsx
    src/components/admin/drivers/AddDriverModal.tsx
    src/components/admin/analytics/MetricCard.tsx
    src/components/layouts/AdminLayout.tsx
    src/app/(admin)/admin/routes/page.tsx
    src/app/(admin)/admin/menu/page.tsx
    src/app/(admin)/admin/drivers/page.tsx
    src/app/(admin)/admin/categories/page.tsx
    src/app/(admin)/admin/analytics/drivers/DriverAnalyticsDashboard.tsx
    src/app/(admin)/admin/analytics/delivery/DeliveryMetricsDashboard.tsx
  </files>
  <action>
Replace hardcoded colors with semantic tokens:

Token mapping:
- Admin panels: `bg-white` -> `bg-surface-primary`
- Admin text: `text-black` -> `text-text-primary`
- Table rows: Alternate colors using `bg-surface-secondary`
- Modal backgrounds: Use surface tokens
- Status badges: Use status tokens (`text-status-success`, `bg-status-success-bg`)
- Metric cards: Card backgrounds and text colors

Specific patterns:
1. AdminDashboard.tsx: Dashboard card styling
2. DriverListTable.tsx: Table row backgrounds and text
3. AddDriverModal.tsx: Modal surface colors
4. MetricCard.tsx: Metric card backgrounds (has gradient - leave gradient, fix solid colors)
5. Admin page files: Page-level backgrounds and containers
6. Analytics dashboards: Chart container styling
  </action>
  <verify>Run `grep -E "text-white|text-black|bg-white|bg-black" src/components/admin/**/*.tsx src/app/\(admin\)/**/*.tsx` returns minimal/no matches</verify>
  <done>Admin components use semantic tokens</done>
</task>

<task type="auto">
  <name>Task 2: Migrate driver components with high-contrast preservation</name>
  <files>
    src/components/driver/ActiveRouteView.tsx
    src/components/driver/DriverDashboard.tsx
    src/components/driver/DeliveryActions.tsx
    src/components/driver/ExceptionModal.tsx
    src/components/driver/OfflineBanner.tsx
    src/components/driver/PhotoCapture.tsx
    src/components/driver/StopDetail.tsx
    src/components/driver/StopCard.tsx
    src/components/layouts/DriverLayout.tsx
  </files>
  <action>
Replace hardcoded colors with semantic tokens, EXCEPT for intentional high-contrast mode:

Token mapping:
- Driver UI: `bg-white` -> `bg-surface-primary`
- Driver text: `text-black` -> `text-text-primary`
- Action buttons: Use primary/status tokens
- Offline banner: Use status-warning tokens
- Camera overlay: Use overlay tokens

CRITICAL - High-contrast mode exemption:
DriverLayout.tsx uses conditional `bg-black text-white` for accessibility high-contrast mode.
This is INTENTIONAL for WCAG compliance. Add ESLint disable comment:

```typescript
// eslint-disable-next-line @mandalay/no-hardcoded-colors -- Intentional high-contrast mode for accessibility
className={highContrast ? "bg-black text-white" : "bg-surface-primary text-text-primary"}
```

Specific patterns:
1. PhotoCapture.tsx: Has 9+ violations - camera UI overlays and capture buttons
2. OfflineBanner.tsx: Warning banner styling
3. DriverLayout.tsx: High-contrast mode conditional
4. Other driver components: Standard surface/text token migration
  </action>
  <verify>
1. Run `grep -E "text-white|text-black|bg-white|bg-black" src/components/driver/*.tsx` - only matches should have eslint-disable comments
2. Run `grep -E "text-white|text-black|bg-white|bg-black" src/components/layouts/DriverLayout.tsx` - matches should have eslint-disable comments
  </verify>
  <done>Driver components use semantic tokens, high-contrast mode preserved with ESLint exemption</done>
</task>

<task type="auto">
  <name>Task 3: Migrate remaining layout and supporting components</name>
  <files>
    src/components/layouts/CheckoutLayout.tsx
    src/components/layout/MobileDrawer/DrawerUserSection.tsx
    src/components/layout/MobileDrawer/MobileDrawer.tsx
    src/components/layout/AppHeader/SearchTrigger.tsx
    src/components/layout/AppHeader/CartIndicator.tsx
    src/components/layout/AppHeader/AccountIndicator.tsx
    src/components/layout/CommandPalette/CommandPalette.tsx
    src/components/tracking/TrackingPageClient.tsx
    src/components/tracking/SupportActions.tsx
    src/components/tracking/StatusTimeline.tsx
    src/components/tracking/DriverCard.tsx
    src/components/tracking/OrderSummary.tsx
    src/components/auth/WelcomeAnimation.tsx
    src/components/auth/MagicLinkSent.tsx
    src/components/auth/LoginForm.tsx
    src/components/auth/AuthModal.tsx
    src/components/onboarding/OnboardingTour.tsx
  </files>
  <action>
Replace hardcoded colors with semantic tokens:

Token mapping:
- Layout backgrounds: `bg-white` -> `bg-surface-primary`
- Text colors: `text-white`/`text-black` -> semantic equivalents
- Overlays: `bg-black/50` -> `bg-overlay`
- Command palette: Surface and text tokens
- Tracking components: Status colors for timeline
- Auth components: Modal and form styling
- Onboarding: Tour overlay and highlight colors

Specific patterns:
1. CheckoutLayout.tsx: Layout wrapper colors
2. MobileDrawer components: Drawer overlay and content
3. AppHeader components: Header element styling
4. CommandPalette: Search palette overlay
5. Tracking components: Timeline and status colors
6. Auth components: Form and modal styling
7. OnboardingTour: Overlay and spotlight colors
  </action>
  <verify>Run `grep -E "text-white|text-black|bg-white|bg-black" src/components/layout/**/*.tsx src/components/tracking/*.tsx src/components/auth/*.tsx src/components/onboarding/*.tsx` returns no matches</verify>
  <done>All layout, tracking, auth, and onboarding components use semantic tokens</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no type errors
2. Run `pnpm lint` - no ESLint color violations (except exempted high-contrast)
3. Run `pnpm build` - builds successfully
4. Manual: Test admin dashboard in both themes
5. Manual: Test driver interface in both themes
6. Manual: Test driver high-contrast mode still works
7. Manual: Test tracking page in both themes
</verification>

<success_criteria>
- Zero hardcoded colors in admin components
- Zero hardcoded colors in driver components (except documented high-contrast exemption)
- DriverLayout high-contrast mode works correctly with ESLint disable comment
- All admin and driver pages render correctly in both themes
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/27-token-enforcement-colors/27-03-SUMMARY.md`
</output>
