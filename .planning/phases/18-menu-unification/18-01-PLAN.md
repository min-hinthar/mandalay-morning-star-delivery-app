---
phase: 18-menu-unification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/menu/UnifiedMenuItemCard/index.ts
  - src/components/menu/UnifiedMenuItemCard/UnifiedMenuItemCard.tsx
  - src/components/menu/UnifiedMenuItemCard/CardImage.tsx
  - src/components/menu/UnifiedMenuItemCard/CardContent.tsx
  - src/components/menu/UnifiedMenuItemCard/AddButton.tsx
  - src/components/menu/UnifiedMenuItemCard/DietaryBadges.tsx
  - src/components/menu/UnifiedMenuItemCard/GlassOverlay.tsx
  - src/components/menu/UnifiedMenuItemCard/use-card-sound.ts
  - src/app/globals.css
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Card has frosted glass background with 20px blur"
    - "Card has 3D tilt effect when mouse moves over it (15-20 degree max)"
    - "Moving light/shine effect follows mouse during tilt"
    - "Card scales slightly on hover (1.02-1.05x)"
    - "Add button transforms to quantity controls after adding"
    - "Dietary badges (vegetarian, spicy, popular) display with icons AND text"
    - "Card snaps back to neutral when mouse leaves"
  artifacts:
    - path: "src/components/menu/UnifiedMenuItemCard/UnifiedMenuItemCard.tsx"
      provides: "Main unified card component with variants"
      exports: ["UnifiedMenuItemCard", "UnifiedMenuItemCardProps"]
    - path: "src/components/menu/UnifiedMenuItemCard/index.ts"
      provides: "Public exports"
      exports: ["UnifiedMenuItemCard"]
    - path: "src/app/globals.css"
      provides: "glass-menu-card utility class"
      contains: ".glass-menu-card"
  key_links:
    - from: "UnifiedMenuItemCard.tsx"
      to: "framer-motion"
      via: "useMotionValue, useSpring, useTransform"
      pattern: "rotateX.*rotateY"
    - from: "AddButton.tsx"
      to: "useCart"
      via: "addItem hook call"
      pattern: "addItem\\("
---

<objective>
Create the UnifiedMenuItemCard component with glassmorphism styling, 3D tilt effect with shine, and state-machine add button.

Purpose: Consolidate 3 existing menu card implementations (MenuItemCard.tsx, menu-item-card.tsx, MenuItemCardV8.tsx) into one unified component with enhanced visual effects.
Output: Complete UnifiedMenuItemCard component ready for integration on homepage and menu page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-menu-unification/18-CONTEXT.md
@.planning/phases/18-menu-unification/18-RESEARCH.md

# Existing implementations to consolidate
@src/components/menu/MenuItemCard.tsx
@src/components/menu/menu-item-card.tsx
@src/components/ui-v8/menu/MenuItemCardV8.tsx

# Motion tokens and utilities
@src/lib/motion-tokens.ts
@src/lib/hooks/useAnimationPreference.ts
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create glassmorphism CSS utility and component structure</name>
  <files>
    src/app/globals.css
    src/components/menu/UnifiedMenuItemCard/index.ts
    src/components/menu/UnifiedMenuItemCard/GlassOverlay.tsx
  </files>
  <action>
    1. Add `.glass-menu-card` utility class to globals.css:
       ```css
       .glass-menu-card {
         background: color-mix(in srgb, var(--color-surface-primary) 75%, transparent);
         backdrop-filter: blur(20px);
         -webkit-backdrop-filter: blur(20px);
         border: 1px solid var(--color-border-subtle);
       }
       .glass-menu-card:hover {
         backdrop-filter: blur(24px);
         -webkit-backdrop-filter: blur(24px);
       }
       ```

    2. Create `src/components/menu/UnifiedMenuItemCard/` directory structure

    3. Create `GlassOverlay.tsx`:
       - Renders the glassmorphism surface layer
       - Handles hover border glow (brand color)
       - Uses motion.div with opacity transition for glow effect
       - Props: isHovered, className

    4. Create `index.ts` with placeholder exports (will add real exports after main component)
  </action>
  <verify>
    - `grep -r "glass-menu-card" src/app/globals.css` shows the utility class
    - `ls src/components/menu/UnifiedMenuItemCard/` shows index.ts and GlassOverlay.tsx
  </verify>
  <done>
    - glass-menu-card CSS utility exists with 20px blur and hover enhancement
    - GlassOverlay component renders glassmorphism with hover glow
    - Component directory structure created
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 3D tilt sub-components and dietary badges</name>
  <files>
    src/components/menu/UnifiedMenuItemCard/CardImage.tsx
    src/components/menu/UnifiedMenuItemCard/DietaryBadges.tsx
    src/components/menu/UnifiedMenuItemCard/use-card-sound.ts
  </files>
  <action>
    1. Create `CardImage.tsx`:
       - Receives mouseX, mouseY motion values as props for parallax
       - Uses useTransform to create subtle image parallax (+-10px)
       - 4:3 aspect ratio (aspect-[4/3])
       - Rounded corners (rounded-t-3xl for top)
       - Contains shine overlay div that follows mouse position
       - Shine uses linear-gradient with 15% white opacity
       - Uses Next.js Image component with priority option
       - Fallback emoji for missing images (from existing MenuItemCardV8 pattern)

    2. Create `DietaryBadges.tsx`:
       - Render badges for: vegetarian, vegan, spicy (levels 1-3), popular, featured
       - Each badge has icon AND text label (per CONTEXT.md)
       - Use Lucide icons: Leaf (veg), Flame (spicy), Star (popular)
       - Positioned top-left of image (absolute top-3 left-3)
       - Badges use spring animation for entrance
       - Style: semi-transparent bg with matching text color

    3. Create `use-card-sound.ts` hook:
       - Lazy-load Web Audio API on first user interaction
       - Expose playAddSound() and playRemoveSound() functions
       - Short, subtle click sounds (80-100ms)
       - Wrap in try/catch for browsers blocking audio
       - Only play after first user gesture (track with ref)
  </action>
  <verify>
    - `grep "useTransform" src/components/menu/UnifiedMenuItemCard/CardImage.tsx` shows parallax
    - `grep "Flame\|Leaf\|Star" src/components/menu/UnifiedMenuItemCard/DietaryBadges.tsx` shows icons
    - `grep "AudioContext" src/components/menu/UnifiedMenuItemCard/use-card-sound.ts` shows Web Audio
  </verify>
  <done>
    - CardImage has parallax effect and shine overlay following mouse
    - DietaryBadges shows icons with text labels for all dietary types
    - useCardSound hook provides click sounds with autoplay safety
  </done>
</task>

<task type="auto">
  <name>Task 3: Create AddButton with state machine and main component</name>
  <files>
    src/components/menu/UnifiedMenuItemCard/AddButton.tsx
    src/components/menu/UnifiedMenuItemCard/CardContent.tsx
    src/components/menu/UnifiedMenuItemCard/UnifiedMenuItemCard.tsx
    src/components/menu/UnifiedMenuItemCard/index.ts
  </files>
  <action>
    1. Create `AddButton.tsx`:
       - State machine: "idle" -> "adding" -> "quantity"
       - idle: Shows pill-shaped "Add" button with Plus icon
       - adding: Brief animation (checkmark draws in, ~300ms)
       - quantity: Shows +/- controls using existing QuantitySelector component
       - Button has press animation (scale 0.95 on tap)
       - Calls useFlyToCart hook for arc animation
       - Calls useCardSound for click sound
       - Triggers haptic via navigator.vibrate
       - Accept onAdd callback prop for cart integration

    2. Create `CardContent.tsx`:
       - Item name (bold, line-clamp-1)
       - Description (secondary, line-clamp-2, optional via showDescription prop)
       - Price (subtle, secondary to name)
       - Burmese name if available (text-xs, muted)
       - Uses existing PriceTicker component for animated price

    3. Create `UnifiedMenuItemCard.tsx`:
       - Props: item, variant ("menu"|"homepage"|"cart"), categorySlug, onSelect, onQuickAdd, isFavorite, onFavoriteToggle, disableTilt, priority, className
       - Variant config object for: imageAspect, showDescription, showBadges, enableTilt, rounded
       - 3D tilt implementation:
         - useMotionValue for mouseX, mouseY (0-1 normalized)
         - useSpring + useTransform for rotateX, rotateY (15-20 deg max)
         - transformStyle: "preserve-3d", transformPerspective: 1000
         - Reset to 0.5, 0.5 on mouse leave
       - Compose: GlassOverlay, CardImage, DietaryBadges, CardContent, AddButton, FavoriteButton
       - Scale on hover: whileHover={{ scale: 1.03 }}
       - Z-index bump on hover to prevent overlap issues
       - Respect useAnimationPreference for reduced motion
       - Mobile: tap scales card, long-press (300ms) enables tilt play mode

    4. Update `index.ts`:
       - Export UnifiedMenuItemCard, UnifiedMenuItemCardProps
       - Export sub-components for potential reuse
  </action>
  <verify>
    - `npm run typecheck` passes
    - `grep "variant.*menu.*homepage.*cart" src/components/menu/UnifiedMenuItemCard/UnifiedMenuItemCard.tsx` shows variants
    - `grep "rotateX.*rotateY" src/components/menu/UnifiedMenuItemCard/UnifiedMenuItemCard.tsx` shows 3D tilt
    - `grep "idle.*adding.*quantity" src/components/menu/UnifiedMenuItemCard/AddButton.tsx` shows state machine
  </verify>
  <done>
    - AddButton cycles through idle -> adding -> quantity states
    - CardContent displays item details with typography hierarchy
    - UnifiedMenuItemCard has working 3D tilt, glassmorphism, and all sub-components
    - All exports available from index.ts
  </done>
</task>

</tasks>

<verification>
Run:
```bash
npm run typecheck && npm run lint
```

Manual verification:
1. Import UnifiedMenuItemCard in a test page
2. Hover over card - tilt effect visible with shine
3. Click Add button - transforms to quantity controls
4. Check mobile - tap scales, long-press enables tilt
</verification>

<success_criteria>
- [ ] UnifiedMenuItemCard component exports from index.ts
- [ ] Glassmorphism effect visible (frosted glass background)
- [ ] 3D tilt works with 15-20 degree rotation max
- [ ] Shine effect follows mouse position during tilt
- [ ] Add button has 3-state machine (idle -> adding -> quantity)
- [ ] Dietary badges show icons with text labels
- [ ] Card respects reduced motion preference
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-menu-unification/18-01-SUMMARY.md`
</output>
