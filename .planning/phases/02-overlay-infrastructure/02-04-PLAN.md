---
phase: 02-overlay-infrastructure
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/ui-v8/Tooltip.tsx
  - src/components/ui-v8/Toast.tsx
  - src/components/ui-v8/ToastProvider.tsx
  - src/lib/hooks/useToastV8.ts
  - src/components/ui-v8/index.ts
autonomous: true

must_haves:
  truths:
    - "Tooltip appears on hover after short delay with fade animation"
    - "Tooltip uses z-tooltip layer to appear above all other overlays"
    - "Tooltip has pointer-events-none to not interfere with content"
    - "Toast notifications stack in bottom-right corner"
    - "Toast notifications auto-dismiss after 5 seconds"
    - "Toast notifications can be manually dismissed"
    - "Toast appears above modals using z-toast layer"
    - "Multiple toasts animate with layout animation"
  artifacts:
    - path: "src/components/ui-v8/Tooltip.tsx"
      provides: "Hover tooltip component"
      exports: ["Tooltip", "TooltipTrigger", "TooltipContent"]
      min_lines: 40
    - path: "src/components/ui-v8/Toast.tsx"
      provides: "Toast notification component"
      exports: ["Toast", "ToastContainer"]
      min_lines: 60
    - path: "src/lib/hooks/useToastV8.ts"
      provides: "Toast state management hook"
      exports: ["useToast", "toast"]
      min_lines: 40
  key_links:
    - from: "src/components/ui-v8/Toast.tsx"
      to: "src/design-system/tokens/z-index.ts"
      via: "zIndex.toast usage"
      pattern: "zIndex\\.toast|z-toast"
    - from: "src/components/ui-v8/Tooltip.tsx"
      to: "src/design-system/tokens/z-index.ts"
      via: "zIndex.tooltip usage"
      pattern: "zIndex\\.tooltip|z-tooltip"
---

<objective>
Create Tooltip and Toast notification components using infrastructure from Plan 01.

Purpose: Fulfills OVER-05 (Tooltip), OVER-06 (Toast), OVER-08 (spring animations).
Output: Tooltip.tsx (hover info), Toast.tsx (notification stack), useToastV8.ts (state management)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-overlay-infrastructure/02-RESEARCH.md
@src/components/ui/tooltip.tsx (existing reference - CSS-only, we're adding JS control)
@src/components/ui/toast.tsx (existing Radix-based toast)
@src/lib/hooks/useToast.ts (existing toast state management)
@src/design-system/tokens/z-index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tooltip component</name>
  <files>
    - src/components/ui-v8/Tooltip.tsx
  </files>
  <action>
Create Tooltip.tsx with hover delay and controlled visibility:

"use client" directive

Components to create:
1. TooltipProvider (optional wrapper, just passes children)
2. Tooltip (root)
3. TooltipTrigger
4. TooltipContent

Props:
- TooltipProvider: children (no-op, for API compatibility)
- Tooltip: children, delayDuration? (default 200ms), open?, onOpenChange?
- TooltipTrigger: children, asChild?
- TooltipContent: children, side? ("top" | "bottom", default "bottom"), sideOffset? (default 6), className?

Implementation:
1. Import zIndex from @/design-system/tokens/z-index
2. Import overlayMotion from @/design-system/tokens/motion
3. Import motion, AnimatePresence from framer-motion
4. Import cn from @/lib/utils/cn

TooltipContext:
- { isOpen, setIsOpen, triggerRef, delayDuration }

Tooltip (root):
- Manage open state with delay
- Provide context
- Render relative container span

TooltipTrigger:
- onMouseEnter: start delay timer, set isOpen after delayDuration
- onMouseLeave: clear timer, set isOpen false
- onFocus: set isOpen true (immediate for keyboard users)
- onBlur: set isOpen false
- If asChild, clone child with handlers
- Store ref for positioning

TooltipContent:
- Get context
- Only render when isOpen (AnimatePresence)
- motion.span (not div to allow inline)
- Positioning:
  - absolute, left-1/2, -translate-x-1/2
  - side === "top": bottom-full, marginBottom: sideOffset
  - side === "bottom": top-full, marginTop: sideOffset
- Styling:
  - z-tooltip (zIndex.tooltip = 70)
  - pointer-events-none (CRITICAL: don't intercept clicks)
  - bg-zinc-900 dark:bg-zinc-100 (inverted for visibility)
  - text-white dark:text-zinc-900
  - text-xs, px-2 py-1, rounded-md, shadow-md
  - w-max, max-w-xs
- Animation:
  - initial: { opacity: 0, scale: 0.95 }
  - animate: { opacity: 1, scale: 1 }
  - exit: { opacity: 0, scale: 0.95 }
  - transition: overlayMotion.tooltip

Export TooltipProvider, Tooltip, TooltipTrigger, TooltipContent.
  </action>
  <verify>
`pnpm typecheck` passes. Tooltip shows on hover with delay, uses z-tooltip, has pointer-events-none.
  </verify>
  <done>
Tooltip appears on hover after delay, uses highest z-index layer, does not block interactions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Toast notification system</name>
  <files>
    - src/lib/hooks/useToastV8.ts
    - src/components/ui-v8/Toast.tsx
    - src/components/ui-v8/ToastProvider.tsx
  </files>
  <action>
Create toast notification system with V8 suffix to avoid conflicts with existing:

useToastV8.ts - State management (follow existing useToast.ts pattern):
- "use client" directive
- Toast type: { id: string, message: string, type: "success" | "error" | "info" | "warning", duration?: number }
- TOAST_LIMIT = 5, TOAST_REMOVE_DELAY = 5000
- Global state with listeners pattern (like existing useToast.ts)
- Actions: ADD_TOAST, DISMISS_TOAST, REMOVE_TOAST
- genId function for unique IDs
- toast function: (options) => { id, dismiss, update }
  - Adds toast, sets auto-dismiss timer
- useToast hook: subscribes to global state, returns { toasts, toast, dismiss }
- Export useToast and toast

Toast.tsx - Individual toast component:
- ToastProps: toast (Toast type), onDismiss: (id) => void
- motion.div for animation
- Styling based on type:
  - success: bg-green-500 text-white
  - error: bg-red-500 text-white
  - warning: bg-amber-500 text-white
  - info: bg-blue-500 text-white
- Layout: flex items-center gap-2, px-4 py-3, rounded-lg, shadow-lg
- Close button (X icon) on right, onClick calls onDismiss
- Animation:
  - initial: { opacity: 0, x: 100, scale: 0.9 }
  - animate: { opacity: 1, x: 0, scale: 1 }
  - exit: { opacity: 0, x: 100, scale: 0.9 }
  - transition: overlayMotion.toast

ToastContainer component:
- Uses Portal from ./overlay
- Fixed bottom-4 right-4 (or bottom-4 inset-x-4 on mobile)
- z-toast (zIndex.toast = 80, highest)
- flex flex-col gap-2
- pointer-events-none on container (children override with auto)
- AnimatePresence mode="popLayout" for smooth reorder
- Maps toasts to Toast components with layout animation

ToastProvider.tsx:
- Wraps children
- Renders ToastContainer
- Use in app layout to enable toasts globally

Export Toast, ToastContainer from Toast.tsx
Export ToastProvider from ToastProvider.tsx
  </action>
  <verify>
`pnpm typecheck` passes. Toast system exports correctly. Uses z-toast for highest stacking.
  </verify>
  <done>
Toast notifications stack with animations, auto-dismiss, manual dismiss. Highest z-index ensures visibility above modals.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update ui-v8 barrel export</name>
  <files>
    - src/components/ui-v8/index.ts
  </files>
  <action>
Update barrel export to include Tooltip and Toast:

```typescript
// Overlay primitives
export { Portal, Backdrop } from "./overlay";

// Overlay components
export { Modal } from "./Modal";
export type { ModalProps } from "./Modal";
export { BottomSheet } from "./BottomSheet";
export type { BottomSheetProps } from "./BottomSheet";
export { Drawer } from "./Drawer";
export type { DrawerProps } from "./Drawer";
export {
  Dropdown,
  DropdownTrigger,
  DropdownContent,
  DropdownItem,
  DropdownSeparator,
} from "./Dropdown";
export {
  TooltipProvider,
  Tooltip,
  TooltipTrigger,
  TooltipContent,
} from "./Tooltip";
export { Toast, ToastContainer } from "./Toast";
export { ToastProvider } from "./ToastProvider";
```

Also update src/lib/hooks/index.ts to export useToast from useToastV8:
- Add: export { useToast as useToastV8, toast as toastV8 } from "./useToastV8"
- Keep existing useToast export for backwards compatibility
  </action>
  <verify>
`pnpm typecheck` passes. All exports importable. useToastV8 available from @/lib/hooks.
  </verify>
  <done>
Tooltip and Toast components barrel exported. useToastV8 hook available for toast state management.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - All files type-check
2. `pnpm lint` - No linting errors
3. `pnpm build` - Build succeeds
4. Files exist:
   - src/components/ui-v8/Tooltip.tsx
   - src/components/ui-v8/Toast.tsx
   - src/components/ui-v8/ToastProvider.tsx
   - src/lib/hooks/useToastV8.ts
5. Tooltip:
   - Uses z-tooltip layer (70)
   - Has pointer-events-none
   - Shows with delay on hover
6. Toast:
   - Uses z-toast layer (80)
   - Stacks with layout animation
   - Auto-dismisses after 5s
</verification>

<success_criteria>
- Tooltip appears on hover with 200ms delay
- Tooltip uses z-tooltip (70) for proper stacking above dropdowns
- Tooltip has pointer-events-none to not block interactions
- Toast notifications stack in bottom-right with gap
- Toast auto-dismisses after 5 seconds
- Toast can be manually dismissed via X button
- Toast uses z-toast (80) to appear above modals
- Multiple toasts animate smoothly with layout animation
- useToastV8 hook manages toast state globally
</success_criteria>

<output>
After completion, create `.planning/phases/02-overlay-infrastructure/02-04-SUMMARY.md`
</output>
