---
phase: 28-token-enforcement-layout
plan: 03
type: execute
wave: 2
depends_on: ["28-01"]
files_modified:
  - src/styles/tokens.css
  - src/components/ui/menu/CategoryTabs.tsx
  - src/components/ui/menu/MenuSkeleton.tsx
  - src/components/ui/admin/RevenueChart.tsx
  - src/components/ui/admin/analytics/PerformanceChart.tsx
  - src/components/ui/admin/analytics/PeakHoursChart.tsx
  - src/components/ui/admin/analytics/DeliverySuccessChart.tsx
  - src/components/ui/admin/analytics/ExceptionBreakdown.tsx
autonomous: true

must_haves:
  truths:
    - "Position violations use CSS variable token (--tabs-offset)"
    - "Chart borderRadius values use CSS variable tokens where possible"
    - "RevenueChart fontWeight uses Tailwind class instead of inline style"
    - "MorphingMenu borderRadius values unchanged (animation interpolation requirement)"
  artifacts:
    - path: "src/styles/tokens.css"
      provides: "tabs-offset layout token"
      contains: "--tabs-offset"
    - path: "src/components/ui/menu/CategoryTabs.tsx"
      provides: "CategoryTabs with token-based positioning"
      contains: "var(--tabs-offset)"
  key_links:
    - from: "src/components/ui/menu/CategoryTabs.tsx"
      to: "src/styles/tokens.css"
      via: "CSS variable reference"
      pattern: "var\\(--tabs-offset\\)"
---

<objective>
Migrate position violations and chart inline styles to CSS variable tokens.

Purpose: Standardize layout positioning and border-radius using design tokens
Output: Token-based positioning for sticky elements, token-based chart styling
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-token-enforcement-layout/28-CONTEXT.md
@.planning/phases/28-token-enforcement-layout/28-RESEARCH.md
@.planning/phases/28-token-enforcement-layout/28-01-SUMMARY.md
@src/styles/tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tabs-offset token and migrate position violations</name>
  <files>
    src/styles/tokens.css
    src/components/ui/menu/CategoryTabs.tsx
    src/components/ui/menu/MenuSkeleton.tsx
  </files>
  <action>
Add layout token for tabs offset and migrate violations:

1. **tokens.css** - Add to LAYOUT section (~line 291, after --header-height):
```css
--tabs-offset: 72px;      /* Header height + nav tabs */
```

2. **CategoryTabs.tsx** (line ~160):
   - `top-[72px]` → `top-[var(--tabs-offset)]`
   - Full line context: "sticky top-[72px] z-20"

3. **MenuSkeleton.tsx** (line ~77):
   - `top-[72px]` → `top-[var(--tabs-offset)]`
   - Full line context: "sticky top-[72px] z-20 border-b..."

Note: Using CSS variable allows single source of truth. If header height changes,
only tokens.css needs updating. The 72px value = header (56px) + spacing (16px).
  </action>
  <verify>Run `grep -r "top-\[72px\]" src/` returns no matches</verify>
  <done>CategoryTabs and MenuSkeleton use --tabs-offset token for sticky positioning</done>
</task>

<task type="auto">
  <name>Task 2: Migrate chart inline styles to CSS variables</name>
  <files>
    src/components/ui/admin/RevenueChart.tsx
    src/components/ui/admin/analytics/PerformanceChart.tsx
    src/components/ui/admin/analytics/PeakHoursChart.tsx
    src/components/ui/admin/analytics/DeliverySuccessChart.tsx
    src/components/ui/admin/analytics/ExceptionBreakdown.tsx
  </files>
  <action>
Migrate chart component inline styles to use CSS variable tokens:

**Border-radius migrations:**
Each chart has borderRadius in style objects. Replace with CSS variable:

1. **RevenueChart.tsx** (line ~88):
   - `borderRadius: "16px"` → `borderRadius: "var(--radius-xl)"`
   - Also fix fontWeight (line ~94): Remove `fontWeight: 600` from style object
     Add `font-semibold` to the element's className if not present

2. **PerformanceChart.tsx** (lines ~66, ~214):
   - `borderRadius: "8px"` → `borderRadius: "var(--radius-md)"`

3. **PeakHoursChart.tsx** (line ~82):
   - `borderRadius: "8px"` → `borderRadius: "var(--radius-md)"`

4. **DeliverySuccessChart.tsx** (lines ~82, ~149):
   - `borderRadius: "8px"` → `borderRadius: "var(--radius-md)"`

5. **ExceptionBreakdown.tsx** (line ~150):
   - `borderRadius: "8px"` → `borderRadius: "var(--radius-md)"`

**Token mapping reference:**
- 8px = --radius-md (rounded-md)
- 16px = --radius-xl (rounded-xl)

**Note:** MorphingMenu.tsx borderRadius values (2px, 4px) are intentionally NOT changed.
Framer Motion needs numeric strings for animation interpolation.
  </action>
  <verify>Run `grep -E "borderRadius:\s*['\"]\\d+px['\"]" src/components/ui/admin/` returns only MorphingMenu or no matches</verify>
  <done>Chart components use CSS variable tokens for borderRadius, RevenueChart uses Tailwind font-semibold</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no type errors
2. Run `pnpm lint` - no ESLint errors for fontWeight in charts
3. Run `pnpm build` - builds successfully
4. Run `grep -r "top-\[72px\]" src/` - returns no matches
5. Run `grep "fontWeight: 600" src/components/ui/admin/` - returns no matches
</verification>

<success_criteria>
- Zero top-[72px] violations (uses --tabs-offset token)
- Chart components use var(--radius-*) instead of hardcoded borderRadius
- RevenueChart uses Tailwind font-semibold instead of fontWeight: 600
- MorphingMenu animation values unchanged (intentional exception)
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/28-token-enforcement-layout/28-03-SUMMARY.md`
</output>
