---
phase: 05-menu-browsing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui-v8/menu/CategoryTabsV8.tsx
  - src/components/ui-v8/menu/MenuSectionV8.tsx
autonomous: true

must_haves:
  truths:
    - "Category tabs scroll horizontally on mobile"
    - "Active tab highlights as user scrolls to corresponding section"
    - "Clicking a tab scrolls to that category section"
    - "Tab indicator animates smoothly between tabs (layoutId)"
  artifacts:
    - path: "src/components/ui-v8/menu/CategoryTabsV8.tsx"
      provides: "Horizontal scrolling tabs with scrollspy"
      exports: ["CategoryTabsV8"]
    - path: "src/components/ui-v8/menu/MenuSectionV8.tsx"
      provides: "Category section wrapper with id for scrollspy"
      exports: ["MenuSectionV8"]
  key_links:
    - from: "CategoryTabsV8.tsx"
      to: "useActiveCategory hook"
      via: "import from @/lib/hooks/useActiveCategory"
      pattern: "useActiveCategory\\(sectionIds"
    - from: "CategoryTabsV8.tsx"
      to: "MenuSectionV8.tsx"
      via: "section IDs match (category-{slug})"
      pattern: "category-.*slug"
---

<objective>
Build V8 category tabs with scrollspy behavior that highlights the active tab based on scroll position and provides smooth animated tab switching.

Purpose: MENU-01 requirement - scrollspy navigation for menu categories
Output: CategoryTabsV8 and MenuSectionV8 components ready for menu integration
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-menu-browsing/05-RESEARCH.md

@src/lib/hooks/useActiveCategory.ts
@src/lib/motion-tokens.ts
@src/components/menu/category-tabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CategoryTabsV8 with scrollspy</name>
  <files>src/components/ui-v8/menu/CategoryTabsV8.tsx</files>
  <action>
Create CategoryTabsV8 component with:

1. Props interface:
   - categories: { slug: string; name: string; nameEn?: string; nameMy?: string }[]
   - onCategoryClick?: (slug: string | null) => void (optional override)
   - className?: string

2. Use existing `useActiveCategory` hook from `@/lib/hooks/useActiveCategory`:
   - Pass sectionIds as `categories.map(cat => \`category-\${cat.slug}\`)`
   - Configure rootMargin to account for sticky header (72px)
   - Get activeCategory and scrollToCategory from hook

3. Layout:
   - Sticky positioning: `sticky top-[72px] z-sticky`
   - Background: `bg-surface-primary/95 backdrop-blur-lg border-b border-border-subtle`
   - Horizontal scroll container with `overflow-x-auto scrollbar-hide`
   - Fade indicators on left/right when more content (use ResizeObserver + scroll position)

4. Tab styling:
   - Add "All" tab (slug: null) as first tab
   - Pill-shaped tabs: `rounded-pill px-5 py-2.5 min-h-[44px]`
   - Font: `font-body text-sm font-semibold`
   - Active state: `text-text-inverse` with pill background
   - Inactive: `text-text-secondary hover:text-text-primary hover:bg-surface-secondary`

5. Tab indicator animation (Framer Motion):
   - Use `layoutId="v8ActiveTabPill"` for smooth animated pill
   - Background: `bg-primary shadow-sm`
   - Use `spring.snappy` from motion-tokens for transition
   - Respect `useAnimationPreference().shouldAnimate`

6. Click handler:
   - Call scrollToCategory(slug) from hook
   - Also call onCategoryClick if provided

7. Accessibility:
   - `role="tablist"` on container
   - `role="tab"`, `aria-selected`, `aria-controls="category-{slug}"` on buttons

Use V8 tokens: zIndex from design-system, colors from surface-*, spring from motion-tokens.
Import GSAP from @/lib/gsap if needed (but this component uses Framer Motion).
  </action>
  <verify>TypeScript compiles without errors: `pnpm typecheck`</verify>
  <done>CategoryTabsV8 renders horizontal tabs, highlights active based on activeCategory prop, animates indicator with layoutId</done>
</task>

<task type="auto">
  <name>Task 2: Create MenuSectionV8 wrapper</name>
  <files>src/components/ui-v8/menu/MenuSectionV8.tsx</files>
  <action>
Create MenuSectionV8 component that wraps category sections with proper IDs for scrollspy:

1. Props interface:
   - category: { slug: string; name: string; nameEn?: string; nameMy?: string }
   - children: ReactNode
   - className?: string

2. Structure:
   ```tsx
   <section
     id={`category-${category.slug}`}
     aria-labelledby={`category-heading-${category.slug}`}
     className={cn("scroll-mt-[140px]", className)} // Account for header + tabs
   >
     <h2
       id={`category-heading-${category.slug}`}
       className="font-display text-xl font-bold text-text-primary mb-4"
     >
       {category.nameEn || category.name}
       {category.nameMy && (
         <span className="ml-2 font-burmese text-base text-text-muted">
           {category.nameMy}
         </span>
       )}
     </h2>
     {children}
   </section>
   ```

3. The `scroll-mt-[140px]` accounts for:
   - Header: 72px
   - Category tabs: ~60px
   - Small gap: 8px

4. Export from component file.
  </action>
  <verify>TypeScript compiles without errors: `pnpm typecheck`</verify>
  <done>MenuSectionV8 renders section with correct ID matching CategoryTabsV8 expectations</done>
</task>

<task type="auto">
  <name>Task 3: Verify scrollspy integration</name>
  <files>src/components/ui-v8/menu/CategoryTabsV8.tsx</files>
  <action>
Add a simple integration test by creating a quick visual verification:

1. Ensure CategoryTabsV8 properly:
   - Imports useActiveCategory correctly
   - Generates correct sectionIds array
   - Passes correct options to hook (rootMargin, headerHeight)

2. Verify scroll-into-view behavior:
   - Active tab should scroll into view when it changes
   - Use scrollIntoView with smooth behavior when not prefers-reduced-motion

3. Run lint and typecheck to verify no issues:
   - `pnpm lint`
   - `pnpm typecheck`
  </action>
  <verify>`pnpm lint && pnpm typecheck` passes</verify>
  <done>CategoryTabsV8 and MenuSectionV8 compile without errors, ready for integration</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- `pnpm lint` passes
- CategoryTabsV8 exports from file
- MenuSectionV8 exports from file
- Section IDs match pattern `category-{slug}`
- layoutId animation works (manual verification in integration plan)
</verification>

<success_criteria>
- CategoryTabsV8 component exists with scrollspy via useActiveCategory hook
- MenuSectionV8 component wraps sections with correct IDs
- Tab indicator animates between tabs using layoutId
- All code follows V8 patterns (tokens, animation preferences)
</success_criteria>

<output>
After completion, create `.planning/phases/05-menu-browsing/05-01-SUMMARY.md`
</output>
