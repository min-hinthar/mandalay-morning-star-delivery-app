---
phase: 05-menu-browsing
plan: 05
type: execute
wave: 2
depends_on: ["05-01", "05-02", "05-03", "05-04"]
files_modified:
  - src/components/ui-v8/menu/MenuGridV8.tsx
  - src/components/ui-v8/menu/MenuSkeletonV8.tsx
  - src/components/ui-v8/menu/MenuContentV8.tsx
  - src/components/ui-v8/menu/index.ts
autonomous: true

must_haves:
  truths:
    - "Menu content shows skeleton loading states before data loads"
    - "Menu items animate in with staggered reveal when scrolling into view"
    - "All V8 menu components are exported from index"
    - "MenuContentV8 integrates tabs, search, cards, and item detail"
  artifacts:
    - path: "src/components/ui-v8/menu/MenuGridV8.tsx"
      provides: "Grid container with GSAP staggered reveal"
      exports: ["MenuGridV8"]
    - path: "src/components/ui-v8/menu/MenuSkeletonV8.tsx"
      provides: "Loading skeleton for menu content"
      exports: ["MenuSkeletonV8", "MenuItemCardV8Skeleton"]
    - path: "src/components/ui-v8/menu/MenuContentV8.tsx"
      provides: "Complete menu page composition"
      exports: ["MenuContentV8"]
    - path: "src/components/ui-v8/menu/index.ts"
      provides: "Barrel exports for all menu components"
      exports: ["CategoryTabsV8", "MenuItemCardV8", "ItemDetailSheetV8", "SearchInputV8", "MenuGridV8", "MenuSkeletonV8", "MenuContentV8"]
  key_links:
    - from: "MenuGridV8.tsx"
      to: "GSAP ScrollTrigger"
      via: "import from @/lib/gsap"
      pattern: "gsap.*from.*scrollTrigger"
    - from: "MenuContentV8.tsx"
      to: "All V8 menu components"
      via: "imports"
      pattern: "import.*from.*\\./"
---

<objective>
Build V8 menu integration with GSAP staggered reveals, skeleton loading states, and complete menu content composition.

Purpose: MENU-05, MENU-06 requirements + full integration
Output: Complete V8 menu system ready for page integration
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-menu-browsing/05-RESEARCH.md

@src/lib/gsap/index.ts
@src/lib/gsap/presets.ts
@src/lib/hooks/useAnimationPreference.ts
@src/lib/hooks/useMenu.ts
@src/components/menu/menu-skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MenuGridV8 with GSAP stagger</name>
  <files>src/components/ui-v8/menu/MenuGridV8.tsx</files>
  <action>
Create MenuGridV8 with GSAP ScrollTrigger staggered reveal:

```tsx
"use client";

import { useRef } from "react";
import { gsap, useGSAP, ScrollTrigger } from "@/lib/gsap";
import { gsapDuration, gsapEase, gsapPresets } from "@/lib/gsap/presets";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";
import type { MenuItem } from "@/types/menu";
import { MenuItemCardV8 } from "./MenuItemCardV8";
import { cn } from "@/lib/utils/cn";

interface MenuGridV8Props {
  items: MenuItem[];
  categorySlug?: string;
  onSelectItem: (item: MenuItem) => void;
  onFavoriteToggle?: (itemId: string, isFavorite: boolean) => void;
  favorites?: Set<string>;
  className?: string;
}

export function MenuGridV8({
  items,
  categorySlug,
  onSelectItem,
  onFavoriteToggle,
  favorites = new Set(),
  className,
}: MenuGridV8Props) {
  const containerRef = useRef<HTMLDivElement>(null);
  const { shouldAnimate } = useAnimationPreference();

  useGSAP(
    () => {
      if (!shouldAnimate || !containerRef.current) return;

      // Target all cards with data-menu-card attribute
      const cards = containerRef.current.querySelectorAll("[data-menu-card]");

      if (cards.length === 0) return;

      // Staggered reveal animation
      gsap.from(cards, {
        y: 40,
        opacity: 0,
        duration: gsapDuration.slow,
        ease: gsapEase.default,
        stagger: gsapPresets.stagger.normal, // 0.06s between items
        scrollTrigger: {
          trigger: containerRef.current,
          start: "top 85%",
          // Play once, don't reverse or replay
          toggleActions: "play none none none",
        },
      });
    },
    { scope: containerRef, dependencies: [shouldAnimate, items.length] }
  );

  return (
    <div
      ref={containerRef}
      className={cn(
        "grid gap-4",
        "grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",
        className
      )}
    >
      {items.map((item) => (
        <MenuItemCardV8
          key={item.id}
          item={item}
          categorySlug={categorySlug}
          onSelect={onSelectItem}
          onFavoriteToggle={onFavoriteToggle}
          isFavorite={favorites.has(item.id)}
          showFavorite
          data-menu-card
        />
      ))}
    </div>
  );
}
```

Key points:
- Import GSAP from @/lib/gsap (never directly from gsap)
- Use useGSAP hook for proper cleanup
- toggleActions: "play none none none" prevents re-animation on scroll back
- Respect shouldAnimate preference
- items.length in dependencies triggers re-animation when items change
  </action>
  <verify>`pnpm typecheck` passes</verify>
  <done>MenuGridV8 animates cards with GSAP staggered reveal on scroll</done>
</task>

<task type="auto">
  <name>Task 2: Create MenuSkeletonV8 loading states</name>
  <files>src/components/ui-v8/menu/MenuSkeletonV8.tsx</files>
  <action>
Create skeleton loading states for menu:

```tsx
"use client";

import { cn } from "@/lib/utils/cn";

interface MenuSkeletonV8Props {
  sectionsCount?: number;
  itemsPerSection?: number;
}

export function MenuSkeletonV8({
  sectionsCount = 3,
  itemsPerSection = 4,
}: MenuSkeletonV8Props) {
  return (
    <div>
      {/* Category tabs skeleton */}
      <div className="sticky top-[72px] z-sticky border-b border-border bg-surface-primary/95 backdrop-blur-lg">
        <div className="flex gap-2 overflow-hidden px-4 py-3">
          {Array.from({ length: 6 }).map((_, i) => (
            <div
              key={i}
              className={cn(
                "h-10 w-24 flex-shrink-0 rounded-pill",
                "bg-surface-tertiary animate-shimmer"
              )}
            />
          ))}
        </div>
      </div>

      {/* Sections skeleton */}
      <div className="space-y-8 px-4 pb-8 pt-6">
        {Array.from({ length: sectionsCount }).map((_, sectionIdx) => (
          <div key={sectionIdx}>
            {/* Section header */}
            <div className="mb-4 h-7 w-48 rounded-input bg-surface-tertiary animate-shimmer" />

            {/* Grid of card skeletons */}
            <div className="grid gap-4 grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
              {Array.from({ length: itemsPerSection }).map((_, cardIdx) => (
                <MenuItemCardV8Skeleton key={cardIdx} />
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

export function MenuItemCardV8Skeleton() {
  return (
    <div className={cn(
      "overflow-hidden rounded-card",
      "bg-surface-primary border border-border shadow-card"
    )}>
      {/* Image skeleton */}
      <div className="relative aspect-video bg-surface-tertiary animate-shimmer" />

      {/* Content skeleton */}
      <div className="p-4 space-y-2">
        {/* Title */}
        <div className="h-5 w-3/4 rounded-input bg-surface-tertiary animate-shimmer" />

        {/* Burmese name */}
        <div className="h-4 w-1/2 rounded-input bg-surface-tertiary animate-shimmer" />

        {/* Price */}
        <div className="h-5 w-1/4 rounded-input bg-surface-tertiary animate-shimmer" />
      </div>
    </div>
  );
}
```

The animate-shimmer class should already exist (used in V6 components). If not, add to globals.css:
```css
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.animate-shimmer {
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
```
  </action>
  <verify>`pnpm typecheck` passes</verify>
  <done>MenuSkeletonV8 and MenuItemCardV8Skeleton display shimmer loading states</done>
</task>

<task type="auto">
  <name>Task 3: Create MenuContentV8 integration and barrel exports</name>
  <files>src/components/ui-v8/menu/MenuContentV8.tsx, src/components/ui-v8/menu/index.ts</files>
  <action>
**MenuContentV8.tsx** - Complete menu page composition:

```tsx
"use client";

import { useState, useCallback } from "react";
import { useMenu } from "@/lib/hooks/useMenu";
import { useFavorites } from "@/lib/hooks/useFavorites";
import type { MenuItem, MenuCategory } from "@/types/menu";

import { CategoryTabsV8 } from "./CategoryTabsV8";
import { MenuSectionV8 } from "./MenuSectionV8";
import { MenuGridV8 } from "./MenuGridV8";
import { SearchInputV8 } from "./SearchInputV8";
import { ItemDetailSheetV8 } from "./ItemDetailSheetV8";
import { MenuSkeletonV8 } from "./MenuSkeletonV8";
import { cn } from "@/lib/utils/cn";

interface MenuContentV8Props {
  className?: string;
}

export function MenuContentV8({ className }: MenuContentV8Props) {
  // Fetch menu data
  const { data, isLoading, error } = useMenu();
  const categories = data?.data?.categories ?? [];

  // Favorites
  const { favorites, toggleFavorite } = useFavorites();

  // Item detail state
  const [selectedItem, setSelectedItem] = useState<MenuItem | null>(null);
  const [isDetailOpen, setIsDetailOpen] = useState(false);

  const handleSelectItem = useCallback((item: MenuItem) => {
    setSelectedItem(item);
    setIsDetailOpen(true);
  }, []);

  const handleCloseDetail = useCallback(() => {
    setIsDetailOpen(false);
    // Delay clearing item to allow close animation
    setTimeout(() => setSelectedItem(null), 300);
  }, []);

  const handleFavoriteToggle = useCallback((itemId: string, isFavorite: boolean) => {
    toggleFavorite(itemId);
  }, [toggleFavorite]);

  const handleAddToCart = useCallback((
    item: MenuItem,
    modifiers: unknown[],
    quantity: number,
    notes: string
  ) => {
    // Cart hook handles this - AddToCartButton in ItemDetailSheetV8 uses useFlyToCart
    console.log("Add to cart:", { item, modifiers, quantity, notes });
  }, []);

  // Create favorites Set for quick lookup
  const favoritesSet = new Set(favorites);

  if (isLoading) {
    return <MenuSkeletonV8 />;
  }

  if (error) {
    return (
      <div className="flex flex-col items-center justify-center p-8 text-center">
        <p className="text-text-muted">Failed to load menu</p>
        <button
          onClick={() => window.location.reload()}
          className="mt-4 text-primary hover:underline"
        >
          Try again
        </button>
      </div>
    );
  }

  return (
    <div className={cn("relative", className)}>
      {/* Search - positioned in header or here */}
      <div className="px-4 py-3 border-b border-border-subtle">
        <SearchInputV8 onSelectItem={handleSelectItem} />
      </div>

      {/* Category Tabs */}
      <CategoryTabsV8 categories={categories} />

      {/* Menu Sections */}
      <div className="space-y-8 px-4 pb-8 pt-6">
        {categories.map((category: MenuCategory) => (
          <MenuSectionV8 key={category.slug} category={category}>
            <MenuGridV8
              items={category.items ?? []}
              categorySlug={category.slug}
              onSelectItem={handleSelectItem}
              onFavoriteToggle={handleFavoriteToggle}
              favorites={favoritesSet}
            />
          </MenuSectionV8>
        ))}
      </div>

      {/* Item Detail Sheet */}
      <ItemDetailSheetV8
        item={selectedItem}
        isOpen={isDetailOpen}
        onClose={handleCloseDetail}
        onAddToCart={handleAddToCart}
      />
    </div>
  );
}
```

Note: Adapt the data shape based on what useMenu actually returns. Check the hook for actual structure.

**index.ts** - Barrel exports:

```tsx
// V8 Menu Components

// Category navigation
export { CategoryTabsV8 } from "./CategoryTabsV8";
export { MenuSectionV8 } from "./MenuSectionV8";

// Item display
export { MenuItemCardV8 } from "./MenuItemCardV8";
export { MenuGridV8 } from "./MenuGridV8";
export { BlurImage } from "./BlurImage";
export { FavoriteButton } from "./FavoriteButton";
export { EmojiPlaceholder } from "./EmojiPlaceholder";

// Search
export { SearchInputV8 } from "./SearchInputV8";
export { SearchAutocomplete } from "./SearchAutocomplete";

// Item detail
export { ItemDetailSheetV8 } from "./ItemDetailSheetV8";

// Loading states
export { MenuSkeletonV8, MenuItemCardV8Skeleton } from "./MenuSkeletonV8";

// Full composition
export { MenuContentV8 } from "./MenuContentV8";
```
  </action>
  <verify>`pnpm typecheck && pnpm lint` passes</verify>
  <done>MenuContentV8 integrates all V8 menu components, index.ts exports all components</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- `pnpm lint` passes
- `pnpm build` passes (or typecheck if build has external blockers)
- All components export from index.ts
- MenuGridV8 uses GSAP ScrollTrigger from @/lib/gsap
- Skeleton shows while loading
- Stagger animation plays once on scroll into view
</verification>

<success_criteria>
- MenuSkeletonV8 displays shimmer loading states
- MenuGridV8 animates cards with GSAP staggered reveal
- MenuContentV8 composes tabs, search, grid, and item detail
- All V8 menu components exported from index.ts
- Ready for page integration (replace V6/V7 menu components)
</success_criteria>

<output>
After completion, create `.planning/phases/05-menu-browsing/05-05-SUMMARY.md`
</output>
