---
phase: 07-quality-testing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - e2e/visual-regression.spec.ts
autonomous: true

must_haves:
  truths:
    - "Visual regression snapshots exist for V8 header (desktop + mobile)"
    - "Visual regression snapshots exist for V8 cart drawer (desktop + mobile)"
    - "Visual regression snapshots exist for V8 overlays (modal, bottom sheet, dropdown)"
  artifacts:
    - path: "e2e/visual-regression.spec.ts"
      provides: "Visual regression tests including V8 components"
      contains: "V8 Visual Regression"
  key_links:
    - from: "e2e/visual-regression.spec.ts"
      to: "toHaveScreenshot"
      via: "Playwright assertion"
      pattern: "toHaveScreenshot.*v8-"
---

<objective>
Add V8-specific visual regression snapshots for header, overlays, and cart drawer.

Purpose: Capture baseline screenshots for V8 components to detect visual regressions.
Output: Extended `e2e/visual-regression.spec.ts` with V8 snapshot tests
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-quality-testing/07-RESEARCH.md
@e2e/visual-regression.spec.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: V8 Header and Navigation snapshots</name>
  <files>e2e/visual-regression.spec.ts</files>
  <action>
Add V8 Header Visual Regression section to `e2e/visual-regression.spec.ts` before the closing of the file:

```typescript
test.describe("V8 Header Visual Regression (TEST-05)", () => {
  test("v8 header - desktop", async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");
    await page.waitForTimeout(500);

    const header = page.locator("header").first();
    await expect(header).toHaveScreenshot("v8-header-desktop.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 header - mobile", async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });
    await page.goto("/");
    await page.waitForLoadState("networkidle");
    await page.waitForTimeout(500);

    const header = page.locator("header").first();
    await expect(header).toHaveScreenshot("v8-header-mobile.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 header with scroll - desktop", async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    // Scroll down to trigger header shrink effect
    await page.evaluate(() => window.scrollTo(0, 200));
    await page.waitForTimeout(500);

    const header = page.locator("header").first();
    await expect(header).toHaveScreenshot("v8-header-scrolled-desktop.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 bottom nav - mobile", async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });
    await page.goto("/");
    await page.waitForLoadState("networkidle");
    await page.waitForTimeout(500);

    const bottomNav = page.locator("nav").last();
    await expect(bottomNav).toHaveScreenshot("v8-bottom-nav-mobile.png", {
      maxDiffPixels: 100,
    });
  });
});
```

Notes:
- Use `maxDiffPixels: 100` for full component snapshots
- Wait 500ms for animations/fonts to settle
- Capture scrolled header state to verify shrink effect
  </action>
  <verify>Visual regression spec contains "V8 Header Visual Regression" describe block</verify>
  <done>V8 header snapshots added: desktop, mobile, scrolled, bottom nav</done>
</task>

<task type="auto">
  <name>Task 2: V8 Overlay and Cart Drawer snapshots</name>
  <files>e2e/visual-regression.spec.ts</files>
  <action>
Add V8 Overlay and Cart Visual Regression sections to `e2e/visual-regression.spec.ts`:

```typescript
test.describe("V8 Overlay Visual Regression (TEST-05)", () => {
  test("v8 modal open - desktop", async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    // Open item detail modal
    await page.locator('[data-testid="menu-item"]').first().click();
    await page.waitForTimeout(400);

    const modal = page.getByRole("dialog");
    await expect(modal).toHaveScreenshot("v8-modal-desktop.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 bottom sheet - mobile", async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    // Open item detail (renders as bottom sheet on mobile)
    await page.locator('[data-testid="menu-item"]').first().click();
    await page.waitForTimeout(400);

    const sheet = page.getByRole("dialog");
    await expect(sheet).toHaveScreenshot("v8-bottom-sheet-mobile.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 dropdown open", async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    const dropdownTrigger = page.locator('[data-testid="profile-button"]');

    if (await dropdownTrigger.isVisible()) {
      await dropdownTrigger.click();
      await page.waitForTimeout(300);

      const dropdown = page.locator('[data-testid="dropdown-content"]');
      await expect(dropdown).toHaveScreenshot("v8-dropdown-open.png", {
        maxDiffPixels: 50,
      });
    }
  });
});

test.describe("V8 Cart Drawer Visual Regression (TEST-05)", () => {
  test.beforeEach(async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    // Add item to cart
    const menuItem = page.locator('[data-testid="menu-item"]').first();
    if (await menuItem.isVisible()) {
      await menuItem.click();
      await page.getByRole("button", { name: /add to cart/i }).click();
      await page.keyboard.press("Escape");
      await page.waitForTimeout(400);
    }
  });

  test("v8 cart drawer with items - desktop", async ({ page }) => {
    await page.locator('[data-testid="cart-button"]').click();
    await page.waitForTimeout(400);

    const drawer = page.getByRole("dialog");
    await expect(drawer).toHaveScreenshot("v8-cart-drawer-items-desktop.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 cart drawer with items - mobile", async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });

    await page.locator('[data-testid="cart-button"]').click();
    await page.waitForTimeout(400);

    const drawer = page.getByRole("dialog");
    await expect(drawer).toHaveScreenshot("v8-cart-drawer-items-mobile.png", {
      maxDiffPixels: 100,
    });
  });

  test("v8 cart button with badge", async ({ page }) => {
    const cartButton = page.locator('[data-testid="cart-button"]');
    await expect(cartButton).toHaveScreenshot("v8-cart-button-badge.png", {
      maxDiffPixels: 30,
    });
  });
});

test.describe("V8 Empty Cart Visual Regression (TEST-05)", () => {
  test("v8 empty cart drawer", async ({ page }) => {
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    const cartButton = page.locator('[data-testid="cart-button"]');
    if (await cartButton.isVisible()) {
      await cartButton.click();
      await page.waitForTimeout(400);

      const drawer = page.getByRole("dialog");
      await expect(drawer).toHaveScreenshot("v8-cart-empty.png", {
        maxDiffPixels: 100,
      });
    }
  });
});
```

Notes:
- Use smaller `maxDiffPixels: 30-50` for small components (buttons, dropdowns)
- Use `maxDiffPixels: 100` for full components
- Conditional tests for optional elements (profile dropdown)
- Both desktop and mobile versions for responsive components
  </action>
  <verify>Visual regression spec contains "V8 Overlay Visual Regression" and "V8 Cart Drawer Visual Regression" blocks</verify>
  <done>V8 overlay snapshots added: modal, bottom sheet, dropdown, cart drawer (desktop + mobile), empty cart, badge</done>
</task>

</tasks>

<verification>
Generate baseline snapshots:
```bash
pnpm exec playwright test e2e/visual-regression.spec.ts --grep "V8" --update-snapshots
```

Verify snapshots created in `e2e/__snapshots__/`:
```bash
ls e2e/__snapshots__/ | grep v8
```

Expected files:
- v8-header-desktop.png
- v8-header-mobile.png
- v8-header-scrolled-desktop.png
- v8-bottom-nav-mobile.png
- v8-modal-desktop.png
- v8-bottom-sheet-mobile.png
- v8-dropdown-open.png
- v8-cart-drawer-items-desktop.png
- v8-cart-drawer-items-mobile.png
- v8-cart-button-badge.png
- v8-cart-empty.png
</verification>

<success_criteria>
- [ ] V8 Header Visual Regression section exists with desktop/mobile/scrolled tests
- [ ] V8 Overlay Visual Regression section exists with modal/bottom sheet/dropdown tests
- [ ] V8 Cart Drawer Visual Regression section exists with items and empty state tests
- [ ] All snapshots use v8- prefix for easy identification
- [ ] Both desktop and mobile viewports covered for responsive components
</success_criteria>

<output>
After completion, create `.planning/phases/07-quality-testing/07-02-SUMMARY.md`
</output>
