---
phase: 26-component-consolidation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/Portal.tsx
  - src/components/ui/Backdrop.tsx
  - src/components/ui/Modal.tsx
  - src/components/ui/Drawer.tsx
  - src/components/ui/Toast.tsx
  - src/components/ui/ToastProvider.tsx
  - src/components/ui/Tooltip.tsx
  - src/components/ui/Dropdown.tsx
autonomous: true

must_haves:
  truths:
    - "V8 Modal replaces V5 Modal in ui/"
    - "V8 Drawer has position='bottom' support (merged BottomSheet)"
    - "V8 Toast is declarative only"
    - "V8 Tooltip replaces CSS-only tooltip"
    - "Portal and Backdrop components exist in ui/"
  artifacts:
    - path: "src/components/ui/Modal.tsx"
      provides: "V8 Modal with swipe-to-dismiss, route-aware close"
      min_lines: 300
    - path: "src/components/ui/Drawer.tsx"
      provides: "Unified Drawer with position prop including 'bottom'"
      contains: "position.*bottom"
    - path: "src/components/ui/Tooltip.tsx"
      provides: "V8 Tooltip with delay and keyboard support"
      contains: "delayDuration"
    - path: "src/components/ui/Portal.tsx"
      provides: "Portal component from ui-v8"
    - path: "src/components/ui/Backdrop.tsx"
      provides: "Backdrop component from ui-v8"
  key_links:
    - from: "src/components/ui/Modal.tsx"
      to: "src/components/ui/Portal.tsx"
      via: "import"
      pattern: "import.*Portal"
    - from: "src/components/ui/Drawer.tsx"
      to: "src/components/ui/Backdrop.tsx"
      via: "import"
      pattern: "import.*Backdrop"
---

<objective>
Migrate and merge overlay components from ui-v8/ to ui/.

Purpose: Replace V5/Radix overlay implementations with V8 custom implementations, merge BottomSheet into Drawer.
Output: Unified overlay components (Modal, Drawer, Toast, Tooltip) in ui/ directory, old implementations removed.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-component-consolidation/26-CONTEXT.md
@.planning/phases/26-component-consolidation/26-RESEARCH.md
@src/components/ui-v8/Modal.tsx
@src/components/ui-v8/Drawer.tsx
@src/components/ui-v8/BottomSheet.tsx
@src/components/ui-v8/Toast.tsx
@src/components/ui-v8/ToastProvider.tsx
@src/components/ui-v8/Tooltip.tsx
@src/components/ui-v8/Dropdown.tsx
@src/components/ui-v8/overlay/Portal.tsx
@src/components/ui-v8/overlay/Backdrop.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Portal and Backdrop</name>
  <files>src/components/ui/Portal.tsx, src/components/ui/Backdrop.tsx</files>
  <action>
Use `git mv` to preserve history:
```bash
git mv src/components/ui-v8/overlay/Portal.tsx src/components/ui/Portal.tsx
git mv src/components/ui-v8/overlay/Backdrop.tsx src/components/ui/Backdrop.tsx
```

Update any internal imports in these files from ui-v8 paths to relative paths within ui/.
  </action>
  <verify>
- Files exist in src/components/ui/
- `git log --oneline src/components/ui/Portal.tsx` shows history
  </verify>
  <done>Portal and Backdrop migrated to ui/ with git history preserved</done>
</task>

<task type="auto">
  <name>Task 2: Migrate and merge Modal</name>
  <files>src/components/ui/Modal.tsx</files>
  <action>
1. Backup current Modal.tsx content (745 lines V5)
2. Use `git mv` to move V8 Modal:
   ```bash
   git rm src/components/ui/Modal.tsx
   git mv src/components/ui-v8/Modal.tsx src/components/ui/Modal.tsx
   ```
3. Update V8 Modal imports:
   - FROM: `from "@/components/ui-v8/overlay/Portal"`
   - TO: `from "./Portal"`
   - FROM: `from "@/components/ui-v8/overlay/Backdrop"`
   - TO: `from "./Backdrop"`

4. Add useModal hook from V5 implementation if not present:
   ```typescript
   export function useModal(initialOpen = false) {
     const [isOpen, setIsOpen] = useState(initialOpen);
     return {
       isOpen,
       open: () => setIsOpen(true),
       close: () => setIsOpen(false),
       toggle: () => setIsOpen(prev => !prev),
     };
   }
   ```

5. Ensure ModalHeader, ModalBody, ModalFooter subcomponents exist or are added.

6. Delete old overlay-base.tsx which had V5 Modal/BottomSheet/SideDrawer:
   ```bash
   git rm src/components/ui/overlay-base.tsx
   ```
  </action>
  <verify>
- src/components/ui/Modal.tsx exists with V8 implementation
- useModal hook exported
- overlay-base.tsx deleted
- No TypeScript errors
  </verify>
  <done>V8 Modal migrated to ui/ with useModal hook, overlay-base.tsx removed</done>
</task>

<task type="auto">
  <name>Task 3: Migrate Drawer and merge BottomSheet</name>
  <files>src/components/ui/Drawer.tsx</files>
  <action>
1. Remove Vaul-based drawer.tsx:
   ```bash
   git rm src/components/ui/drawer.tsx
   ```

2. Move V8 Drawer:
   ```bash
   git mv src/components/ui-v8/Drawer.tsx src/components/ui/Drawer.tsx
   ```

3. Read BottomSheet.tsx and merge its position='bottom' behavior into Drawer:
   - Add `position?: 'left' | 'right' | 'bottom'` prop (default: 'right')
   - When position='bottom':
     - Use slide-up animation from BottomSheet
     - Show drag handle
     - Enable swipe-to-dismiss vertically
     - Use height prop instead of width
   - When position='left' or 'right':
     - Keep existing side drawer behavior

4. Update imports to use relative paths within ui/.

5. Delete BottomSheet.tsx (functionality merged):
   ```bash
   git rm src/components/ui-v8/BottomSheet.tsx
   ```

6. Export BottomSheet as alias for backwards compatibility:
   ```typescript
   // Backwards compatibility alias
   export const BottomSheet = (props: DrawerProps) => (
     <Drawer {...props} position="bottom" />
   );
   ```
  </action>
  <verify>
- src/components/ui/Drawer.tsx exists with position prop
- Vaul drawer.tsx deleted
- BottomSheet.tsx deleted
- BottomSheet alias exported
  </verify>
  <done>Drawer migrated with BottomSheet merged, position='bottom' support added</done>
</task>

</tasks>

<verification>
```bash
# Check files exist
ls src/components/ui/Portal.tsx src/components/ui/Backdrop.tsx src/components/ui/Modal.tsx src/components/ui/Drawer.tsx

# Check deleted files gone
ls src/components/ui/overlay-base.tsx 2>&1 | grep -q "No such file" && echo "OK: overlay-base deleted"
ls src/components/ui/drawer.tsx 2>&1 | grep -q "No such file" && echo "OK: vaul drawer deleted"
ls src/components/ui-v8/BottomSheet.tsx 2>&1 | grep -q "No such file" && echo "OK: BottomSheet deleted"

# TypeScript check
pnpm typecheck
```
</verification>

<success_criteria>
- Portal, Backdrop, Modal, Drawer exist in ui/
- overlay-base.tsx deleted
- Vaul drawer.tsx deleted
- BottomSheet.tsx deleted and merged into Drawer
- Drawer has position='bottom' support
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/26-component-consolidation/26-02-SUMMARY.md`
</output>
