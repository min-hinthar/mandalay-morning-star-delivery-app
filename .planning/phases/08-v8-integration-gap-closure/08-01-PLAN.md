---
phase: 08-v8-integration-gap-closure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/providers.tsx
  - src/app/(public)/menu/page.tsx
autonomous: false

must_haves:
  truths:
    - "Menu page renders V8 components (scrollspy tabs, animated cards, search)"
    - "User can click menu item to open detail sheet"
    - "User can add item to cart and see flying animation"
    - "Badge pulses after fly animation completes"
    - "Menu loads with skeleton then shows content"
  artifacts:
    - path: "src/app/providers.tsx"
      provides: "FlyToCart global mount"
      contains: "<FlyToCart"
    - path: "src/app/(public)/menu/page.tsx"
      provides: "MenuContentV8 integration"
      contains: "MenuContentV8"
  key_links:
    - from: "src/app/(public)/menu/page.tsx"
      to: "@/components/ui-v8/menu"
      via: "import MenuContentV8"
      pattern: "import.*MenuContentV8.*from.*ui-v8/menu"
    - from: "src/app/providers.tsx"
      to: "@/components/ui-v8/cart"
      via: "import FlyToCart"
      pattern: "import.*FlyToCart.*from.*ui-v8/cart"
    - from: "ItemDetailSheetV8"
      to: "FlyToCart"
      via: "useFlyToCart hook + cart-animation-store"
      pattern: "useFlyToCart"
---

<objective>
Wire orphaned V8 menu components and FlyToCart into the live application to close integration gaps from milestone audit.

Purpose: Phase 5 built substantive V8 menu components, but they're orphaned (not imported). Phase 4 built FlyToCart celebration animation, but it's not mounted. This plan connects everything.

Output: Menu page using full V8 component tree, FlyToCart globally mounted, end-to-end menu-to-cart flow working with animations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-v8-integration-gap-closure/08-RESEARCH.md

# Source files to modify
@src/app/providers.tsx
@src/app/(public)/menu/page.tsx

# V8 components being integrated (reference only)
@src/components/ui-v8/menu/index.ts
@src/components/ui-v8/cart/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mount FlyToCart globally in providers</name>
  <files>src/app/providers.tsx</files>
  <action>
Add FlyToCart to the cart import and mount it after CartDrawerV8:

1. Update import (line 6):
   ```tsx
   import { CartDrawerV8, FlyToCart } from "@/components/ui-v8/cart";
   ```

2. Add FlyToCart after CartDrawerV8 (after line 27):
   ```tsx
   <CartDrawerV8 />
   <FlyToCart />
   ```

WHY: FlyToCart renders a container that receives flying elements during add-to-cart. It reads badge position from cart-animation-store (already populated by CartButtonV8 in Header). Must be mounted at app level to persist across pages.
  </action>
  <verify>
`pnpm typecheck` passes.
Grep confirms: `grep "FlyToCart" src/app/providers.tsx` returns both import and JSX usage.
  </verify>
  <done>FlyToCart imported and rendered in providers.tsx after CartDrawerV8</done>
</task>

<task type="auto">
  <name>Task 2: Replace legacy MenuContent with MenuContentV8</name>
  <files>src/app/(public)/menu/page.tsx</files>
  <action>
Replace the entire menu page implementation:

1. Remove legacy imports (lines 1-4):
   - Remove: `import { Suspense } from "react";`
   - Remove: `import { getMenuWithCategories } from "@/lib/queries/menu";`
   - Remove: `import { MenuContent } from "@/components/menu/menu-content";`
   - Remove: `import { MenuSkeleton } from "@/components/menu/menu-skeleton";`

2. Add V8 import:
   ```tsx
   import { MenuContentV8 } from "@/components/ui-v8/menu";
   ```

3. Keep metadata export (lines 6-9) unchanged.

4. Replace MenuPage function body (lines 11-18):
   ```tsx
   export default function MenuPage() {
     return (
       <main className="min-h-screen bg-background">
         <MenuContentV8 />
       </main>
     );
   }
   ```

5. Remove MenuLoader async function (lines 21-24) entirely.

WHY:
- MenuContentV8 fetches data internally via useMenu() hook - no server-side props needed
- MenuContentV8 handles loading state internally via MenuSkeletonV8 - no Suspense needed
- MenuContentV8 handles error/empty states internally - simpler page component
  </action>
  <verify>
`pnpm typecheck` passes.
`pnpm build` passes (menu page compiles).
File is shorter (~15 lines vs 24 lines).
  </verify>
  <done>menu/page.tsx imports and renders MenuContentV8 with no server-side data fetching wrapper</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
V8 menu integration with FlyToCart celebration animation:
- MenuContentV8 renders full V8 menu system (scrollspy, search, animated cards)
- FlyToCart mounted globally to receive flying elements
- End-to-end flow: browse menu -> open item -> add to cart -> flying animation
  </what-built>
  <how-to-verify>
1. Start dev server: `pnpm dev`
2. Navigate to http://localhost:3000/menu
3. Verify V8 components render:
   - Category tabs appear at top with scrollspy (scroll and watch active tab change)
   - Menu items show as animated cards with hover effects
   - Search input visible
   - Skeleton shows briefly on initial load

4. Test add-to-cart flow:
   - Click any menu item card
   - Item detail sheet/modal opens (BottomSheet on mobile, Modal on desktop)
   - Click "Add to Cart" button
   - Verify: flying element animates from button toward cart badge in header
   - Verify: cart badge pulses after animation
   - Verify: badge count increments

5. Open cart drawer, verify item appears in cart

Expected: All steps complete with visible animations. No console errors.
  </how-to-verify>
  <resume-signal>Type "approved" if flow works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
**Automated checks:**
- `pnpm typecheck` - Type safety
- `pnpm build` - Production build succeeds
- `grep "FlyToCart" src/app/providers.tsx` - FlyToCart mounted
- `grep "MenuContentV8" src/app/(public)/menu/page.tsx` - V8 component used

**Manual verification:**
- Menu page loads with V8 skeleton then content
- Scrollspy tabs respond to scroll position
- Item cards have hover animations
- Detail sheet opens on item click
- Add-to-cart triggers flying animation to badge
- Badge pulses and increments
</verification>

<success_criteria>
1. Menu page renders MenuContentV8 (no legacy MenuContent)
2. FlyToCart is mounted in providers.tsx
3. Scrollspy tabs work (MENU-01)
4. Menu cards have effects (MENU-02)
5. Detail sheet opens (MENU-03)
6. Search visible (MENU-04)
7. Skeleton loading works (MENU-05)
8. Staggered reveal on scroll (MENU-06)
9. Blur-up images (MENU-07)
10. Heart animation on favorites (MENU-08)
11. Emoji placeholders for items without images (MENU-09)
12. Flying animation + badge pulse on add-to-cart (CART-05)
13. Build passes: `pnpm lint && pnpm typecheck && pnpm build`
</success_criteria>

<output>
After completion, create `.planning/phases/08-v8-integration-gap-closure/08-01-SUMMARY.md`
</output>
