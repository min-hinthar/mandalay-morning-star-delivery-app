---
phase: 09-analysis-component-creation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - e2e/visual-regression.spec.ts
  - e2e/visual-regression.spec.ts-snapshots/**
autonomous: false

must_haves:
  truths:
    - "Visual regression baselines exist for all 11 pending pages"
    - "Baselines cover both desktop and mobile viewports"
    - "Tests run without failures after baseline generation"
  artifacts:
    - path: "e2e/visual-regression.spec.ts-snapshots"
      provides: "Baseline screenshot images"
    - path: "e2e/visual-regression.spec.ts"
      provides: "Visual regression test suite"
  key_links:
    - from: "e2e/visual-regression.spec.ts"
      to: "playwright.config.ts"
      via: "config"
      pattern: "toHaveScreenshot"
---

<objective>
Generate visual regression baseline snapshots for all 11 pending pages.

Purpose: Establish baseline screenshots for visual regression testing to catch UI regressions in future changes.
Output: Snapshot baseline images in e2e/visual-regression.spec.ts-snapshots/ directory.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-analysis-component-creation/09-RESEARCH.md

# Test references
@e2e/visual-regression.spec.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate visual regression baselines</name>
  <files>
    e2e/visual-regression.spec.ts-snapshots/**
  </files>
  <action>
    1. Ensure dev server is running or will start:
       - Check if already running: `curl -s http://localhost:3000 > /dev/null`
       - If not, playwright will start it via webServer config

    2. Run visual regression tests with snapshot update:
       ```bash
       pnpm exec playwright test e2e/visual-regression.spec.ts --update-snapshots
       ```

    3. This will generate baseline snapshots for all tests in the spec file.

    The 11 pending pages from research (most already have tests in visual-regression.spec.ts):
    | Page | Test Coverage |
    |------|--------------|
    | Admin Dashboard | "admin dashboard" test |
    | Admin Analytics | Needs test if missing |
    | Admin Orders | Needs test if missing |
    | Driver Dashboard | "driver dashboard" test |
    | Driver Route | Needs test if missing |
    | Order Tracking | Needs test if missing |
    | Order History | Needs test if missing |
    | Order Confirmation | Needs test if missing |
    | Checkout Steps | "checkout page" test |
    | Forgot Password | Needs test if missing |
    | Cart Page | Cart tests exist |

    Note: Some tests may fail due to auth requirements. That's expected - baselines will be generated for unauthenticated states (login redirects).
  </action>
  <verify>
    - Snapshots directory exists: `test -d e2e/visual-regression.spec.ts-snapshots`
    - Multiple snapshots generated: `ls e2e/visual-regression.spec.ts-snapshots/*.png | wc -l` > 10
  </verify>
  <done>
    Baseline snapshots generated for existing visual regression tests.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add missing visual regression tests for 11 pages</name>
  <files>
    e2e/visual-regression.spec.ts
  </files>
  <action>
    Review visual-regression.spec.ts and add any missing tests for the 11 pending pages.

    Add these test blocks if not present:

    ```typescript
    test.describe("Order Pages Visual Regression", () => {
      test("order tracking page", async ({ page }) => {
        // Use a mock order ID since we don't have real data
        await page.goto("/orders/test-order-id/tracking");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        // May redirect to login or show error, capture that state
        await expect(page).toHaveScreenshot("order-tracking.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });

      test("order history page", async ({ page }) => {
        await page.goto("/orders");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        await expect(page).toHaveScreenshot("order-history.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });

      test("order confirmation page", async ({ page }) => {
        await page.goto("/orders/test-order-id/confirmation");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        await expect(page).toHaveScreenshot("order-confirmation.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });
    });

    test.describe("Admin Pages Visual Regression", () => {
      test("admin analytics page", async ({ page }) => {
        await page.goto("/admin/analytics");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        await expect(page).toHaveScreenshot("admin-analytics.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });

      test("admin orders page", async ({ page }) => {
        await page.goto("/admin/orders");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        await expect(page).toHaveScreenshot("admin-orders.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });
    });

    test.describe("Driver Pages Visual Regression", () => {
      test("driver route page", async ({ page }) => {
        await page.goto("/driver/route");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(500);

        await expect(page).toHaveScreenshot("driver-route.png", {
          fullPage: true,
          maxDiffPixels: 150,
        });
      });
    });

    test.describe("Auth Pages Visual Regression", () => {
      test("forgot password page", async ({ page }) => {
        await page.goto("/forgot-password");
        await page.waitForLoadState("networkidle");
        await page.waitForTimeout(300);

        await expect(page).toHaveScreenshot("forgot-password.png", {
          fullPage: true,
          maxDiffPixels: 100,
        });
      });
    });
    ```

    Skip adding tests that already exist. Check for duplicates before adding.
  </action>
  <verify>
    - Tests for all pages exist: `grep -c "toHaveScreenshot" e2e/visual-regression.spec.ts` >= 30
    - No syntax errors: `pnpm exec playwright test --list e2e/visual-regression.spec.ts`
  </verify>
  <done>
    Visual regression tests exist for all 11 pending pages.
  </done>
</task>

<task type="auto">
  <name>Task 3: Regenerate baselines with complete test suite</name>
  <files>
    e2e/visual-regression.spec.ts-snapshots/**
  </files>
  <action>
    After adding missing tests, regenerate all baselines:

    ```bash
    pnpm exec playwright test e2e/visual-regression.spec.ts --update-snapshots
    ```

    Count generated snapshots to verify completeness.
  </action>
  <verify>
    - Snapshots for new tests: `ls e2e/visual-regression.spec.ts-snapshots/*tracking*.png 2>/dev/null || echo "Tracking snapshot needs check"`
    - Tests pass with baselines: `pnpm exec playwright test e2e/visual-regression.spec.ts`
  </verify>
  <done>
    All visual regression tests pass with generated baseline snapshots.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Visual regression baseline snapshots for 11 pages</what-built>
  <how-to-verify>
    1. Review generated snapshots in `e2e/visual-regression.spec.ts-snapshots/`
    2. Verify key pages have reasonable baselines:
       - Homepage desktop/mobile
       - Admin dashboard (may show login)
       - Driver dashboard (may show login)
       - Checkout page
       - Cart drawer
    3. Run visual regression tests to confirm baselines work:
       ```bash
       pnpm exec playwright test e2e/visual-regression.spec.ts
       ```
    4. Confirm tests pass (no unexpected diffs)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with specific snapshots</resume-signal>
</task>

</tasks>

<verification>
Run full visual regression suite:
```bash
pnpm exec playwright test e2e/visual-regression.spec.ts
```

All tests should pass with the generated baselines.
</verification>

<success_criteria>
1. Snapshot directory exists with baseline images
2. Tests cover all 11 pending pages (admin, driver, orders, auth flows)
3. Visual regression tests pass without failures
4. Baselines reviewed and approved by human
</success_criteria>

<output>
After completion, create `.planning/phases/09-analysis-component-creation/09-02-SUMMARY.md`
</output>
