---
phase: 09-analysis-component-creation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - .planning/phases/09-analysis-component-creation/dead-code-report.md
  - src/components/checkout/TimeStepV8.tsx
  - src/components/checkout/index.ts
  - src/lib/utils/delivery-dates.ts
autonomous: true

must_haves:
  truths:
    - "Dead code analysis report exists with reference counts for all exports"
    - "TimeStepV8 component renders with V8 animation patterns"
    - "TimeStepV8 uses enhanced TimeSlotPicker (not Legacy)"
    - "TimeStepV8 respects reduced motion preference"
  artifacts:
    - path: ".planning/phases/09-analysis-component-creation/dead-code-report.md"
      provides: "Dead code analysis with export reference counts"
      contains: "Reference Count"
    - path: "src/components/checkout/TimeStepV8.tsx"
      provides: "V8 time step component"
      min_lines: 80
      exports: ["TimeStepV8", "TimeStepV8Props"]
    - path: "src/components/checkout/index.ts"
      provides: "Barrel exports including TimeStepV8"
      contains: "TimeStepV8"
  key_links:
    - from: "src/components/checkout/TimeStepV8.tsx"
      to: "src/components/checkout/TimeSlotPicker.tsx"
      via: "import"
      pattern: "import.*TimeSlotPicker"
    - from: "src/components/checkout/TimeStepV8.tsx"
      to: "src/lib/motion-tokens.ts"
      via: "import"
      pattern: "import.*motion-tokens"
    - from: "src/components/checkout/TimeStepV8.tsx"
      to: "src/lib/hooks/useAnimationPreference.ts"
      via: "import"
      pattern: "import.*useAnimationPreference"
---

<objective>
Run dead code analysis on all exports and create TimeStepV8 component.

Purpose: Establish baseline for dead code cleanup and provide V8 version of time step for checkout flow.
Output: Dead code report with reference counts; TimeStepV8 component following V8 patterns.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-analysis-component-creation/09-RESEARCH.md

# V8 pattern references
@src/components/checkout/PaymentStepV8.tsx
@src/components/checkout/AddressStepV8.tsx
@src/components/checkout/TimeSlotPicker.tsx
@src/components/checkout/TimeStep.tsx
@src/components/checkout/index.ts
@src/lib/motion-tokens.ts
@src/lib/hooks/useAnimationPreference.ts
@src/lib/utils/delivery-dates.ts
@src/types/delivery.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install knip and generate dead code analysis report</name>
  <files>
    package.json
    .planning/phases/09-analysis-component-creation/dead-code-report.md
  </files>
  <action>
    1. Install knip as dev dependency: `pnpm add -D knip`
    2. Create knip.json config at project root:
       ```json
       {
         "$schema": "https://unpkg.com/knip@latest/schema.json",
         "entry": ["src/app/**/*.{ts,tsx}", "src/components/**/index.ts"],
         "project": ["src/**/*.{ts,tsx}"],
         "ignore": ["**/*.test.{ts,tsx}", "**/*.spec.{ts,tsx}", "**/*.stories.{ts,tsx}"],
         "ignoreDependencies": ["@types/*"]
       }
       ```
    3. Run knip analysis: `pnpm knip --reporter json > knip-output.json`
    4. Parse output and create dead-code-report.md with:
       - Summary table (total exports, unused count, by category)
       - Detailed listing of unused exports by file
       - Reference counts where available
       - Categorization: components, hooks, utils, types
    5. Delete temporary knip-output.json after parsing

    Report format:
    ```markdown
    # Dead Code Analysis Report
    **Generated:** YYYY-MM-DD
    **Tool:** knip

    ## Summary
    | Category | Total | Unused | Percentage |
    |----------|-------|--------|------------|
    | Components | X | Y | Z% |
    ...

    ## Unused Exports by File
    ### src/components/ui/index.ts
    - `ComponentName` (0 references)
    ...
    ```
  </action>
  <verify>
    - knip exists in devDependencies: `grep knip package.json`
    - Report exists: `test -f .planning/phases/09-analysis-component-creation/dead-code-report.md`
    - Report has content: `wc -l .planning/phases/09-analysis-component-creation/dead-code-report.md` > 20 lines
  </verify>
  <done>
    Dead code report exists with categorized unused exports and reference counts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimeStepV8 component with V8 patterns</name>
  <files>
    src/components/checkout/TimeStepV8.tsx
    src/lib/utils/delivery-dates.ts
  </files>
  <action>
    1. Add `getAvailableDeliveryDates()` function to delivery-dates.ts:
       - Returns array of next 3 Saturdays as DeliveryDate[]
       - Marks cutoff status for each
       - Uses existing helpers (getNextSaturday, addZonedDays, isPastCutoff)

    2. Create TimeStepV8.tsx following PaymentStepV8/AddressStepV8 patterns:

       Structure:
       ```typescript
       "use client";

       import { useCallback, useMemo } from "react";
       import { motion } from "framer-motion";
       import { Clock, ArrowLeft } from "lucide-react";
       import { cn } from "@/lib/utils/cn";
       import { variants } from "@/lib/motion-tokens";
       import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";
       import { useCheckoutStore } from "@/lib/stores/checkout-store";
       import { getAvailableDeliveryDates } from "@/lib/utils/delivery-dates";
       import { TimeSlotPicker } from "./TimeSlotPicker";
       import { Button } from "@/components/ui/button";
       import type { DeliverySelection } from "@/types/delivery";

       export interface TimeStepV8Props {
         className?: string;
       }

       export function TimeStepV8({ className }: TimeStepV8Props) {
         const { shouldAnimate } = useAnimationPreference();
         const { delivery, setDelivery, nextStep, prevStep, canProceed } = useCheckoutStore();

         const availableDates = useMemo(() => getAvailableDeliveryDates(), []);

         const handleSelectionChange = useCallback((selection: DeliverySelection) => {
           setDelivery(selection);
         }, [setDelivery]);

         return (
           <div className={cn("space-y-6", className)}>
             {/* Header - V8 colors */}
             <motion.div
               variants={shouldAnimate ? variants.slideUp : undefined}
               initial={shouldAnimate ? "initial" : undefined}
               animate={shouldAnimate ? "animate" : undefined}
             >
               <div className="flex items-center gap-2 mb-1">
                 <Clock className="h-5 w-5 text-primary" />
                 <h2 className="font-display text-lg font-semibold text-foreground">
                   Delivery Time
                 </h2>
               </div>
               <p className="font-body text-sm text-muted-foreground">
                 Choose your preferred delivery window
               </p>
             </motion.div>

             {/* Time slot picker */}
             <motion.div
               variants={shouldAnimate ? variants.slideUp : undefined}
               initial={shouldAnimate ? "initial" : undefined}
               animate={shouldAnimate ? "animate" : undefined}
               transition={{ delay: 0.1 }}
             >
               <TimeSlotPicker
                 availableDates={availableDates}
                 selectedDelivery={delivery}
                 onSelectionChange={handleSelectionChange}
               />
             </motion.div>

             {/* Navigation - matches PaymentStepV8 */}
             <motion.div
               variants={shouldAnimate ? variants.slideUp : undefined}
               initial={shouldAnimate ? "initial" : undefined}
               animate={shouldAnimate ? "animate" : undefined}
               transition={{ delay: 0.2 }}
               className="flex justify-between pt-4 border-t border-border"
             >
               <Button variant="ghost" onClick={prevStep}>
                 <ArrowLeft className="mr-2 h-4 w-4" />
                 Back
               </Button>
               <Button onClick={nextStep} disabled={!canProceed()} size="lg">
                 Continue to Payment
               </Button>
             </motion.div>
           </div>
         );
       }

       export default TimeStepV8;
       ```

    Key V8 requirements (DO NOT skip):
    - Use `text-foreground` not `text-text-primary`
    - Use `text-muted-foreground` not `text-text-secondary`
    - Use `useAnimationPreference` hook with `shouldAnimate` conditionals
    - Import from `@/lib/motion-tokens` not inline animation values
    - Use enhanced TimeSlotPicker (not TimeSlotPickerLegacy)
  </action>
  <verify>
    - File exists: `test -f src/components/checkout/TimeStepV8.tsx`
    - Uses V8 colors: `grep -q "text-foreground" src/components/checkout/TimeStepV8.tsx`
    - Uses animation preference: `grep -q "useAnimationPreference" src/components/checkout/TimeStepV8.tsx`
    - Uses enhanced picker: `grep -q 'TimeSlotPicker"' src/components/checkout/TimeStepV8.tsx`
    - No V6 colors: `! grep -q "text-text-primary" src/components/checkout/TimeStepV8.tsx`
    - TypeScript compiles: `pnpm typecheck`
  </verify>
  <done>
    TimeStepV8.tsx exists with V8 patterns: motion tokens, animation preference, V8 color classes, enhanced TimeSlotPicker.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update checkout barrel exports</name>
  <files>
    src/components/checkout/index.ts
  </files>
  <action>
    Update src/components/checkout/index.ts to export TimeStepV8:

    1. Add V8 component export (near other V8 exports):
       ```typescript
       export { TimeStepV8 } from "./TimeStepV8";
       ```

    2. Add re-export as default name for migration (after existing re-exports):
       ```typescript
       export { TimeStepV8 as TimeStep } from "./TimeStepV8";
       ```

    3. Update legacy export to have "Legacy" suffix:
       ```typescript
       // Change: export { TimeStep } from "./TimeStep";
       // To: export { TimeStep as TimeStepLegacy } from "./TimeStep";
       ```

    Final barrel should have:
    - TimeStepV8 (explicit V8 export)
    - TimeStep (alias pointing to TimeStepV8)
    - TimeStepLegacy (legacy V6 version)
  </action>
  <verify>
    - TimeStepV8 exported: `grep -q "TimeStepV8" src/components/checkout/index.ts`
    - TimeStep alias: `grep -q 'TimeStepV8 as TimeStep' src/components/checkout/index.ts`
    - Build passes: `pnpm build`
  </verify>
  <done>
    Barrel exports TimeStepV8 as both explicit name and as TimeStep alias. Legacy renamed to TimeStepLegacy.
  </done>
</task>

</tasks>

<verification>
Run verification sequence:
```bash
pnpm typecheck && pnpm lint && pnpm test && pnpm build
```

All must pass. TimeStepV8 should be importable from `@/components/checkout`.
</verification>

<success_criteria>
1. Dead code report exists at `.planning/phases/09-analysis-component-creation/dead-code-report.md`
2. Report contains categorized unused exports with reference counts
3. TimeStepV8.tsx exists with V8 patterns (motion tokens, animation preference, V8 colors)
4. TimeStepV8 uses enhanced TimeSlotPicker (not Legacy)
5. Barrel exports include TimeStepV8 and TimeStep alias
6. Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-analysis-component-creation/09-01-SUMMARY.md`
</output>
