---
phase: 10-token-migration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tracking/TrackingMap.tsx
  - src/components/tracking/TrackingPageClient.tsx
  - src/components/tracking/DeliveryMap.tsx
  - src/components/tracking/PushToast.tsx
  - src/components/ui/Carousel.tsx
  - src/components/ui/TabSwitcher.tsx
  - src/components/ui/overlay-base.tsx
  - src/components/ui/Modal.tsx
  - src/components/ui-v8/scroll/ParallaxLayer.tsx
autonomous: true

must_haves:
  truths:
    - "No hardcoded z-10, z-20 Tailwind classes remain in tracking components"
    - "PushToast.tsx uses zIndex.max token for toast stacking"
    - "UI components use semantic z-dropdown token"
    - "Legacy Modal.tsx uses zIndex tokens for stacking calculation"
  artifacts:
    - path: "src/components/tracking/PushToast.tsx"
      provides: "Toast with zIndex.max - index pattern"
      contains: "zIndex.max"
    - path: "src/components/ui/Modal.tsx"
      provides: "Modal with token-based stacking"
      contains: "zIndex.modal"
    - path: "src/components/ui/TabSwitcher.tsx"
      provides: "Tab switcher with z-dropdown tokens"
      contains: "z-dropdown"
  key_links:
    - from: "src/components/tracking/PushToast.tsx"
      to: "src/design-system/tokens/z-index.ts"
      via: "import { zIndex }"
      pattern: "import.*zIndex.*from.*z-index"
    - from: "src/components/ui/Modal.tsx"
      to: "src/design-system/tokens/z-index.ts"
      via: "import { zIndex }"
      pattern: "zIndex\\.modal"
---

<objective>
Migrate tracking and UI component z-index values to design tokens.

Purpose: Replace hardcoded z-index values with semantic tokens. Handle special cases like PushToast (dynamic z-index) and Modal (stacking calculation).
Output: 9 tracking/UI files using consistent z-index patterns.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-token-migration/10-RESEARCH.md
@src/design-system/tokens/z-index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate tracking components to z-index tokens</name>
  <files>
    src/components/tracking/TrackingMap.tsx
    src/components/tracking/TrackingPageClient.tsx
    src/components/tracking/DeliveryMap.tsx
    src/components/tracking/PushToast.tsx
  </files>
  <action>
    **TrackingMap.tsx, DeliveryMap.tsx** (Tailwind classes):
    - Replace all `z-10` with `z-dropdown` (4 locations each)

    **TrackingPageClient.tsx** (Tailwind class):
    - Replace `z-20` with `z-sticky`

    **PushToast.tsx** (inline style with calculation):
    - Add import: `import { zIndex } from "@/design-system/tokens/z-index";`
    - Replace `zIndex: 100 - index` with `zIndex: zIndex.max - index`
    - This maintains the stacking order (first toast highest) while using token

    Pattern for PushToast.tsx:
    ```tsx
    // Before
    style={{ zIndex: 100 - index }}

    // After
    import { zIndex } from "@/design-system/tokens/z-index";
    // ...
    style={{ zIndex: zIndex.max - index }}
    ```
  </action>
  <verify>
    Run: `grep -En "z-10|z-20" src/components/tracking/{TrackingMap,TrackingPageClient,DeliveryMap}.tsx`
    Expected: No matches

    Run: `grep -n "zIndex.max" src/components/tracking/PushToast.tsx`
    Expected: 1 match showing token usage

    Run: `grep -n "import.*zIndex" src/components/tracking/PushToast.tsx`
    Expected: 1 match showing import from design-system
  </verify>
  <done>
    4 tracking files migrated. Map components use z-dropdown/z-sticky classes. PushToast uses zIndex.max token for dynamic calculation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate UI components to z-index tokens</name>
  <files>
    src/components/ui/Carousel.tsx
    src/components/ui/TabSwitcher.tsx
    src/components/ui/overlay-base.tsx
    src/components/ui/Modal.tsx
    src/components/ui-v8/scroll/ParallaxLayer.tsx
  </files>
  <action>
    **Carousel.tsx, ParallaxLayer.tsx** (Tailwind classes):
    - Replace `z-10` with `z-dropdown`

    **TabSwitcher.tsx** (Tailwind classes):
    - Replace all `z-10` with `z-dropdown` (6 locations)

    **overlay-base.tsx** (mixed):
    - Replace `z-10` class with `z-dropdown`
    - If has zIndex prop passthrough, keep it (allows consumers to override)

    **Modal.tsx** (inline style calculation):
    - Add import: `import { zIndex } from "@/design-system/tokens/z-index";`
    - Replace hardcoded calculation with token-based:
      ```tsx
      // Before (if exists)
      zIndex: 50 + stackLevel * 10

      // After
      zIndex: zIndex.modal + stackLevel * 10
      ```
    - For backdrop: use `zIndex.modalBackdrop`
    - For modal content: use `zIndex.modal`

    Note: V8 Modal already uses tokens correctly - do NOT modify it.
  </action>
  <verify>
    Run: `grep -En "z-10|z-20" src/components/ui/{Carousel,TabSwitcher,overlay-base}.tsx src/components/ui-v8/scroll/ParallaxLayer.tsx`
    Expected: No matches

    Run: `grep -n "zIndex.modal" src/components/ui/Modal.tsx`
    Expected: Matches showing token usage

    Run: `grep -n "z-dropdown" src/components/ui/TabSwitcher.tsx`
    Expected: 6 matches
  </verify>
  <done>
    5 UI files migrated. Carousel, TabSwitcher, overlay-base, ParallaxLayer use z-dropdown class. Modal.tsx uses zIndex.modal and zIndex.modalBackdrop tokens.
  </done>
</task>

</tasks>

<verification>
Run ESLint on tracking and UI files:
```bash
npx eslint --no-warn-ignored src/components/tracking/*.tsx src/components/ui/Carousel.tsx src/components/ui/TabSwitcher.tsx src/components/ui/overlay-base.tsx src/components/ui/Modal.tsx 2>&1 | grep -c "z-index"
```
Expected: 0 z-index warnings

Verify token imports:
```bash
grep -l "import.*zIndex.*from.*z-index" src/components/tracking/PushToast.tsx src/components/ui/Modal.tsx
```
Expected: 2 files listed
</verification>

<success_criteria>
- 4 tracking files migrated (maps use z-dropdown/z-sticky, PushToast uses zIndex.max)
- 5 UI files migrated (Carousel, TabSwitcher, overlay-base use z-dropdown; Modal uses zIndex tokens)
- ESLint z-index rule produces 0 warnings for these files
- Tracking page and modals render with correct z-index layering
</success_criteria>

<output>
After completion, create `.planning/phases/10-token-migration/10-03-SUMMARY.md`
</output>
