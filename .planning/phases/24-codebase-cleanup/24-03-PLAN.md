---
phase: 24-codebase-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["24-01", "24-02"]
files_modified:
  - src/lib/animations.ts
  - src/lib/animations/variants.ts
  - src/lib/animations/cart.ts
  - src/lib/motion.ts
  - src/lib/motion-tokens.ts
  - src/components/ui-v8/cart/ClearCartConfirmation.tsx
  - src/components/ui-v8/cart/CartButtonV8.tsx
  - src/components/ui-v8/cart/CartBarV8.tsx
  - src/components/ui-v8/cart/AddToCartButton.tsx
  - src/components/layouts/CheckoutLayout.tsx
  - src/components/layouts/DriverLayout.tsx
  - src/components/layouts/AdminLayout.tsx
  - src/components/admin/ExpandableTableRow.tsx
  - src/components/admin/analytics/MetricCard.tsx
  - src/components/tracking/ETADisplay.tsx
  - src/components/menu/QuantitySelector.tsx
  - src/components/menu/category-tabs.tsx
  - src/components/menu/MenuEmptyState.tsx
autonomous: true

must_haves:
  truths:
    - "Single animation token source exists"
    - "All imports use @/lib/motion-tokens"
    - "No duplicate animation definitions"
    - "Build passes with zero TypeScript errors"
    - "Bundle size documented"
  artifacts:
    - path: "src/lib/motion-tokens.ts"
      provides: "Single source of truth for all animation tokens"
    - path: ".planning/phases/24-codebase-cleanup/BUNDLE-REPORT.md"
      provides: "Bundle size comparison before/after cleanup"
  key_links:
    - from: "All animation consumers"
      to: "@/lib/motion-tokens"
      via: "Standardized imports"
      pattern: "from ['\"]@/lib/motion-tokens"
---

<objective>
Consolidate animation tokens to single source and verify cleanup results.

Purpose: Eliminate scattered animation definitions across multiple files. Single source of truth simplifies maintenance and ensures consistency.

Output: Consolidated motion-tokens.ts, verified build, documented bundle size reduction.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-codebase-cleanup/24-CONTEXT.md
@.planning/phases/24-codebase-cleanup/24-RESEARCH.md
@.planning/phases/24-codebase-cleanup/24-01-SUMMARY.md
@.planning/phases/24-codebase-cleanup/24-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate animation imports</name>
  <files>
    src/lib/animations.ts
    src/lib/animations/variants.ts
    src/lib/animations/cart.ts
    src/lib/motion.ts
    src/lib/motion-tokens.ts
    (7 files importing from @/lib/animations)
    (7 files importing from @/lib/motion)
  </files>
  <action>
Consolidate scattered animation definitions into motion-tokens.ts:

1. Audit what's actually used from each file:
   - `src/lib/animations.ts` - V3 foundation (7 importers)
   - `src/lib/animations/variants.ts` - Additional variants
   - `src/lib/animations/cart.ts` - Cart-specific animations
   - `src/lib/motion.ts` - V6 presets (7 importers)

2. For each importer of `@/lib/animations`:
   - Check what tokens are actually used
   - Update import to use `@/lib/motion-tokens`
   - If token doesn't exist in motion-tokens, add it there first

3. For each importer of `@/lib/motion`:
   - Check what tokens are actually used
   - Map to equivalent in motion-tokens (v6Spring -> spring.default, etc.)
   - Update import

4. After all imports updated, delete legacy files:
   - `src/lib/animations.ts`
   - `src/lib/animations/variants.ts`
   - `src/lib/animations/cart.ts`
   - `src/lib/motion.ts`
   - Delete `src/lib/animations/` directory

5. Run `pnpm typecheck` after each batch of changes

Files to update (from @/lib/animations):
- src/components/ui-v8/cart/ClearCartConfirmation.tsx
- src/components/ui-v8/cart/CartButtonV8.tsx
- src/components/ui-v8/cart/CartBarV8.tsx
- src/components/ui-v8/cart/AddToCartButton.tsx
- src/components/layouts/CheckoutLayout.tsx
- src/components/layouts/DriverLayout.tsx
- src/components/layouts/AdminLayout.tsx

Files to update (from @/lib/motion):
- src/components/admin/ExpandableTableRow.tsx
- src/components/admin/analytics/MetricCard.tsx
- src/components/tracking/ETADisplay.tsx
- src/components/menu/QuantitySelector.tsx
- src/components/menu/category-tabs.tsx
- src/components/menu/MenuEmptyState.tsx
  </action>
  <verify>
    - `grep -r "from.*@/lib/animations" src/` returns no results
    - `grep -r "from.*@/lib/motion\"" src/` returns no results (note: motion-tokens still valid)
    - `ls src/lib/animations.ts` returns "No such file"
    - `ls src/lib/motion.ts` returns "No such file"
    - `pnpm typecheck` passes
  </verify>
  <done>All animation imports consolidated to motion-tokens.ts, legacy files deleted</done>
</task>

<task type="auto">
  <name>Task 2: Final verification and bundle report</name>
  <files>
    .planning/phases/24-codebase-cleanup/BUNDLE-REPORT.md
  </files>
  <action>
Run full verification suite and document results:

1. Run all verification commands:
   ```bash
   pnpm typecheck
   pnpm lint
   pnpm test
   pnpm build
   ```

2. Run knip to verify cleanup effectiveness:
   ```bash
   pnpm knip 2>&1 | head -50
   ```
   Document remaining unused files/exports (some are expected - admin components, etc.)

3. Measure bundle size:
   ```bash
   ANALYZE=true pnpm build
   ```
   Or check `.next/` build output sizes

4. Create BUNDLE-REPORT.md documenting:
   - Files removed count
   - Packages uninstalled
   - Bundle size before (estimate from research: ~650KB+ from three.js)
   - Bundle size after
   - Remaining knip findings (explain which are acceptable)

5. Visual verification:
   - Homepage loads, hero shows 2D version
   - Menu page loads, cards work
   - Cart functions
   - Checkout flow works
  </action>
  <verify>
    - `pnpm typecheck` passes
    - `pnpm lint` passes (or known acceptable warnings)
    - `pnpm test` passes
    - `pnpm build` passes
    - BUNDLE-REPORT.md exists
  </verify>
  <done>All verification passes, bundle size reduction documented</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - Zero TypeScript errors
2. `pnpm lint` - Passes (acceptable warnings only)
3. `pnpm test` - All tests pass
4. `pnpm build` - Build succeeds
5. `pnpm knip` - Reduced unused file count
6. Bundle size documented in BUNDLE-REPORT.md
7. Visual: Homepage, menu, cart, checkout all functional
</verification>

<success_criteria>
- Animation tokens consolidated to single file
- 4 legacy animation files deleted
- All 14 files updated to use motion-tokens
- Full test suite passes
- Build succeeds
- Bundle size reduction documented (~650KB+ expected)
- BUNDLE-REPORT.md created
</success_criteria>

<output>
After completion, create `.planning/phases/24-codebase-cleanup/24-03-SUMMARY.md`
</output>
