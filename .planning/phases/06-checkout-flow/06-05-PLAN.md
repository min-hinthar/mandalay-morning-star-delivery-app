---
phase: 06-checkout-flow
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/orders/OrderConfirmationV8.tsx
  - src/app/(customer)/orders/[id]/confirmation/page.tsx
autonomous: true

must_haves:
  truths:
    - "Confetti burst triggers when order confirmation page loads"
    - "Large animated checkmark appears with spring bounce"
    - "Order details cards animate in with staggered delay"
    - "Action buttons fade in after content"
  artifacts:
    - path: "src/components/orders/OrderConfirmationV8.tsx"
      provides: "Celebration-enhanced order confirmation"
      exports: ["OrderConfirmationV8"]
      contains: "useConfetti"
    - path: "src/app/(customer)/orders/[id]/confirmation/page.tsx"
      provides: "Confirmation page using V8 component"
      contains: "OrderConfirmationV8"
  key_links:
    - from: "src/components/orders/OrderConfirmationV8.tsx"
      to: "Confetti"
      via: "import and trigger"
      pattern: "useConfetti"
---

# Plan 06-05: Order Confirmation Celebration

## Objective

Create an enhanced order confirmation page with confetti burst, animated checkmark, and staggered content reveal for a delightful success celebration.

## Requirements Addressed

- CHKT-04: Order confirmation page
- CHKT-08: Success celebration animation on order completion

## Context

@.planning/phases/06-checkout-flow/06-RESEARCH.md
@src/components/orders/OrderConfirmation.tsx
@src/components/ui/Confetti.tsx
@src/components/ui/success-checkmark.tsx
@src/lib/motion-tokens.ts

## Tasks

<task id="1" type="auto">
  <name>Create OrderConfirmationV8 with celebration animations</name>
  <files>src/components/orders/OrderConfirmationV8.tsx</files>
  <action>
Create OrderConfirmationV8 based on existing OrderConfirmation with these enhancements:

1. Import celebration components:
```typescript
import { useConfetti } from "@/components/ui/Confetti";
import { SuccessCheckmark } from "@/components/ui/success-checkmark";
import { motion, AnimatePresence } from "framer-motion";
import { spring, staggerContainer, staggerItem, celebration } from "@/lib/motion-tokens";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";
```

2. Trigger confetti on mount:
```typescript
const { trigger, Confetti: ConfettiComponent } = useConfetti();

useEffect(() => {
  trigger();
}, [trigger]);
```

3. Replace CheckCircle icon with SuccessCheckmark:
```tsx
<SuccessCheckmark show={true} size={80} variant="default" />
```

4. Use staggered reveal for content sections:
```tsx
<motion.div
  variants={staggerContainer(0.1, 0.3)}
  initial="hidden"
  animate="visible"
  className="space-y-6"
>
  {/* Each section uses staggerItem variant */}
  <motion.div variants={staggerItem}>
    {/* Order summary card */}
  </motion.div>
  <motion.div variants={staggerItem}>
    {/* Delivery info cards */}
  </motion.div>
  <motion.div variants={staggerItem}>
    {/* Action buttons */}
  </motion.div>
</motion.div>
```

5. Enhance the main success header:
```tsx
<motion.div
  initial={{ scale: 0, opacity: 0 }}
  animate={{ scale: 1, opacity: 1 }}
  transition={getSpring(spring.ultraBouncy)}
  className="flex justify-center mb-6"
>
  <div className="rounded-full bg-green-100 dark:bg-green-900/30 p-6">
    <SuccessCheckmark show={true} size={64} />
  </div>
</motion.div>

<motion.h1
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ delay: 0.3, ...spring.default }}
  className="text-3xl font-display text-center text-text-primary"
>
  Order Confirmed!
</motion.h1>
```

6. Keep same props interface: { order: Order }

7. Render confetti at top level:
```tsx
return (
  <>
    <ConfettiComponent particleCount={30} duration={2.5} />
    <div className="min-h-screen bg-gradient-to-b ...">
      {/* rest of content */}
    </div>
  </>
);
```
  </action>
  <verify>
pnpm typecheck passes.
Component renders with same props as original.
  </verify>
  <done>OrderConfirmationV8 exists with confetti, animated checkmark, and staggered content.</done>
</task>

<task id="2" type="auto">
  <name>Update confirmation page to use V8 component</name>
  <files>src/app/(customer)/orders/[id]/confirmation/page.tsx</files>
  <action>
First, check if the confirmation page exists. If it exists, update it to use OrderConfirmationV8.
If it doesn't exist, create it.

The page should:
1. Be a server component that fetches the order
2. Import and render OrderConfirmationV8
3. Handle the order fetch and pass to component

```typescript
import { OrderConfirmationV8 } from "@/components/orders/OrderConfirmationV8";
// or if barrel exports exist:
// import { OrderConfirmationV8 } from "@/components/orders";

export default async function ConfirmationPage({
  params,
}: {
  params: { id: string };
}) {
  // Fetch order using existing API/query
  const order = await getOrder(params.id);

  if (!order) {
    notFound();
  }

  return <OrderConfirmationV8 order={order} />;
}
```

Note: If page already exists and uses OrderConfirmation, just swap the import to OrderConfirmationV8.
  </action>
  <verify>
pnpm typecheck passes.
Navigate to /orders/[id]/confirmation - page should render with celebrations.
  </verify>
  <done>Confirmation page uses V8 component with celebration animations.</done>
</task>

## Verification

- [ ] `pnpm typecheck` passes
- [ ] Confetti burst triggers on page load (25-30 particles, 2-2.5s duration)
- [ ] Animated checkmark appears with spring bounce
- [ ] Order summary card fades in with slight delay
- [ ] Delivery info cards stagger in after summary
- [ ] Action buttons fade in last
- [ ] Reduced motion: confetti disabled, content appears without animation

## Success Criteria

Order confirmation page displays success celebration with confetti burst and animated checkmark. Content reveals in staggered sequence, creating a delightful "order complete" moment.

## Output

After completion, create `.planning/phases/06-checkout-flow/06-05-SUMMARY.md`
