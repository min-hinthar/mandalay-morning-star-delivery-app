---
phase: 06-checkout-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(customer)/checkout/page.tsx
  - src/components/checkout/CheckoutStepperV8.tsx
  - src/components/checkout/index.ts
autonomous: true

must_haves:
  truths:
    - "Step transitions animate smoothly when navigating forward and backward"
    - "Current step slides out in the opposite direction of navigation"
    - "New step slides in from the navigation direction"
    - "Step progress indicator shows current step and completed steps visually"
  artifacts:
    - path: "src/app/(customer)/checkout/page.tsx"
      provides: "Animated multi-step checkout with AnimatePresence"
      contains: "AnimatePresence mode=\"wait\""
    - path: "src/components/checkout/CheckoutStepperV8.tsx"
      provides: "Enhanced step progress indicator"
      exports: ["CheckoutStepperV8"]
    - path: "src/components/checkout/index.ts"
      provides: "V8 checkout component exports"
      contains: "CheckoutStepperV8"
  key_links:
    - from: "src/app/(customer)/checkout/page.tsx"
      to: "CheckoutStepperV8"
      via: "import from checkout/index.ts"
      pattern: "import.*CheckoutStepperV8"
---

# Plan 06-01: Checkout Page Step Transitions

## Objective

Add animated step transitions to the checkout page with direction-aware sliding animations using AnimatePresence.

## Requirements Addressed

- CHKT-01: Multi-step checkout form
- CHKT-06: Animated step progress indicator

## Context

@.planning/phases/06-checkout-flow/06-RESEARCH.md
@src/app/(customer)/checkout/page.tsx
@src/components/checkout/CheckoutStepper.tsx
@src/lib/motion-tokens.ts

## Tasks

<task id="1" type="auto">
  <name>Create CheckoutStepperV8 with enhanced animations</name>
  <files>src/components/checkout/CheckoutStepperV8.tsx</files>
  <action>
Create CheckoutStepperV8 based on existing CheckoutStepper with these enhancements:
- Add pulsing ring animation on current step using motion.animate with scale keyframes
- Enhance line fill animation to use spring.rubbery for satisfying progress feel
- Add hover scale effect on clickable (completed) steps
- Use useAnimationPreference for reduced motion support
- Keep same props interface as CheckoutStepper for drop-in replacement

Animation tokens to use:
- spring.rubbery for progress line fill
- spring.ultraBouncy for checkmark appearance
- spring.snappy for hover/tap interactions

Export from new file, do not modify original CheckoutStepper.tsx.
  </action>
  <verify>
pnpm typecheck passes with no errors on new file.
Component renders with same props as original.
  </verify>
  <done>CheckoutStepperV8.tsx exists with enhanced spring animations and same interface as original.</done>
</task>

<task id="2" type="auto">
  <name>Add AnimatePresence step transitions to checkout page</name>
  <files>src/app/(customer)/checkout/page.tsx</files>
  <action>
Modify checkout page.tsx to add animated step transitions:

1. Import AnimatePresence from framer-motion
2. Import spring, variants from @/lib/motion-tokens
3. Import useAnimationPreference hook
4. Track step direction with useState (1 for forward, -1 for backward)
5. Update handleStepClick to set direction based on step index comparison
6. Wrap step content in AnimatePresence mode="wait"
7. Each step gets motion.div wrapper with:
   - key={step} for proper AnimatePresence keying
   - custom={direction} for direction-aware animation
   - variants using slideRight/slideLeft based on direction
   - initial="initial", animate="animate", exit="exit"
   - transition using spring.default

Step transition pattern:
```tsx
const stepVariants = {
  initial: (dir: number) => ({ opacity: 0, x: dir > 0 ? 100 : -100 }),
  animate: { opacity: 1, x: 0 },
  exit: (dir: number) => ({ opacity: 0, x: dir > 0 ? -100 : 100 }),
};
```

Replace CheckoutStepper import with CheckoutStepperV8.
  </action>
  <verify>
pnpm typecheck passes.
Navigate checkout steps - steps should animate in/out smoothly.
  </verify>
  <done>Checkout page has animated step transitions with direction-aware sliding.</done>
</task>

<task id="3" type="auto">
  <name>Create V8 checkout barrel exports</name>
  <files>src/components/checkout/index.ts</files>
  <action>
Create or update index.ts barrel file for checkout components:

```typescript
// V8 Components (new animated versions)
export { CheckoutStepperV8 } from "./CheckoutStepperV8";

// Re-export V8 as default names for easy migration
export { CheckoutStepperV8 as CheckoutStepper } from "./CheckoutStepperV8";

// Legacy exports (keep for compatibility)
export { AddressStep } from "./AddressStep";
export { TimeStep } from "./TimeStep";
export { PaymentStep } from "./PaymentStep";
export { CheckoutSummary } from "./CheckoutSummary";
export { AddressForm } from "./AddressForm";
export { AddressCard } from "./AddressCard";
```

This allows gradual migration - importing CheckoutStepper from index.ts gets V8 version.
  </action>
  <verify>
pnpm typecheck passes.
Imports resolve correctly from @/components/checkout.
  </verify>
  <done>Barrel exports created with V8 components as default exports.</done>
</task>

## Verification

- [ ] `pnpm typecheck` passes
- [ ] Checkout page renders with step transitions
- [ ] Forward navigation: current step slides left, new step slides in from right
- [ ] Backward navigation: current step slides right, new step slides in from left
- [ ] Step indicator shows progress with smooth animations
- [ ] Reduced motion: animations disabled when prefers-reduced-motion is set

## Success Criteria

Checkout displays multi-step progress indicator with animated step transitions. Users see smooth sliding animations when navigating between address, time, and payment steps.

## Output

After completion, create `.planning/phases/06-checkout-flow/06-01-SUMMARY.md`
