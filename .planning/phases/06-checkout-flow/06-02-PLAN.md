---
phase: 06-checkout-flow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/checkout/AddressFormV8.tsx
  - src/components/checkout/AnimatedFormField.tsx
  - src/components/checkout/index.ts
autonomous: true

must_haves:
  truths:
    - "Form fields have subtle scale animation on focus"
    - "Invalid fields shake and show animated error messages"
    - "Valid fields show animated checkmark icon"
    - "Error messages slide in/out with animation"
  artifacts:
    - path: "src/components/checkout/AnimatedFormField.tsx"
      provides: "Focus scale wrapper for form inputs"
      exports: ["AnimatedFormField"]
    - path: "src/components/checkout/AddressFormV8.tsx"
      provides: "Address form with micro-interactions"
      exports: ["AddressFormV8"]
  key_links:
    - from: "src/components/checkout/AddressFormV8.tsx"
      to: "AnimatedFormField"
      via: "import and wrap inputs"
      pattern: "AnimatedFormField"
---

# Plan 06-02: Form Field Micro-interactions

## Objective

Create animated form field components with focus scale, shake on error, and animated validation feedback for the checkout address form.

## Requirements Addressed

- CHKT-07: Form field micro-interactions (focus, validation, error)

## Context

@.planning/phases/06-checkout-flow/06-RESEARCH.md
@src/components/checkout/AddressForm.tsx
@src/components/ui/FormValidation.tsx
@src/lib/motion-tokens.ts

## Tasks

<task id="1" type="auto">
  <name>Create AnimatedFormField wrapper component</name>
  <files>src/components/checkout/AnimatedFormField.tsx</files>
  <action>
Create AnimatedFormField component that wraps any form input with focus animations:

```typescript
"use client";

import { useState, type ReactNode } from "react";
import { motion } from "framer-motion";
import { spring } from "@/lib/motion-tokens";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";
import { cn } from "@/lib/utils/cn";

interface AnimatedFormFieldProps {
  children: ReactNode;
  className?: string;
  /** Scale amount on focus (default 1.02) */
  focusScale?: number;
}

export function AnimatedFormField({
  children,
  className,
  focusScale = 1.02,
}: AnimatedFormFieldProps) {
  const [isFocused, setIsFocused] = useState(false);
  const { shouldAnimate, getSpring } = useAnimationPreference();

  return (
    <motion.div
      className={cn("relative", className)}
      animate={shouldAnimate && isFocused ? { scale: focusScale } : { scale: 1 }}
      transition={getSpring(spring.snappy)}
      onFocusCapture={() => setIsFocused(true)}
      onBlurCapture={() => setIsFocused(false)}
    >
      {children}
    </motion.div>
  );
}
```

Features:
- Captures focus/blur on any child input via onFocusCapture/onBlurCapture
- Subtle scale animation (1.02) on focus using spring.snappy
- Respects useAnimationPreference for reduced motion
- Accepts className for styling customization
  </action>
  <verify>
pnpm typecheck passes.
Component compiles without errors.
  </verify>
  <done>AnimatedFormField wrapper exists with focus scale animation.</done>
</task>

<task id="2" type="auto">
  <name>Create AddressFormV8 with micro-interactions</name>
  <files>src/components/checkout/AddressFormV8.tsx</files>
  <action>
Create AddressFormV8 based on existing AddressForm with these enhancements:

1. Import AnimatedFormField, ValidatedInput from appropriate locations
2. Replace standard Input with ValidatedInput for animated validation:
   - shakeOnError={true} for shake animation on invalid
   - showSuccess={true} for checkmark on valid
   - Use validationRules from FormValidation.tsx

3. Wrap each form field group with AnimatedFormField for focus scale

4. Add animated error message container for form-level errors:
```tsx
<AnimatePresence>
  {error && (
    <motion.div
      initial={{ opacity: 0, y: -10, height: 0 }}
      animate={{ opacity: 1, y: 0, height: "auto" }}
      exit={{ opacity: 0, y: -10, height: 0 }}
      transition={getSpring(spring.default)}
      className="rounded-md bg-destructive/10 p-3 text-sm text-destructive"
    >
      {error}
    </motion.div>
  )}
</AnimatePresence>
```

5. Keep same props interface as AddressForm for compatibility:
   - defaultValues, onSubmit, onCancel, isLoading, error

6. Use React Hook Form + Zod validation (same as original)

Validation rules for fields:
- label: required
- line1: required, minLength(5)
- line2: optional
- city: required, minLength(2)
- state: required, pattern(/^[A-Z]{2}$/, "Use 2-letter state code")
- postalCode: required, pattern(/^\d{5}(-\d{4})?$/, "Invalid ZIP code")
  </action>
  <verify>
pnpm typecheck passes.
Form fields have focus scale animation.
Invalid fields shake when validation fails.
Error messages animate in/out.
  </verify>
  <done>AddressFormV8 exists with animated validation and focus micro-interactions.</done>
</task>

<task id="3" type="auto">
  <name>Update checkout barrel exports with AddressFormV8</name>
  <files>src/components/checkout/index.ts</files>
  <action>
Update index.ts to include new form components:

```typescript
// V8 Components
export { CheckoutStepperV8 } from "./CheckoutStepperV8";
export { AnimatedFormField } from "./AnimatedFormField";
export { AddressFormV8 } from "./AddressFormV8";

// Re-export V8 as default names
export { CheckoutStepperV8 as CheckoutStepper } from "./CheckoutStepperV8";
export { AddressFormV8 as AddressForm } from "./AddressFormV8";

// Legacy exports
export { AddressStep } from "./AddressStep";
export { TimeStep } from "./TimeStep";
export { PaymentStep } from "./PaymentStep";
export { CheckoutSummary } from "./CheckoutSummary";
export { AddressCard } from "./AddressCard";
```

Note: If 06-01 hasn't run yet, just include the AddressFormV8 and AnimatedFormField exports.
The file may need to be created or updated depending on execution order.
  </action>
  <verify>
pnpm typecheck passes.
Imports resolve correctly.
  </verify>
  <done>Barrel exports updated with form micro-interaction components.</done>
</task>

## Verification

- [ ] `pnpm typecheck` passes
- [ ] Form fields scale up subtly (1.02x) when focused
- [ ] Invalid fields shake on blur with validation error
- [ ] Error messages animate slide-down on appear, slide-up on dismiss
- [ ] Valid fields show animated green checkmark icon
- [ ] Form-level error banner animates in/out
- [ ] Reduced motion: shake disabled, fade only for messages

## Success Criteria

Form fields show micro-interactions on focus (subtle scale), validation feedback (shake + animated error messages), and success states (animated checkmark).

## Output

After completion, create `.planning/phases/06-checkout-flow/06-02-SUMMARY.md`
