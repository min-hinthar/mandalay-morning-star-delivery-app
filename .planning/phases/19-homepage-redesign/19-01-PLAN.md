---
phase: 19-homepage-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/homepage/HeroVideo.tsx
  - src/components/scroll/AnimatedSection.tsx
  - src/components/scroll/SectionNavDots.tsx
  - src/lib/hooks/useScrollSpy.ts
autonomous: true

must_haves:
  truths:
    - "Video hero plays muted autoplay on load"
    - "Video pauses when scrolled out of view"
    - "AnimatedSection wrapper replays on every scroll into view"
    - "Section nav dots show on desktop right side"
    - "Clicking nav dot scrolls to section"
  artifacts:
    - path: "src/components/homepage/HeroVideo.tsx"
      provides: "Video player with IntersectionObserver pause"
      min_lines: 50
    - path: "src/components/scroll/AnimatedSection.tsx"
      provides: "Reusable scroll-triggered wrapper with always-replay"
      exports: ["AnimatedSection", "itemVariants"]
    - path: "src/components/scroll/SectionNavDots.tsx"
      provides: "Side navigation dots component"
      exports: ["SectionNavDots"]
    - path: "src/lib/hooks/useScrollSpy.ts"
      provides: "Enhanced scroll spy with IntersectionObserver"
      contains: "IntersectionObserver"
  key_links:
    - from: "src/components/homepage/HeroVideo.tsx"
      to: "useInView"
      via: "framer-motion hook"
      pattern: "useInView"
    - from: "src/components/scroll/SectionNavDots.tsx"
      to: "useScrollSpy"
      via: "hook import"
      pattern: "useScrollSpy"
---

<objective>
Create video hero component and scroll choreography infrastructure for homepage redesign.

Purpose: Establish foundation for enhanced homepage with video hero that pauses out-of-view and reusable scroll animation components.
Output: HeroVideo.tsx, AnimatedSection.tsx, SectionNavDots.tsx, enhanced useScrollSpy hook
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-homepage-redesign/19-CONTEXT.md
@.planning/phases/19-homepage-redesign/19-RESEARCH.md
@src/lib/motion-tokens.ts
@src/lib/hooks/useScrollSpy.ts
@src/lib/hooks/useAnimationPreference.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HeroVideo Component</name>
  <files>src/components/homepage/HeroVideo.tsx</files>
  <action>
Create video hero player component with:
- Props: desktopSrc, mobileSrc, poster (optional), children (for overlay content)
- Responsive video source switching (window.innerWidth < 768 = mobile)
- Video attributes: muted autoPlay loop playsInline (required for mobile autoplay)
- IntersectionObserver (via framer-motion useInView) to pause when <30% visible
- Full viewport height (100svh) with object-cover
- Gradient overlay from bottom for text readability: from-black/60 via-transparent to-transparent
- Support for children prop to render headline/CTA overlays

Use pattern from RESEARCH.md:
```typescript
const isInView = useInView(containerRef, { amount: 0.3 });
useEffect(() => {
  if (!video) return;
  isInView ? video.play().catch(() => {}) : video.pause();
}, [isInView]);
```

Use useAnimationPreference to respect reduced motion preferences.
For reduced motion: show poster image instead of video, skip play/pause logic.
  </action>
  <verify>
Create test file with placeholder videos (use existing hero images as poster).
Component renders without errors, video plays on load, pauses when scrolled away.
  </verify>
  <done>
HeroVideo component exists with responsive sources, autoplay, and pause-on-exit behavior.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AnimatedSection Wrapper</name>
  <files>src/components/scroll/AnimatedSection.tsx</files>
  <action>
Create reusable scroll-triggered animation wrapper per CONTEXT decisions:
- Trigger at 50% visible (viewport.amount: 0.5)
- Animation speed: 200-300ms (use duration: 0.25)
- Stagger delay: 50ms between children (staggerChildren: 0.05)
- Always replay: viewport.once: false

Props:
- children: ReactNode
- className?: string
- id?: string (for scroll spy)
- as?: keyof JSX.IntrinsicElements (default 'section')

Export itemVariants for child elements to use:
```typescript
export const itemVariants: Variants = {
  hidden: { opacity: 0, y: 24 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.25, ease: [0.2, 0.9, 0.3, 1] },
  },
};
```

Integrate useAnimationPreference - if !shouldAnimate, render plain element without motion.

Create scroll/ directory if it doesn't exist.
  </action>
  <verify>
Component wraps children and animates them on scroll into view.
Animation replays when scrolling back up and down.
  </verify>
  <done>
AnimatedSection wrapper exists with always-replay behavior and exported itemVariants.
  </done>
</task>

<task type="auto">
  <name>Task 3: Enhance useScrollSpy and Create SectionNavDots</name>
  <files>src/lib/hooks/useScrollSpy.ts, src/components/scroll/SectionNavDots.tsx</files>
  <action>
**useScrollSpy Enhancement:**
Update existing hook to use IntersectionObserver instead of scroll listener:
- rootMargin: "-50% 0px -50% 0px" (triggers at viewport middle per CONTEXT)
- threshold: 0
- Return activeIndex (number) instead of activeId
- Properly disconnect observer in cleanup

```typescript
useEffect(() => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const index = sectionIds.indexOf(entry.target.id);
          if (index !== -1) setActiveIndex(index);
        }
      });
    },
    { rootMargin: "-50% 0px -50% 0px", threshold: 0 }
  );
  // observe, cleanup...
}, [sectionIds]);
```

**SectionNavDots Component:**
Create per RESEARCH pattern:
- Props: sections (array of {id, label}), className?
- Fixed position right-4 md:right-8, vertically centered
- Hidden on mobile (hidden md:flex)
- Each dot: w-3 h-3 rounded-full, active = bg-primary, inactive = bg-text-muted/30
- Hover shows label tooltip (opacity transition)
- Click scrolls to section (smooth scroll if shouldAnimate, auto if not)
- Use useScrollSpy to track activeIndex
- Use motion.button with whileHover/whileTap for interaction feedback

Use zClass.overlay or appropriate z-index token for fixed positioning.
  </action>
  <verify>
useScrollSpy tracks active section based on viewport center.
SectionNavDots displays on desktop, highlights active section, click jumps to section.
  </verify>
  <done>
Enhanced useScrollSpy with IntersectionObserver and SectionNavDots component with click-to-jump and hover labels.
  </done>
</task>

</tasks>

<verification>
- [ ] HeroVideo renders and autoplays muted video
- [ ] HeroVideo pauses when scrolled out of view (>70% hidden)
- [ ] AnimatedSection children animate on scroll into view
- [ ] AnimatedSection replays animation when re-entering viewport
- [ ] useScrollSpy uses IntersectionObserver (not scroll listener)
- [ ] SectionNavDots shows on desktop right side
- [ ] Clicking SectionNavDots dot scrolls to correct section
- [ ] Hover on dot shows section label
- [ ] All components respect useAnimationPreference
- [ ] `pnpm typecheck` passes
- [ ] `pnpm lint` passes
</verification>

<success_criteria>
Video hero and scroll choreography infrastructure ready for homepage integration.
All three components (HeroVideo, AnimatedSection, SectionNavDots) work independently and can be composed in Plan 05.
</success_criteria>

<output>
After completion, create `.planning/phases/19-homepage-redesign/19-01-SUMMARY.md`
</output>
