---
phase: 23-header-nav-rebuild
plan: 04
type: execute
wave: 2
depends_on: [23-01]
files_modified:
  - src/components/layout/CommandPalette/CommandPalette.tsx
  - src/components/layout/CommandPalette/SearchInput.tsx
  - src/components/layout/CommandPalette/SearchResults.tsx
  - src/components/layout/CommandPalette/SearchEmptyState.tsx
  - src/components/layout/CommandPalette/index.ts
  - src/lib/hooks/useRecentSearches.ts
autonomous: true

must_haves:
  truths:
    - "Command palette opens with Cmd/Ctrl+K"
    - "Search filters menu items by name"
    - "Arrow keys navigate results, Enter selects"
    - "Empty state shows popular suggestions"
    - "Recent searches shown when palette opens"
  artifacts:
    - path: "src/components/layout/CommandPalette/CommandPalette.tsx"
      provides: "Main cmdk dialog wrapper"
      exports: ["CommandPalette"]
    - path: "src/components/layout/CommandPalette/SearchResults.tsx"
      provides: "Results list with thumbnails"
      exports: ["SearchResults"]
    - path: "src/components/layout/CommandPalette/SearchEmptyState.tsx"
      provides: "Empty/popular suggestions"
      exports: ["SearchEmptyState"]
    - path: "src/lib/hooks/useRecentSearches.ts"
      provides: "Recent search persistence"
      exports: ["useRecentSearches"]
  key_links:
    - from: "CommandPalette.tsx"
      to: "cmdk"
      via: "Command.Dialog wrapper"
      pattern: "Command\\.Dialog"
    - from: "SearchResults.tsx"
      to: "MenuItem type"
      via: "menu item rendering"
      pattern: "MenuItem\\[\\]"
---

<objective>
Build Linear-style command palette for menu item search using cmdk library.

Purpose: Provide fast, keyboard-friendly search for menu items matching the playful UI aesthetic.
Output: CommandPalette component with search, results, empty state, and recent searches.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/23-header-nav-rebuild/23-CONTEXT.md
@.planning/phases/23-header-nav-rebuild/23-RESEARCH.md

@src/lib/hooks/useCommandPalette.ts (after Plan 01)
@src/lib/motion-tokens.ts
@src/types/menu.ts
@src/lib/utils/price.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useRecentSearches hook and SearchEmptyState component</name>
  <files>
    - src/lib/hooks/useRecentSearches.ts
    - src/lib/hooks/index.ts
    - src/components/layout/CommandPalette/SearchEmptyState.tsx
  </files>
  <action>
1. Create `src/lib/hooks/useRecentSearches.ts`:
   - Store recent searches in localStorage under key "mms-recent-searches"
   - Max 5 recent searches
   - Functions: addSearch(term), clearSearches(), getSearches()
   - Return: { recentSearches, addSearch, clearSearches }
   - Use useState + useEffect for hydration safety

2. Update `src/lib/hooks/index.ts`:
   - Export useRecentSearches

3. Create `src/components/layout/CommandPalette/SearchEmptyState.tsx`:
   ```tsx
   interface SearchEmptyStateProps {
     recentSearches: string[];
     onSelectRecent: (term: string) => void;
     onClearRecent: () => void;
     popularItems?: MenuItem[];
     onSelectItem: (item: MenuItem) => void;
   }
   ```
   - Show "Recent Searches" section if recentSearches.length > 0
   - Each recent search is clickable Command.Item
   - "Clear recent" button at end
   - Show "Popular Items" section with 3-4 hardcoded popular item suggestions
   - Friendly empty state message: "Search for your favorite dishes..."
   - Use motion for subtle entrance animation
  </action>
  <verify>
    - `pnpm typecheck` passes
    - localStorage key used correctly
    - Component renders recent searches
  </verify>
  <done>useRecentSearches persists searches to localStorage, SearchEmptyState shows recents and popular items</done>
</task>

<task type="auto">
  <name>Task 2: Create CommandPalette with cmdk integration</name>
  <files>
    - src/components/layout/CommandPalette/SearchInput.tsx
    - src/components/layout/CommandPalette/SearchResults.tsx
    - src/components/layout/CommandPalette/CommandPalette.tsx
    - src/components/layout/CommandPalette/index.ts
  </files>
  <action>
1. Create `src/components/layout/CommandPalette/SearchInput.tsx`:
   - Styled wrapper around Command.Input
   - Search icon (lucide Search) on left
   - Keyboard hint "ESC" on right (subtle text)
   - Placeholder: "Search menu items..."
   - Focus ring with primary color

2. Create `src/components/layout/CommandPalette/SearchResults.tsx`:
   ```tsx
   interface SearchResultsProps {
     items: MenuItem[];
     onSelect: (item: MenuItem) => void;
   }
   ```
   - Map items to Command.Item components
   - Each item shows: thumbnail image (w-10 h-10 rounded-lg), name, price (formatPrice from @/lib/utils/price)
   - Use next/image for thumbnails with placeholder blur
   - Highlight matching text (cmdk handles filtering, just style selected state)
   - Selected state: bg-primary/10, subtle scale
   - Max height with overflow-y-auto

3. Create `src/components/layout/CommandPalette/CommandPalette.tsx`:
   ```tsx
   interface CommandPaletteProps {
     open: boolean;
     onOpenChange: (open: boolean) => void;
     menuItems: MenuItem[];
   }
   ```
   - Use Command.Dialog from cmdk
   - Wrap in AnimatePresence for entrance/exit
   - Animation per CONTEXT.md: scale up + fade + slide down (Linear-like)
     - initial: opacity: 0, scale: 0.96, y: -10
     - animate: opacity: 1, scale: 1, y: 0
     - transition: spring with stiffness 500, damping 30
   - Backdrop: fixed inset-0 bg-black/50 with blur
   - Dialog position: fixed top-[20%] left-1/2 -translate-x-1/2, max-w-lg w-full
   - Structure:
     - SearchInput at top
     - Command.List containing:
       - SearchEmptyState when no query
       - SearchResults when query has results
       - Command.Empty when query has no matches ("No items found")
   - onSelect: navigate to /menu/{item.slug}, close palette, add to recent searches
   - Mobile: same design, slightly smaller (max-w-sm), padding adjusted
   - Use zClass.modal for dialog, zClass.modalBackdrop for backdrop

4. Create `src/components/layout/CommandPalette/index.ts`:
   - Export CommandPalette as default and named
  </action>
  <verify>
    - `pnpm typecheck` passes
    - `pnpm lint` passes
    - cmdk Command components imported correctly
    - Animation matches Linear-like feel
  </verify>
  <done>CommandPalette with cmdk filtering, keyboard nav, results with thumbnails, and recent searches</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- `pnpm lint` passes
- CommandPalette directory structure complete
- cmdk Command.Dialog, Command.Input, Command.List, Command.Item used
- Recent searches persist across sessions
- Animation uses scale + fade + slide
</verification>

<success_criteria>
- Cmd/Ctrl+K opens palette (integration with useCommandPalette in Plan 01)
- Typing filters menu items via cmdk built-in filtering
- Arrow keys navigate, Enter selects item
- Selecting item navigates to /menu/{slug}
- Recent searches shown when palette opens with no query
- Popular suggestions shown in empty state
- Mobile version works with same centered design
</success_criteria>

<output>
After completion, create `.planning/phases/23-header-nav-rebuild/23-04-SUMMARY.md`
</output>
