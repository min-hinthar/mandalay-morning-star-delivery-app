---
phase: 04-cart-experience
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/components/ui-v8/cart/CartDrawerV8.tsx
  - src/components/ui-v8/cart/CartSummary.tsx
  - src/components/ui-v8/cart/CartEmptyState.tsx
  - src/components/ui-v8/cart/index.ts
autonomous: true

must_haves:
  truths:
    - "Cart opens as bottom sheet on mobile (< 640px)"
    - "Cart opens as side drawer on desktop (>= 640px)"
    - "Cart shows item list with CartItemV8 components"
    - "Cart shows subtotal, delivery fee, and estimated total"
    - "Free delivery progress bar animates toward threshold"
    - "Empty cart shows friendly state with browse menu CTA"
    - "Close button and backdrop click close the cart"
  artifacts:
    - path: "src/components/ui-v8/cart/CartDrawerV8.tsx"
      provides: "Responsive cart container composing V8 primitives"
      exports: ["CartDrawerV8"]
    - path: "src/components/ui-v8/cart/CartSummary.tsx"
      provides: "Order summary with animated free delivery indicator"
      exports: ["CartSummary"]
    - path: "src/components/ui-v8/cart/CartEmptyState.tsx"
      provides: "Empty cart state with animation"
      exports: ["CartEmptyState"]
  key_links:
    - from: "src/components/ui-v8/cart/CartDrawerV8.tsx"
      to: "BottomSheet"
      via: "mobile rendering"
      pattern: "BottomSheet.*isOpen"
    - from: "src/components/ui-v8/cart/CartDrawerV8.tsx"
      to: "Drawer"
      via: "desktop rendering"
      pattern: "Drawer.*isOpen.*side.*right"
    - from: "src/components/ui-v8/cart/CartDrawerV8.tsx"
      to: "useCartDrawer"
      via: "isOpen, close state"
      pattern: "useCartDrawer.*(isOpen|close)"
    - from: "src/components/ui-v8/cart/CartSummary.tsx"
      to: "useCart"
      via: "subtotal, delivery, total calculations"
      pattern: "useCart.*(itemsSubtotal|estimatedDeliveryFee|estimatedTotal)"
---

<objective>
Create responsive cart drawer using V8 overlay primitives with animated order summary

Purpose: Deliver the main cart experience that adapts between mobile (bottom sheet) and desktop (side drawer) while providing clear order information with delightful progress animations.

Output:
- CartDrawerV8 composing BottomSheet (mobile) and Drawer (desktop)
- CartSummary with animated free delivery progress
- CartEmptyState for zero-item cart
- Covers requirements: CART-01, CART-03, CART-08
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-cart-experience/04-RESEARCH.md
@.planning/phases/04-cart-experience/04-01-SUMMARY.md
@.planning/phases/04-cart-experience/04-02-SUMMARY.md

@src/components/cart/CartDrawer.tsx (reference existing implementation)
@src/components/ui-v8/Drawer.tsx (V8 primitive)
@src/components/ui-v8/BottomSheet.tsx (V8 primitive)
@src/lib/hooks/useCart.ts
@src/lib/hooks/useCartDrawer.ts
@src/lib/hooks/useMediaQuery.ts
@src/types/cart.ts (FREE_DELIVERY_THRESHOLD_CENTS)
@src/components/ui/PriceTicker.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CartSummary and CartEmptyState</name>
  <files>src/components/ui-v8/cart/CartSummary.tsx, src/components/ui-v8/cart/CartEmptyState.tsx</files>
  <action>
**CartSummary.tsx:**
Extract and enhance from existing CartDrawer.tsx CartSummary:

1. **Free delivery progress indicator:**
   - Calculate progress: (threshold - amountToFreeDelivery) / threshold * 100
   - Animated progress bar using motion.div with width animation
   - Use spring.rubbery for satisfying fill animation
   - Show "$ away from free delivery!" message with Sparkles icon
   - Hide indicator when free delivery achieved

2. **Summary rows:**
   - Subtotal with PriceTicker
   - Delivery Fee: "FREE" (green, animated scale) or PriceTicker
   - Divider line
   - Estimated Total with PriceTicker (larger, primary color)

3. **Animation integration:**
   - Use useAnimationPreference for reduced motion
   - Stagger item variants for row entrance

**CartEmptyState.tsx:**
Extract from existing CartDrawer.tsx:

1. **Animated illustration:**
   - ShoppingBag icon in gradient circle
   - Gentle floating animation (y bounce, subtle rotate)

2. **Copy:**
   - "Your cart is empty" heading
   - "Browse our authentic Burmese dishes..." subtext

3. **CTA:**
   - Button linking to /menu
   - Pass onClose to close drawer after navigation

4. **Entrance animation:**
   - Fade in + slide up with stagger
  </action>
  <verify>`pnpm typecheck` passes</verify>
  <done>CartSummary shows totals with animated free delivery progress; CartEmptyState shows friendly empty state</done>
</task>

<task type="auto">
  <name>Task 2: Create CartDrawerV8 composing V8 primitives</name>
  <files>src/components/ui-v8/cart/CartDrawerV8.tsx</files>
  <action>
Create responsive cart drawer using V8 overlay primitives:

1. **Responsive container pattern:**
   ```typescript
   const isMobile = useMediaQuery("(max-width: 640px)");
   const { isOpen, close } = useCartDrawer();

   // Shared content component
   const content = <CartContent onClose={close} />;

   if (isMobile) {
     return (
       <BottomSheet isOpen={isOpen} onClose={close} height="full">
         {content}
       </BottomSheet>
     );
   }

   return (
     <Drawer isOpen={isOpen} onClose={close} side="right" width="lg">
       {content}
     </Drawer>
   );
   ```

2. **CartContent inner component:**
   - Header: "Your Cart" with item count badge, close button
   - Animated bag icon in header (gentle wiggle)
   - Items list: Map items to CartItemV8 with AnimatePresence
   - Empty state: Render CartEmptyState when isEmpty
   - Footer: CartSummary + action buttons

3. **Action buttons:**
   - "Proceed to Checkout" - primary, navigates to /checkout, closes drawer
   - "Continue Shopping" - outline, just closes drawer

4. **List animations:**
   - Use staggerContainer/staggerItem variants
   - AnimatePresence mode="popLayout" for smooth item removal
   - layout prop on list items for reorder animation

5. **Accessibility:**
   - V8 Drawer/BottomSheet already handle:
     - Focus trap
     - Escape to close
     - Route change close
     - Body scroll lock
   - Ensure proper aria-labelledby on cart title
  </action>
  <verify>`pnpm typecheck && pnpm lint` passes</verify>
  <done>CartDrawerV8 renders as BottomSheet on mobile, Drawer on desktop, with all cart functionality</done>
</task>

<task type="auto">
  <name>Task 3: Update exports and full verification</name>
  <files>src/components/ui-v8/cart/index.ts</files>
  <action>
Update barrel exports:

```typescript
export { CartButtonV8 } from "./CartButtonV8";
export { CartItemV8 } from "./CartItemV8";
export { QuantitySelector } from "./QuantitySelector";
export { CartDrawerV8 } from "./CartDrawerV8";
export { CartSummary } from "./CartSummary";
export { CartEmptyState } from "./CartEmptyState";
```

Run full verification:
```bash
pnpm lint && pnpm typecheck && pnpm build
```
  </action>
  <verify>`pnpm lint && pnpm typecheck && pnpm build` all pass</verify>
  <done>All cart components export correctly, V8 cart system is complete</done>
</task>

</tasks>

<verification>
1. CartDrawerV8 renders as BottomSheet on mobile viewport
2. CartDrawerV8 renders as Drawer on desktop viewport
3. Cart items display using CartItemV8 components
4. CartSummary shows subtotal, delivery fee, total
5. Free delivery progress bar animates
6. Empty state shows when cart is empty
7. Close button, backdrop, escape all close the drawer
8. All lint, typecheck, build pass
</verification>

<success_criteria>
- Responsive behavior works (test by resizing browser)
- BottomSheet has swipe-to-close on mobile
- Drawer slides from right on desktop
- Free delivery progress animates smoothly when adding items
- All V8 overlay features work (focus trap, route close, scroll lock)
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-cart-experience/04-03-SUMMARY.md`
</output>
