---
phase: 04-cart-experience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui-v8/cart/CartItemV8.tsx
  - src/components/ui-v8/cart/QuantitySelector.tsx
  - src/components/ui-v8/cart/index.ts
autonomous: true

must_haves:
  truths:
    - "Cart item displays name, image, modifiers, quantity, and price"
    - "User can increment/decrement quantity with animated number transition"
    - "User can swipe left to reveal delete action on mobile"
    - "Swiping past threshold removes item from cart"
    - "Decrementing to 0 removes item from cart"
  artifacts:
    - path: "src/components/ui-v8/cart/CartItemV8.tsx"
      provides: "V8 cart item with swipe-to-delete"
      exports: ["CartItemV8"]
    - path: "src/components/ui-v8/cart/QuantitySelector.tsx"
      provides: "Animated quantity controls"
      exports: ["QuantitySelector"]
  key_links:
    - from: "src/components/ui-v8/cart/CartItemV8.tsx"
      to: "useCart"
      via: "updateQuantity, removeItem"
      pattern: "useCart.*(updateQuantity|removeItem)"
    - from: "src/components/ui-v8/cart/QuantitySelector.tsx"
      to: "AnimatePresence"
      via: "quantity flip animation"
      pattern: "AnimatePresence.*mode.*popLayout"
    - from: "src/components/ui-v8/cart/CartItemV8.tsx"
      to: "framer-motion drag"
      via: "swipe-to-delete gesture"
      pattern: "drag.*x.*dragConstraints"
---

<objective>
Create V8 cart item component with animated quantity controls and swipe-to-delete gesture

Purpose: Deliver intuitive cart item management with delightful micro-interactions that make adjusting quantities and removing items feel responsive and satisfying.

Output:
- CartItemV8 with swipe-to-delete gesture
- QuantitySelector with animated number transitions
- Covers requirements: CART-02, CART-06, CART-07
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-cart-experience/04-RESEARCH.md

@src/components/cart/CartItem.tsx (reference existing implementation)
@src/lib/hooks/useCart.ts
@src/lib/animations/cart.ts (quantityFlip, cartItem variants)
@src/lib/hooks/useAnimationPreference.ts
@src/components/ui/PriceTicker.tsx (animated price display)
@src/types/cart.ts (CartItem type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QuantitySelector component</name>
  <files>src/components/ui-v8/cart/QuantitySelector.tsx</files>
  <action>
Extract and enhance the quantity selector from existing CartItem.tsx:

1. **Props interface:**
   ```typescript
   interface QuantitySelectorProps {
     quantity: number;
     onIncrement: () => void;
     onDecrement: () => void;
     min?: number; // default 1
     max?: number; // default 99
     size?: "sm" | "md"; // default "md"
   }
   ```

2. **Animated number display:**
   - Track direction state ("up" | "down" | null)
   - Use AnimatePresence mode="popLayout" for smooth transitions
   - Number slides up when incrementing, down when decrementing
   - Use quantityFlip variants from cart.ts OR inline variants matching existing pattern

3. **Button styling:**
   - Circular buttons (w-8 h-8 for md, w-6 h-6 for sm)
   - Minus and Plus icons from lucide-react
   - Disabled state when at min/max
   - Focus visible ring
   - whileHover/whileTap scale animations (respect useAnimationPreference)

4. **Haptic feedback:**
   - Trigger light vibration on increment/decrement if navigator.vibrate available

5. **Accessibility:**
   - aria-label on buttons ("Decrease quantity", "Increase quantity")
   - Disabled buttons when at bounds
  </action>
  <verify>`pnpm typecheck` passes</verify>
  <done>QuantitySelector with animated number transitions and haptic feedback</done>
</task>

<task type="auto">
  <name>Task 2: Create CartItemV8 component</name>
  <files>src/components/ui-v8/cart/CartItemV8.tsx</files>
  <action>
Create CartItemV8 with swipe-to-delete and V8 patterns:

1. **Props interface:**
   ```typescript
   interface CartItemV8Props {
     item: CartItem; // from @/types/cart
     onEdit?: (item: CartItem) => void;
     compact?: boolean;
     className?: string;
   }
   ```

2. **Swipe-to-delete gesture:**
   - Use useMotionValue for dragX
   - useTransform to map dragX to swipeProgress (0-1)
   - dragConstraints={{ left: -150, right: 0 }}
   - dragElastic={{ left: 0.1, right: 0 }}
   - On drag end: if offset.x < -100 OR velocity.x < -500, remove item
   - Haptic feedback on successful swipe
   - touch-pan-y class to allow vertical scrolling

3. **Delete indicator (behind card):**
   - Absolute positioned, right-aligned
   - Red gradient background
   - Trash icon that scales/fades based on swipeProgress
   - Only visible when isDragging

4. **Card content:**
   - Image (80x80, rounded, fallback emoji)
   - Name (truncate), modifiers, notes (if present)
   - QuantitySelector component
   - PriceTicker for item total
   - "each" price when quantity > 1
   - Edit button (if onEdit provided)
   - Remove button (trash icon, always visible as fallback)

5. **Animation preference:**
   - Check shouldAnimate from useAnimationPreference
   - Disable drag when shouldAnimate is false
   - Skip hover/tap animations when reduced motion

6. **Layout animations:**
   - Use layout prop on motion.div for smooth reorder
   - AnimatePresence exit animation (slide left, fade, scale)
  </action>
  <verify>`pnpm typecheck && pnpm lint` passes</verify>
  <done>CartItemV8 with swipe-to-delete, quantity controls, and all visual elements</done>
</task>

<task type="auto">
  <name>Task 3: Update barrel exports and verify</name>
  <files>src/components/ui-v8/cart/index.ts</files>
  <action>
Update barrel exports to include new components:

```typescript
export { CartButtonV8 } from "./CartButtonV8";
export { CartItemV8 } from "./CartItemV8";
export { QuantitySelector } from "./QuantitySelector";
```

Run full verification:
```bash
pnpm lint && pnpm typecheck && pnpm build
```
  </action>
  <verify>`pnpm lint && pnpm typecheck && pnpm build` all pass</verify>
  <done>All V8 cart components export correctly, build passes</done>
</task>

</tasks>

<verification>
1. QuantitySelector animates number up/down on change
2. CartItemV8 renders all item data correctly
3. Swipe gesture reveals delete indicator
4. Swiping past threshold removes item
5. Quantity +/- buttons update cart state
6. Decrement to 0 removes item
7. All lint, typecheck, build pass
</verification>

<success_criteria>
- QuantitySelector shows animated number transitions
- CartItemV8 supports swipe-to-delete on mobile (drag="x")
- Haptic feedback triggers on quantity change and swipe delete
- useAnimationPreference respected (reduced motion users get instant changes)
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-cart-experience/04-02-SUMMARY.md`
</output>
