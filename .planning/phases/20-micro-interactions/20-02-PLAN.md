---
phase: 20-micro-interactions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/branded-spinner.tsx
  - src/components/ui/error-shake.tsx
  - src/components/ui/checkbox.tsx
autonomous: true

must_haves:
  truths:
    - "Loading states show Morning Star branded spinner"
    - "Error states shake horizontally with red pulse"
    - "Checkboxes have animated check mark draw-in"
  artifacts:
    - path: "src/components/ui/branded-spinner.tsx"
      provides: "Morning Star animated spinner"
      contains: "motion|rotate|star"
      min_lines: 50
    - path: "src/components/ui/error-shake.tsx"
      provides: "Shake wrapper for error states"
      contains: "shakeVariants|animate"
      min_lines: 60
    - path: "src/components/ui/checkbox.tsx"
      provides: "Animated checkbox with path draw"
      contains: "motion.path|pathLength"
      min_lines: 80
  key_links:
    - from: "src/components/ui/checkbox.tsx"
      to: "src/lib/motion-tokens.ts"
      via: "imports spring configs"
      pattern: "import.*motion-tokens"
---

<objective>
Create branded spinner, error shake wrapper, and animated checkbox.

Purpose: Loading should be delightful (branded spinner), errors should be clear (shake + pulse), checkboxes should feel satisfying (check draws in).

Output: BrandedSpinner, ErrorShake wrapper, and enhanced Checkbox components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-micro-interactions/20-CONTEXT.md
@.planning/phases/20-micro-interactions/20-RESEARCH.md
@src/lib/motion-tokens.ts
@src/lib/micro-interactions.ts
@src/components/ui/checkbox.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BrandedSpinner component</name>
  <files>src/components/ui/branded-spinner.tsx</files>
  <action>
Create a Morning Star branded loading spinner using SVG animation:

```tsx
"use client";

import { motion } from "framer-motion";
import { cn } from "@/lib/utils/cn";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

interface BrandedSpinnerProps {
  size?: "sm" | "md" | "lg" | "xl";
  className?: string;
  /** Optional label for accessibility */
  label?: string;
}

const sizeConfig = {
  sm: 20,
  md: 32,
  lg: 48,
  xl: 64,
};

export function BrandedSpinner({
  size = "md",
  className,
  label = "Loading",
}: BrandedSpinnerProps) {
  const { shouldAnimate } = useAnimationPreference();
  const pixelSize = sizeConfig[size];

  return (
    <div
      role="status"
      aria-label={label}
      className={cn("inline-flex items-center justify-center", className)}
    >
      <motion.svg
        width={pixelSize}
        height={pixelSize}
        viewBox="0 0 40 40"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        animate={shouldAnimate ? { rotate: 360 } : undefined}
        transition={
          shouldAnimate
            ? {
                duration: 1.5,
                repeat: Infinity,
                ease: "linear",
              }
            : undefined
        }
      >
        {/* Morning Star - 8-pointed star shape */}
        <motion.path
          d="M20 2L23.5 14.5L36 14.5L26 22L29.5 35L20 27L10.5 35L14 22L4 14.5L16.5 14.5L20 2Z"
          fill="currentColor"
          className="text-primary"
          animate={
            shouldAnimate
              ? {
                  opacity: [0.4, 1, 0.4],
                  scale: [0.95, 1, 0.95],
                }
              : undefined
          }
          transition={
            shouldAnimate
              ? {
                  duration: 1.5,
                  repeat: Infinity,
                  ease: "easeInOut",
                }
              : undefined
          }
        />
        {/* Center dot */}
        <circle cx="20" cy="20" r="3" fill="currentColor" className="text-secondary" />
      </motion.svg>
      <span className="sr-only">{label}</span>
    </div>
  );
}

/**
 * Simpler rotating ring spinner as alternative
 */
export function RingSpinner({
  size = "md",
  className,
  label = "Loading",
}: BrandedSpinnerProps) {
  const { shouldAnimate } = useAnimationPreference();
  const pixelSize = sizeConfig[size];

  return (
    <div
      role="status"
      aria-label={label}
      className={cn("inline-flex items-center justify-center", className)}
    >
      <motion.svg
        width={pixelSize}
        height={pixelSize}
        viewBox="0 0 40 40"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        animate={shouldAnimate ? { rotate: 360 } : undefined}
        transition={
          shouldAnimate
            ? {
                duration: 1,
                repeat: Infinity,
                ease: "linear",
              }
            : undefined
        }
      >
        <circle
          cx="20"
          cy="20"
          r="16"
          stroke="currentColor"
          strokeWidth="3"
          strokeLinecap="round"
          strokeDasharray="80"
          strokeDashoffset="60"
          className="text-primary"
        />
      </motion.svg>
      <span className="sr-only">{label}</span>
    </div>
  );
}

export default BrandedSpinner;
```

Key features:
- Morning Star 8-pointed star shape
- Rotating animation + pulsing opacity
- Multiple sizes (sm, md, lg, xl)
- Respects animation preference
- Accessible (role="status", aria-label, sr-only text)
- Alternative RingSpinner for simpler use cases
  </action>
  <verify>`pnpm typecheck` passes. Component exports BrandedSpinner and RingSpinner.</verify>
  <done>BrandedSpinner component exists with rotating star animation and multiple sizes.</done>
</task>

<task type="auto">
  <name>Task 2: Create ErrorShake wrapper component</name>
  <files>src/components/ui/error-shake.tsx</files>
  <action>
Create a wrapper component that applies shake + pulse animation to its children.

Note: This component defines its own errorVariants and pulseVariants locally - it does NOT import from micro-interactions.ts.

```tsx
"use client";

import { useState, useCallback } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils/cn";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

interface ErrorShakeProps {
  /** Whether to trigger the shake animation */
  shake: boolean;
  /** Children to wrap */
  children: React.ReactNode;
  /** Additional class names */
  className?: string;
  /** Callback when shake animation completes */
  onShakeComplete?: () => void;
}

// Combined shake + pulse animation (defined locally)
const errorVariants = {
  idle: {
    x: 0,
    backgroundColor: "transparent",
  },
  shake: {
    x: [-8, 8, -6, 6, -4, 4, 0],
    transition: {
      duration: 0.4,
      ease: "easeOut",
    },
  },
};

const pulseVariants = {
  idle: {
    opacity: 0,
  },
  pulse: {
    opacity: [0, 0.15, 0],
    transition: {
      duration: 0.6,
      ease: "easeOut",
    },
  },
};

export function ErrorShake({
  shake,
  children,
  className,
  onShakeComplete,
}: ErrorShakeProps) {
  const { shouldAnimate } = useAnimationPreference();

  if (!shouldAnimate) {
    return <div className={className}>{children}</div>;
  }

  return (
    <motion.div
      className={cn("relative", className)}
      variants={errorVariants}
      initial="idle"
      animate={shake ? "shake" : "idle"}
      onAnimationComplete={() => {
        if (shake) {
          onShakeComplete?.();
        }
      }}
    >
      {/* Red pulse overlay */}
      <AnimatePresence>
        {shake && (
          <motion.div
            className="absolute inset-0 rounded-inherit bg-status-error pointer-events-none"
            variants={pulseVariants}
            initial="idle"
            animate="pulse"
            exit="idle"
          />
        )}
      </AnimatePresence>
      {children}
    </motion.div>
  );
}

/**
 * Hook to manage shake state - auto-resets after animation
 */
export function useErrorShake() {
  const [shake, setShake] = useState(false);

  const triggerShake = useCallback(() => {
    setShake(true);
    // Auto-reset after animation duration
    setTimeout(() => setShake(false), 500);
  }, []);

  return { shake, triggerShake };
}

export default ErrorShake;
```

Key features:
- Horizontal shake animation (8px amplitude, decreasing)
- Red pulse overlay that fades in and out
- Auto-reset hook for easy usage
- Respects animation preference
- onShakeComplete callback for chaining
  </action>
  <verify>`pnpm typecheck` passes. Component exports ErrorShake and useErrorShake.</verify>
  <done>ErrorShake component exists with horizontal shake + red pulse animation.</done>
</task>

<task type="auto">
  <name>Task 3: Enhance Checkbox with animated check draw</name>
  <files>src/components/ui/checkbox.tsx</files>
  <action>
Upgrade the existing Checkbox to have animated check mark:

1. Add "use client" directive
2. Import motion from "framer-motion" and useAnimationPreference from "@/lib/hooks/useAnimationPreference"
3. Import spring from motion-tokens.ts
4. Keep Radix Checkbox base for accessibility
5. Replace static Check icon with animated SVG path:
   - Use motion.path with pathLength animation
   - Draw from 0 to 1 when checked
   - Use bouncyToggle spring for satisfying feel
6. Add scale pop animation on the checkbox container when checking
7. Conditionally apply animations based on shouldAnimate

```tsx
"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils/cn";
import { spring } from "@/lib/motion-tokens";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

const checkVariants = {
  unchecked: {
    pathLength: 0,
    opacity: 0,
  },
  checked: {
    pathLength: 1,
    opacity: 1,
    transition: {
      pathLength: { duration: 0.2, ease: "easeOut" },
      opacity: { duration: 0.1 },
    },
  },
};

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, checked, ...props }, ref) => {
  const { shouldAnimate, getSpring } = useAnimationPreference();
  const isChecked = checked === true || checked === "indeterminate";

  return (
    <CheckboxPrimitive.Root
      ref={ref}
      checked={checked}
      className={cn(
        "peer h-5 w-5 shrink-0 rounded-md border-2 border-border",
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",
        "disabled:cursor-not-allowed disabled:opacity-50",
        "data-[state=checked]:bg-primary data-[state=checked]:border-primary",
        "transition-colors duration-150",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator asChild>
        <motion.span
          className="flex items-center justify-center text-white"
          initial={shouldAnimate ? { scale: 0.5 } : undefined}
          animate={shouldAnimate ? { scale: 1 } : undefined}
          transition={shouldAnimate ? getSpring(spring.bouncyToggle || spring.rubbery) : undefined}
        >
          <svg
            width="12"
            height="12"
            viewBox="0 0 12 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <AnimatePresence>
              {isChecked && (
                <motion.path
                  d="M2.5 6L5 8.5L9.5 3.5"
                  stroke="currentColor"
                  strokeWidth="2"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  variants={shouldAnimate ? checkVariants : undefined}
                  initial="unchecked"
                  animate="checked"
                  exit="unchecked"
                />
              )}
            </AnimatePresence>
          </svg>
        </motion.span>
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
});
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };
```

Key features:
- Path draw animation for checkmark (pathLength 0 -> 1)
- Scale pop on the indicator container
- Uses bouncyToggle spring for satisfying feel
- Respects animation preference
- Maintains full Radix accessibility
  </action>
  <verify>`pnpm typecheck` passes. Checkbox animates check mark on toggle.</verify>
  <done>Checkbox component has animated check draw-in with scale pop.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - All TypeScript compiles
2. `pnpm lint` - No linting errors
3. `pnpm build` - Production build succeeds
4. Manual verification: BrandedSpinner rotates, ErrorShake shakes, Checkbox animates check
</verification>

<success_criteria>
- BrandedSpinner shows Morning Star rotating animation
- ErrorShake wraps content and shakes with red pulse
- Checkbox has animated check mark draw-in with spring physics
- All components respect useAnimationPreference
- `pnpm build` passes
</success_criteria>

<output>
After completion, create `.planning/phases/20-micro-interactions/20-02-SUMMARY.md`
</output>
