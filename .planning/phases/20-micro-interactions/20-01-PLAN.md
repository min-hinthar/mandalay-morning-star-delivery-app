---
phase: 20-micro-interactions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/motion-tokens.ts
  - src/components/ui/button.tsx
  - src/components/ui/input.tsx
  - src/components/ui/animated-toggle.tsx
autonomous: true

must_haves:
  truths:
    - "All buttons visually compress on press with shadow reduction"
    - "All inputs animate a glow ring on focus"
    - "Toggle switches have bouncy spring animation"
  artifacts:
    - path: "src/lib/motion-tokens.ts"
      provides: "Extended spring configs (snappy, bouncy) per CONTEXT.md"
      contains: "snappyButton|bouncyToggle"
    - path: "src/components/ui/button.tsx"
      provides: "Animated button with press compression"
      contains: "motion.button|whileTap"
    - path: "src/components/ui/input.tsx"
      provides: "Animated input with focus glow"
      contains: "motion.input|animate"
    - path: "src/components/ui/animated-toggle.tsx"
      provides: "Bouncy toggle switch component"
      contains: "spring|overshoot"
  key_links:
    - from: "src/components/ui/button.tsx"
      to: "src/lib/motion-tokens.ts"
      via: "imports spring configs"
      pattern: "import.*motion-tokens"
  existing_coverage:
    - requirement: "MICRO-07"
      description: "Skeleton shimmer animation"
      file: "src/components/ui/skeleton.tsx"
      status: "already implemented"
    - requirement: "MICRO-10"
      description: "Swipe gestures velocity response"
      file: "src/lib/micro-interactions.ts"
      status: "already implemented (createSwipeHandlers)"
    - requirement: "MICRO-11"
      description: "Price ticker slot machine animation"
      file: "src/components/ui/PriceTicker.tsx"
      status: "already implemented"
    - requirement: "MICRO-12"
      description: "Favorite button heart animation"
      file: "src/components/ui-v8/menu/FavoriteButton.tsx"
      status: "already implemented"
---

<objective>
Enhance core interactive elements (buttons, inputs, toggles) with consistent micro-animations.

Purpose: Every interactive element should feel alive and responsive. Button press should feel physical (depth), input focus should glow, toggles should bounce.

Output: Updated Button and Input components with Framer Motion integration, new AnimatedToggle component.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-micro-interactions/20-CONTEXT.md
@.planning/phases/20-micro-interactions/20-RESEARCH.md
@src/lib/motion-tokens.ts
@src/lib/micro-interactions.ts
@src/components/ui/button.tsx
@src/components/ui/input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend motion tokens with new spring configs</name>
  <files>src/lib/motion-tokens.ts</files>
  <action>
Add two new spring configurations per CONTEXT.md decisions:

1. `snappyButton` spring - for quick press feedback:
   - stiffness: 500
   - damping: 30
   - mass: 0.8
   - Use for: button press, input focus

2. `bouncyToggle` spring - for playful toggle bounces:
   - stiffness: 400
   - damping: 12
   - mass: 0.9
   - Use for: toggle knobs, checkbox check marks

Add to existing `spring` object alongside current presets.

Also add a `buttonPress` hover/tap preset to the `hover` object:
```ts
buttonPress: {
  whileHover: { scale: 1.02, y: -1 },
  whileTap: {
    scale: 0.97,
    y: 1,
    boxShadow: "0 1px 2px rgba(0,0,0,0.1)"
  },
  transition: spring.snappyButton,
}
```

Add an `inputFocus` animation config:
```ts
inputFocus: {
  initial: { boxShadow: "0 0 0 0 rgba(245, 158, 11, 0)" },
  focus: { boxShadow: "0 0 0 3px rgba(245, 158, 11, 0.3)" },
  error: { boxShadow: "0 0 0 3px rgba(239, 68, 68, 0.3)" },
  success: { boxShadow: "0 0 0 3px rgba(34, 197, 94, 0.3)" },
}
```
  </action>
  <verify>TypeScript compiles: `pnpm typecheck` passes. Import { spring } from motion-tokens works.</verify>
  <done>motion-tokens.ts exports snappyButton, bouncyToggle springs and buttonPress, inputFocus configs.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade Button component with Framer Motion press animation</name>
  <files>src/components/ui/button.tsx</files>
  <action>
Convert Button to use Framer Motion for press animations while preserving all existing functionality:

1. Import motion from "framer-motion" and useAnimationPreference from "@/lib/hooks/useAnimationPreference"
2. Import spring, hover from motion-tokens.ts
3. Keep existing buttonVariants CVA structure for styling
4. Replace `<Comp>` with `<motion.button>` (when not asChild)
5. Add motion props:
   - whileHover: scale 1.02, y -1 (subtle lift + glow)
   - whileTap: scale 0.97, y 1 (compress into surface)
   - transition: spring.snappyButton
6. Conditionally apply animations based on shouldAnimate from useAnimationPreference
7. Remove CSS active:scale from buttonVariants (replaced by whileTap)
8. Keep asChild/Slot support unchanged (animations only apply when asChild=false)

Button should still support all variants (primary, secondary, ghost, etc.) and sizes.

Do NOT change loading state behavior or icon slot behavior.
  </action>
  <verify>`pnpm typecheck` passes. Manual test: buttons have visible press compression.</verify>
  <done>Button component animates with Framer Motion: hover lifts, tap compresses with spring physics.</done>
</task>

<task type="auto">
  <name>Task 3: Upgrade Input component with animated focus glow</name>
  <files>src/components/ui/input.tsx</files>
  <action>
Add animated focus glow to Input component:

1. Import motion from "framer-motion" and useAnimationPreference from "@/lib/hooks/useAnimationPreference"
2. Import spring from motion-tokens.ts
3. Convert input element to motion.input
4. Add useState for isFocused state
5. Add onFocus/onBlur handlers to track focus state
6. Add animate prop with boxShadow animation:
   - When focused (default): amber glow (rgba(245, 158, 11, 0.3))
   - When focused + error variant: red glow (rgba(239, 68, 68, 0.3))
   - When focused + success variant: green glow (rgba(34, 197, 94, 0.3))
   - When not focused: no glow
7. Use spring.snappyButton transition for the glow animation
8. Conditionally apply animations based on shouldAnimate

Keep all existing input variants, sizes, and error/helper text behavior.

Focus ring CSS classes remain for keyboard accessibility (focus-visible).
Animation is additive visual polish, not replacement.
  </action>
  <verify>`pnpm typecheck` passes. Manual test: inputs glow on focus.</verify>
  <done>Input component animates focus state with contextual color glow (amber/red/green).</done>
</task>

<task type="auto">
  <name>Task 4: Create AnimatedToggle component</name>
  <files>src/components/ui/animated-toggle.tsx</files>
  <action>
Create new AnimatedToggle component with bouncy spring animation:

```tsx
"use client";

import { motion } from "framer-motion";
import { cn } from "@/lib/utils/cn";
import { spring } from "@/lib/motion-tokens";
import { useAnimationPreference } from "@/lib/hooks/useAnimationPreference";

interface AnimatedToggleProps {
  checked: boolean;
  onCheckedChange: (checked: boolean) => void;
  disabled?: boolean;
  size?: "sm" | "md" | "lg";
  className?: string;
  "aria-label"?: string;
}

// Size configurations
const sizeConfig = {
  sm: { track: "w-9 h-5", knob: "w-4 h-4", travel: 16 },
  md: { track: "w-11 h-6", knob: "w-5 h-5", travel: 20 },
  lg: { track: "w-14 h-8", knob: "w-7 h-7", travel: 24 },
};

export function AnimatedToggle({
  checked,
  onCheckedChange,
  disabled = false,
  size = "md",
  className,
  "aria-label": ariaLabel,
}: AnimatedToggleProps) {
  const { shouldAnimate } = useAnimationPreference();
  const { track, knob, travel } = sizeConfig[size];

  // Haptic feedback
  const handleChange = () => {
    if (disabled) return;
    if (typeof navigator !== "undefined" && navigator.vibrate) {
      navigator.vibrate(10);
    }
    onCheckedChange(!checked);
  };

  return (
    <button
      type="button"
      role="switch"
      aria-checked={checked}
      aria-label={ariaLabel}
      disabled={disabled}
      onClick={handleChange}
      className={cn(
        track,
        "relative inline-flex items-center rounded-full",
        "transition-colors duration-200",
        checked ? "bg-primary" : "bg-surface-tertiary",
        disabled && "opacity-50 cursor-not-allowed",
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",
        className
      )}
    >
      <motion.span
        className={cn(
          knob,
          "absolute left-0.5 rounded-full bg-white shadow-md"
        )}
        animate={shouldAnimate ? { x: checked ? travel : 0 } : undefined}
        initial={false}
        transition={shouldAnimate ? spring.bouncyToggle : { duration: 0 }}
      />
    </button>
  );
}

export default AnimatedToggle;
```

Key features:
- Spring overshoot when knob moves (bouncyToggle spring)
- Haptic feedback on toggle
- Three sizes (sm, md, lg)
- Respects animation preference
- Full accessibility (role="switch", aria-checked, focus ring)
- Disabled state support
  </action>
  <verify>`pnpm typecheck` passes. Component exports from file.</verify>
  <done>AnimatedToggle component exists with bouncy spring physics on toggle.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - All TypeScript compiles
2. `pnpm lint` - No linting errors
3. `pnpm build` - Production build succeeds
4. Manual verification: Buttons compress on press, inputs glow on focus, toggles bounce
</verification>

<success_criteria>
- motion-tokens.ts has snappyButton and bouncyToggle spring configs
- Button component uses Framer Motion for press animation with spring physics
- Input component has animated focus glow with contextual colors
- AnimatedToggle component exists with bouncy overshoot animation
- All components respect useAnimationPreference (reduced motion support)
- `pnpm build` passes
</success_criteria>

<output>
After completion, create `.planning/phases/20-micro-interactions/20-01-SUMMARY.md`
</output>
