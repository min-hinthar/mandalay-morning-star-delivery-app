---
phase: 15-foundation-r3f-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/dropdown-menu.tsx
  - src/components/ui-v8/Modal.tsx
  - src/components/ui-v8/menu/SearchAutocomplete.tsx
  - src/components/ui/overlay-base.tsx
  - src/components/layouts/AdminLayout.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Signout button click registers and logs user out successfully"
    - "All overlay components (modals, dropdowns, tooltips) are clickable"
    - "No z-index conflicts between header, dropdowns, and page content"
  artifacts:
    - path: "src/components/ui/dropdown-menu.tsx"
      provides: "Dropdown menu with correct z-index layering"
      contains: "zClass.popover"
    - path: "src/design-system/tokens/z-index.ts"
      provides: "Z-index token system"
      exports: ["zIndex", "zClass", "zIndexVar"]
  key_links:
    - from: "src/components/ui/dropdown-menu.tsx"
      to: "src/design-system/tokens/z-index.ts"
      via: "import zClass"
      pattern: "import.*zClass.*from.*z-index"
---

<objective>
Fix TailwindCSS 4 z-index blocking bug by migrating hardcoded z-index values to the zClass token system.

Purpose: Resolve signout button click-blocking issue (INFRA-02) and ensure all overlay components layer correctly (INFRA-01).
Output: All overlay components using zClass tokens, signout works correctly.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-foundation-r3f-setup/15-RESEARCH.md
@src/design-system/tokens/z-index.ts
@src/components/ui/dropdown-menu.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix dropdown-menu.tsx z-index</name>
  <files>src/components/ui/dropdown-menu.tsx</files>
  <action>
Update dropdown-menu.tsx to use the zClass token system:

1. Add import at top: `import { zClass } from "@/design-system/tokens/z-index";`
2. Line 90: Replace hardcoded `z-10` with `zClass.popover`
   - Before: `"absolute z-10 min-w-[8rem]..."`
   - After: `cn("absolute min-w-[8rem]...", zClass.popover)`

The zClass.popover token returns `z-[60]` which is above the fixed header's z-30, ensuring dropdowns escape the parent stacking context.

Do NOT change any other logic - only the z-index class.
  </action>
  <verify>
1. Run `grep -n "zClass" src/components/ui/dropdown-menu.tsx` - should show import and usage
2. Run `grep -n "z-10" src/components/ui/dropdown-menu.tsx` - should return no matches
3. Run `pnpm typecheck` - should pass
  </verify>
  <done>dropdown-menu.tsx imports zClass and uses zClass.popover instead of z-10</done>
</task>

<task type="auto">
  <name>Task 2: Migrate remaining hardcoded z-index values</name>
  <files>
    src/components/ui-v8/Modal.tsx
    src/components/ui-v8/menu/SearchAutocomplete.tsx
    src/components/ui/overlay-base.tsx
    src/components/layouts/AdminLayout.tsx
  </files>
  <action>
Audit and fix hardcoded z-10 values that should use zClass tokens. Focus on overlay-type components:

**src/components/ui-v8/Modal.tsx (line ~354)**
- Context: Close button positioning inside modal
- Current: `"absolute z-10"`
- Keep as-is: z-10 is correct for intra-modal layering (button above content, below modal chrome)

**src/components/ui-v8/menu/SearchAutocomplete.tsx (line ~222)**
- Context: Autocomplete dropdown results
- Current: `"z-10"`
- Change to: `zClass.popover` (autocomplete dropdowns need to escape parent stacking context)
- Add import: `import { zClass } from "@/design-system/tokens/z-index";`

**src/components/ui/overlay-base.tsx (line ~367)**
- Context: Close button inside overlay
- Current: `"absolute top-3 right-3 z-10"`
- Keep as-is: z-10 is correct for intra-overlay layering

**src/components/layouts/AdminLayout.tsx (lines ~182, ~193)**
- Context: Dropdown menu positioning
- Current: `"fixed inset-0 z-10"` and `"absolute right-0 top-full mt-2 z-10"`
- Line 182: Change to `zClass.modalBackdrop` (backdrop behind dropdown)
- Line 193: Change to `zClass.popover` (dropdown content)
- Add import: `import { zClass } from "@/design-system/tokens/z-index";`

**Decision rule:**
- If z-index positions element WITHIN a container (button inside modal) -> keep z-10
- If z-index positions element to ESCAPE parent stacking context (dropdown, autocomplete) -> use zClass token

Do NOT touch:
- BlurImage.tsx, MenuItemCard*.tsx (image overlays, correct at z-10)
- CategoryTabs*.tsx, TabSwitcher.tsx (tab indicators, correct at z-10)
- Header elements with z-30 (already using correct token value)
- Modal/dialog/drawer z-50 from Radix (already correct)
  </action>
  <verify>
1. Run `pnpm typecheck` - should pass
2. Run `pnpm lint` - should pass
3. Run `grep -rn "zClass" src/components/ui-v8/menu/SearchAutocomplete.tsx` - should show import and usage
4. Run `grep -rn "zClass" src/components/layouts/AdminLayout.tsx` - should show import and usage
  </verify>
  <done>SearchAutocomplete and AdminLayout dropdown use zClass tokens; Modal and overlay-base z-10 preserved for intra-component layering</done>
</task>

<task type="auto">
  <name>Task 3: Verify signout button functionality</name>
  <files></files>
  <action>
Verify the signout button works correctly after z-index migration:

1. Start dev server: `pnpm dev`
2. Navigate to app in browser (http://localhost:3000)
3. Log in if needed (use test account or create one)
4. Click user avatar/menu in header to open dropdown
5. Click "Sign out" button
6. Verify: User is logged out and redirected

If signout still fails after z-index fix, check:
- Browser DevTools Elements panel: Inspect dropdown z-index (should be 60)
- Check if any parent element creates stacking context (transform, opacity, filter)
- Check if click event is being swallowed (add console.log to onClick)

Document any remaining issues for follow-up.
  </action>
  <verify>
1. Signout button is visible when dropdown opens
2. Signout button click triggers logout action
3. User is redirected after logout
4. Run `pnpm build` - should pass
  </verify>
  <done>Signout button click works; user can log out from header dropdown</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. `pnpm build` passes
4. Manual test: Login -> Open dropdown -> Click signout -> Successfully logged out
5. All z-10 overlay components verified against decision rule (escape vs intra-component)
</verification>

<success_criteria>
- INFRA-01: Overlay components use zClass tokens correctly
- INFRA-02: Signout button click registers and logs user out
- No regressions in existing UI layering
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-foundation-r3f-setup/15-01-SUMMARY.md`
</output>
