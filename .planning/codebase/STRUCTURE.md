# Codebase Structure

**Analysis Date:** 2026-01-30

## Directory Layout

```
mandalay-morning-star-delivery-app/
├── .claude/                # Claude Code skills and workflows
├── .planning/              # Project planning docs (phases, codebase analysis)
├── e2e/                    # Playwright end-to-end tests
├── public/                 # Static assets (images, icons, manifest)
├── scripts/                # Utility scripts (seeding, auditing, RLS testing)
├── src/
│   ├── app/                # Next.js App Router (pages, layouts, API routes)
│   ├── components/         # React components (UI library)
│   ├── lib/                # Business logic, utilities, integrations
│   ├── stories/            # Storybook stories
│   ├── styles/             # Global CSS
│   ├── test/               # Test utilities and setup
│   └── types/              # TypeScript type definitions
├── supabase/               # Supabase migrations and functions
└── [config files]          # ESLint, TypeScript, Tailwind, etc.
```

## Directory Purposes

**`.planning/codebase/`:**
- Purpose: Codebase analysis documents for GSD workflow
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, etc.
- Key files: Auto-generated by `/gsd:map-codebase` command

**`.planning/phases/`:**
- Purpose: Implementation plans organized by phase
- Contains: Phase directories with PLAN.md and IMPLEMENTATION.md
- Key files: Incremental development tracking

**`src/app/`:**
- Purpose: Next.js App Router pages, layouts, and API routes
- Contains: Route groups, page components, API handlers
- Key files: `layout.tsx`, `page.tsx`, `route.ts`, `error.tsx`

**`src/app/(admin)/admin/`:**
- Purpose: Admin dashboard pages
- Contains: Analytics, menu management, driver management, route optimization
- Key files: `src/app/(admin)/admin/page.tsx`, `src/app/(admin)/admin/layout.tsx`

**`src/app/(customer)/`:**
- Purpose: Customer-facing pages (cart, checkout, orders)
- Contains: Shopping cart, checkout flow, order tracking
- Key files: `src/app/(customer)/cart/page.tsx`, `src/app/(customer)/checkout/page.tsx`

**`src/app/(driver)/driver/`:**
- Purpose: Driver app pages
- Contains: Route management, delivery tracking, history
- Key files: `src/app/(driver)/driver/route/page.tsx`

**`src/app/(public)/`:**
- Purpose: Public pages (homepage, menu browsing)
- Contains: Landing page, menu catalog
- Key files: `src/app/(public)/page.tsx`, `src/app/(public)/menu/page.tsx`

**`src/app/(auth)/`:**
- Purpose: Authentication pages
- Contains: Login, signup, password reset
- Key files: `src/app/(auth)/login/page.tsx`, `src/app/(auth)/signup/page.tsx`

**`src/app/api/`:**
- Purpose: RESTful API endpoints
- Contains: Route handlers organized by resource
- Key files: `src/app/api/menu/route.ts`, `src/app/api/checkout/session/route.ts`, `src/app/api/webhooks/stripe/route.ts`

**`src/components/ui/`:**
- Purpose: Reusable UI components organized by feature
- Contains: Feature-specific component directories
- Key files: Cart, menu, checkout, admin, driver, layout components

**`src/lib/`:**
- Purpose: Business logic, utilities, integrations, state management
- Contains: Stores, hooks, queries, services, validations, design tokens
- Key files: Zustand stores, Supabase clients, Stripe utilities

**`src/lib/stores/`:**
- Purpose: Zustand state management
- Contains: Global client state stores
- Key files: `cart-store.ts`, `checkout-store.ts`, `driver-store.ts`

**`src/lib/supabase/`:**
- Purpose: Supabase client factories
- Contains: Server, client, and service role clients
- Key files: `server.ts`, `client.ts`, `actions.ts`

**`src/lib/queries/`:**
- Purpose: Server-side data fetching functions
- Contains: Reusable query functions for server components
- Key files: `menu.ts`

**`src/lib/hooks/`:**
- Purpose: Custom React hooks
- Contains: Reusable hook logic
- Key files: Custom hooks with tests in `__tests__/`

**`src/lib/validations/`:**
- Purpose: Zod validation schemas
- Contains: Input validation for forms and API routes
- Key files: `checkout.ts` with corresponding tests

**`src/lib/design-system/`:**
- Purpose: Design tokens and theming
- Contains: Color, spacing, typography tokens
- Key files: `tokens/` subdirectory

**`src/types/`:**
- Purpose: TypeScript type definitions
- Contains: Domain types, API types, database types
- Key files: `database.ts`, `menu.ts`, `cart.ts`, `order.ts`, `checkout.ts`

**`e2e/`:**
- Purpose: End-to-end tests with Playwright
- Contains: Test specs for critical user flows
- Key files: Animation tests, accessibility tests

**`scripts/`:**
- Purpose: Utility scripts for development and testing
- Contains: Database seeding, token auditing, RLS testing
- Key files: `seed-menu.ts`, `audit-tokens.js`, `rls-isolation-test.mjs`

## Key File Locations

**Entry Points:**
- `src/app/layout.tsx`: Root layout with providers
- `src/app/(public)/page.tsx`: Homepage
- `src/app/providers.tsx`: Client-side provider wrapper

**Configuration:**
- `tsconfig.json`: TypeScript configuration
- `tailwind.config.ts`: Tailwind CSS configuration
- `next.config.ts`: Next.js configuration with Sentry
- `eslint.config.mjs`: ESLint rules
- `vitest.config.ts`: Vitest test configuration
- `playwright.config.ts`: Playwright E2E configuration

**Core Logic:**
- `src/lib/stores/cart-store.ts`: Shopping cart state
- `src/lib/supabase/server.ts`: Database client factory
- `src/app/api/checkout/session/route.ts`: Checkout API endpoint
- `src/app/api/webhooks/stripe/route.ts`: Payment webhook handler

**Testing:**
- `src/lib/stores/__tests__/`: Zustand store unit tests
- `src/lib/hooks/__tests__/`: Custom hook tests
- `e2e/`: Playwright E2E tests
- `src/test/`: Test utilities and setup

## Naming Conventions

**Files:**
- Components: PascalCase (e.g., `CartItem.tsx`, `MenuItemCard.tsx`)
- Utilities: kebab-case (e.g., `cart-store.ts`, `route-optimization.ts`)
- API routes: `route.ts` in directory matching endpoint path
- Tests: `*.test.tsx` or `*.test.ts` co-located or in `__tests__/`

**Directories:**
- Feature directories: kebab-case (e.g., `menu/`, `checkout/`)
- Route groups: Parentheses for layout grouping (e.g., `(admin)/`, `(customer)/`)
- Component feature modules: PascalCase (e.g., `UnifiedMenuItemCard/`)

**Components:**
- Client components: "use client" directive at top
- Server components: No directive (default in App Router)
- Layout components: `layout.tsx`
- Page components: `page.tsx`
- Error boundaries: `error.tsx`

## Where to Add New Code

**New Feature:**
- Primary code: `src/components/ui/[feature-name]/`
- Tests: `src/components/ui/[feature-name]/__tests__/` or co-located `*.test.tsx`
- Types: `src/types/[feature-name].ts`
- API endpoints: `src/app/api/[resource]/route.ts`

**New Component/Module:**
- Implementation: `src/components/ui/[feature]/ComponentName.tsx`
- Organized by feature domain (admin, cart, menu, checkout, driver, layout)
- For complex components: Create subdirectory with index export

**Utilities:**
- Shared helpers: `src/lib/utils/[category].ts`
- Business logic: `src/lib/services/[service-name].ts`
- Validation: `src/lib/validations/[resource].ts`

**New API Endpoint:**
- RESTful resource: `src/app/api/[resource]/route.ts`
- Nested resource: `src/app/api/[parent]/[child]/route.ts`
- Dynamic route: `src/app/api/[resource]/[id]/route.ts`

**New Page:**
- Public page: `src/app/(public)/[page-name]/page.tsx`
- Customer page: `src/app/(customer)/[page-name]/page.tsx`
- Admin page: `src/app/(admin)/admin/[page-name]/page.tsx`
- Driver page: `src/app/(driver)/driver/[page-name]/page.tsx`

**New State:**
- Global client state: `src/lib/stores/[feature]-store.ts`
- Server data fetching: `src/lib/queries/[resource].ts`

**New Integration:**
- External service: `src/lib/[service-name]/`
- Example: `src/lib/stripe/`, `src/lib/supabase/`

## Special Directories

**`src/app/contexts/`:**
- Purpose: React Context providers (legacy pattern)
- Generated: No
- Committed: Yes
- Note: Being phased out in favor of Zustand stores

**`.next/`:**
- Purpose: Next.js build output
- Generated: Yes (on build)
- Committed: No (in .gitignore)

**`node_modules/`:**
- Purpose: Package dependencies
- Generated: Yes (on install)
- Committed: No (in .gitignore)

**`.planning/`:**
- Purpose: Project planning and codebase documentation
- Generated: Partially (by GSD commands)
- Committed: Yes

**`public/`:**
- Purpose: Static assets served from root
- Generated: No
- Committed: Yes
- Contents: Icons, images, fonts, manifest.json

**`supabase/migrations/`:**
- Purpose: Database schema migrations
- Generated: Via Supabase CLI
- Committed: Yes
- Note: Sequential numbered migrations

**`.storybook/`:**
- Purpose: Storybook configuration
- Generated: No
- Committed: Yes

**`playwright-report/`, `test-results/`, `storybook-static/`:**
- Purpose: Test and build artifacts
- Generated: Yes (on test/build)
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-01-30*
